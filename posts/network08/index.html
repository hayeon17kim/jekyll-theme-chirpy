<!DOCTYPE html><html lang="kr-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="💻 HTTP #8: HTTP 조건부 요청" /><meta name="author" content="hayeon_kim" /><meta property="og:locale" content="kr_KR" /><meta name="description" content="HTTP는 리소스들을 검사기 값을 이용해 비교함으로써 성공했을 지라도 요청의 결과가 변경될 수 있는 조건부 요청의 컨셉을 갖고 있다. 조건부 요청은 캐시를 갱신할 때, 다운로드를 이어할 때, 서버 상의 문서를 업로드/수정할 때 유용하다." /><meta property="og:description" content="HTTP는 리소스들을 검사기 값을 이용해 비교함으로써 성공했을 지라도 요청의 결과가 변경될 수 있는 조건부 요청의 컨셉을 갖고 있다. 조건부 요청은 캐시를 갱신할 때, 다운로드를 이어할 때, 서버 상의 문서를 업로드/수정할 때 유용하다." /><link rel="canonical" href="https://hayeon17kim.github.io//posts/network08/" /><meta property="og:url" content="https://hayeon17kim.github.io//posts/network08/" /><meta property="og:site_name" content="하연" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-10-01T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="💻 HTTP #8: HTTP 조건부 요청" /><meta name="twitter:site" content="@MONI56219559" /><meta name="twitter:creator" content="@hayeon_kim" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"hayeon_kim"},"headline":"💻 HTTP #8: HTTP 조건부 요청","dateModified":"2020-10-01T00:00:00+08:00","datePublished":"2020-10-01T00:00:00+08:00","description":"HTTP는 리소스들을 검사기 값을 이용해 비교함으로써 성공했을 지라도 요청의 결과가 변경될 수 있는 조건부 요청의 컨셉을 갖고 있다. 조건부 요청은 캐시를 갱신할 때, 다운로드를 이어할 때, 서버 상의 문서를 업로드/수정할 때 유용하다.","url":"https://hayeon17kim.github.io//posts/network08/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hayeon17kim.github.io//posts/network08/"},"@context":"https://schema.org"}</script><title>💻 HTTP #8: HTTP 조건부 요청 | 하연</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-173202420-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-173202420-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/bio-photo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">하연</a></div><div class="site-subtitle font-italic">어제보다 나은 코드를 위해</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-laptop-code ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/hayeon17kim" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/MONI56219559" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hayeon17kim','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>💻 HTTP #8: HTTP 조건부 요청</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>💻 HTTP #8: HTTP 조건부 요청</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Oct 1, 2020, 12:00 AM +0800" > Oct 1, 2020 <i class="unloaded">2020-10-01T00:00:00+08:00</i> </span> by <span class="author"> hayeon_kim </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2863 words">15 min</span></div></div><div class="post-content"><p>HTTP는 리소스들을 검사기 값을 이용해 비교함으로써 성공했을 지라도 요청의 결과가 변경될 수 있는 <strong>조건부 요청의 컨셉</strong>을 갖고 있다. 조건부 요청은 <strong>캐시를 갱신</strong>할 때, <strong>다운로드를 이어</strong>할 때, <strong>서버 상의 문서를 업로드/수정</strong>할 때 유용하다.</p><h2 id="원칙">원칙</h2><p>HTTP 조건부 요청은 <strong>특정 헤더 값에 의존</strong>하여 <strong>기존과는 다르게 실행되는 요청</strong>이다. 이 헤더들은 <strong>전제 조건</strong>을 정의하고 있는데, <strong>요청의 결과는 전제 조건의 일치 여부에 따라 달라진다.</strong></p><p>조건부 요청은 <strong>요청 메서드 그리고 전제 조건을 위해 사용되는 헤더 집합</strong>에 의해 정의된다.</p><ul><li><code class="language-plaintext highlighter-rouge">GET</code>과 같은 safe 메서드의 경우, <strong>오직 연관</strong>되어 있는 경우에만 조건부 요청이 회신하는데 사용될 수 있어 대역폭을 아끼게 된다.<li><code class="language-plaintext highlighter-rouge">PUT</code>와 같은 unsafe 메서드들의 경우, 그 <strong>요청의 원본 문서가 서버에 저장되어 있는 것과 동일한 경우에만</strong> 조건부 요청이 <strong>문서 업로드</strong>에 사용될 수 있다.</ul><h2 id="검사기">검사기</h2><p>모든 조건부 요청들은 <strong>서버 상에 저장되어 있는 리소스가 특정 버전과 일치하는지를 검사</strong>하려고 한다. 따라서 조건부 요청은 <strong>리소스의 버전을 명시</strong>할 필요가 있습니다. 전체 리소스를 <strong>바이트 대 바이트로 비교하는 것은 불가능</strong>하기 때문에 요청은 <strong>버전을 뜻하는 값을 함께 전송</strong>한다: 이 값을 <em>검사기</em>라고 부른며 다음의 두 종류가 존재한다:</p><ul><li><strong><em>last-modified</em> 날짜</strong>: 문서의 최종 수정 일자<li><strong><em>entity tag</em> (<em>etag</em>)</strong>: 각 버전을 고유하게 나타내는 읽을 수 없는 문자열</ul><p>동일 리소스의 버전 비교는 강한 검사와 약한 검사로 나뉘어진다. <code class="language-plaintext highlighter-rouge">Last-Modified</code>와 ETag는 <strong>검사의 두 종류를 모두 지원</strong>한다(검사기가 서버 상에서 구현되는 복잡도는 매우 다양하다). HTTP는 <strong>기본적으로 강한 검사를 사용</strong>하며, 약한 검사기가 사용될 수 있는 경우에는 <code class="language-plaintext highlighter-rouge">W/</code>를 붙여 이를 명시한다.</p><h3 id="강한-검사">강한 검사</h3><p>강한 검사는 리소스가 비교하려는 다른 리소스와 <strong>바이트 대 바이트로 동일한지를 보장</strong>한다. 예를 들어 <strong>다운로드를 이어할 때 사용</strong>된다. <strong>조건부 헤더에 대해서 의무적</strong>이며, <strong>다른 헤더들에 대해서는 기본값</strong>이다. 강한 검사는 매우 엄격하고 서버 레벨에서 보장하기는 매우 어려울 수도 있으나, 때로는 <strong>성능의 손실을 감수하더라도 어떤 경우에도 데이터 무손실을 보장</strong>한다. <code class="language-plaintext highlighter-rouge">Last-Modified</code>만을 이용해 강한 검사를 하기는 어렵다. 보통 <strong>리소스의 MD5 해시</strong>(혹은 유도물)를 가지고 <strong><code class="language-plaintext highlighter-rouge">ETag</code></strong>를 사용한다.</p><h3 id="약한-검사"><strong>약한 검사</strong></h3><p>약한 검사는 강한 검사와 달리 두 리소스가 유사한 컨텐츠를 가지고 있으면 두 문서의 버전이 동일하다고 간주한다. 예를 들어, 기존의 페이지에서 <strong>날짜 혹은 광고</strong>만 다른 페이지가 있다고 가정할 때, 그 페이지는 강한 검사에서는 다르다고 판단되겠지만, 약한 검사에서는 기존의 페이지와 동일하다고 간주될 수 있다. <strong>약한 검사를 만들어내는 etag 체계</strong>를 세우는 것은 <strong>페이지의 요소들의 중요성 인지</strong>를 끌어들이는 순간부터 복잡해질 수 있지만, <strong>캐싱 성능을 최적화</strong>하는데 유용하다.</p><h2 id="조건부-헤더">조건부 헤더</h2><p>조건부 헤더는 조건부 요청을 이끌어 낸다.</p><ul><li><code class="language-plaintext highlighter-rouge">If-Match</code>: <strong>원격지 리소스의 <code class="language-plaintext highlighter-rouge">ETag</code>가 이 헤더에 나열된 것과 일치</strong>한다면 성공<li><code class="language-plaintext highlighter-rouge">If-None-Match</code><li><code class="language-plaintext highlighter-rouge">If-Modified-Since</code>: <strong>원격지의 리소스의 <code class="language-plaintext highlighter-rouge">Last-Modified</code> 날짜가 이 헤더 내에 주어진 것보다 좀 더 최근인 경우 성공</strong><li><code class="language-plaintext highlighter-rouge">If-Unmodified-Since</code><li><code class="language-plaintext highlighter-rouge">If-Range</code>: 하나의 단일 etag 혹은 하나의 날짜만을 가질 수 있다. 실패하면 범위 요청이 실패하고, 206 Partial Content 응답 대신 200 OK가 완전한 리소스와 함께 전송될 것이다.</ul><h2 id="유스-케이스">유스 케이스</h2><h3 id="캐시-갱신">캐시 갱신</h3><ol><li><strong>캐시가 비어 있거나 없는 경우</strong>, 요청된 리소스는 <a href="https://developer.mozilla.org/ko/docs/Web/HTTP/Status/200"><code class="language-plaintext highlighter-rouge">200</code></a> <code class="language-plaintext highlighter-rouge">OK</code>의 상태로 회신된다. <strong>리소스와 함께, 검사기가 헤더 내에 전송</strong>됩니다. 검사기는 해당 리소스와 함께 캐시되고, 캐시가 신선하지 않게 되었을 때 조건부 요청을 만들어 내는 데 사용될 것이다.<li><strong>캐시가 신선한 동안</strong>에는, 어떤 요청도 발급되지 않는다.<li><strong>캐시가 신선하지 않게</strong> 되면, 클라이언트는 캐시된 값을 직접 사용하지 않고, <code class="language-plaintext highlighter-rouge">If-Modified-Since</code>와 <code class="language-plaintext highlighter-rouge">If-Match</code> 헤더의 파라미터로 사용되는 검사기값을 이용해 조건부 요청을 전송한다.<ol><li><strong>리소스가 변경되지 않았다면,</strong> 서버는 <strong><code class="language-plaintext highlighter-rouge">304</code> <code class="language-plaintext highlighter-rouge">Not Modified</code> 응답을 회신</strong>하고, 이는 캐시를 다시 신선한 것으로 만들어주며, 클라이언트는 <strong>캐시된 리소스를 사용</strong>하게 된다. 추가적인 응답/요청 왕복이 이루어지지만, 연결을 통해 다시 전체 리소스를 받는 것보다는 효율적이다.<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://mdn.mozillademos.org/files/13731/HTTPCache2.png" alt="With a stale cache, the conditional request is sent. The server can determine if the resource changed, and, as in this case, decide not to send it again as it is the same." /><li><strong>리소스가 변경</strong>되었다면, 서버는 <strong>리소스의 새로운 버전</strong>과 함께, <a href="https://developer.mozilla.org/ko/docs/Web/HTTP/Status/200"><code class="language-plaintext highlighter-rouge">200</code></a><code class="language-plaintext highlighter-rouge"> OK</code> 응답을 회신한다.</ol></ol><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://mdn.mozillademos.org/files/13733/HTTPCache3.png" alt="In the case where the resource was changed, it is sent back as if the request wasn't conditional." /></p><p>이 메커니즘에서는 <strong>모든 브라우저가 캐시를 관리</strong>하고 있고, 조건부 요청을 보내, 웹 개발자는 추가조치를 취할 필요가 없다.</p><h3 id="부분-다운로드의-통합">부분 다운로드의 통합</h3><p><strong>파일들의 부분적인 다운로드</strong>는 <strong>이전 동작을 계속하게 이어주는 HTTP의 기능</strong>으로, 이미 받아놓은 정보를 유지함으로써 대역폭과 시간을 절약해준다. 부분적인 다운로드를 지원하는 서버는 <strong><code class="language-plaintext highlighter-rouge">Accept-Ranges</code> 헤더</strong>를 보냄으로써 이를 알린다. 클라이언트는 아직 전송받지 못한 범위와 함께 <code class="language-plaintext highlighter-rouge">Ranges</code>을 전송하여 다운로드를 이어나갈 수 있다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://mdn.mozillademos.org/files/13737/HTTPResume2.png" alt="The client resumes the requests by indicating the range he needs and preconditions checking the validators of the partially obtained request." /></p><p>이 원칙은 간단하지만 한 가지 문제점이 있다: <strong>다운로드된 리소스가 두 다운로드 사이에 수정될 경우</strong>, <strong>수신받던 범위는 리소스의 두 개의 서로 다른 버전과 상응</strong>하게 될 것이며 최종적인 문서는 <strong>오염</strong>될 것이다.</p><p><strong>이를 방지하기 위해 조건부 요청</strong>이 사용되는데, 두 가지 방법이 있다.</p><ol><li><code class="language-plaintext highlighter-rouge">If-Modified-Since</code>와 <code class="language-plaintext highlighter-rouge">If-Match</code> 헤더를 사용하는 방법: 전제 조건이 실패할 경우 서버는 오류를 반환하고, 클라이언트는 <strong>다운로드를 처음부터 다시 시작</strong>한다. 그러라 이 방법은 <strong>추가적인 응답/요청 교환</strong>을 필요로 하고, 이는 <strong>성능 감소</strong>의 원인이 된다.<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://mdn.mozillademos.org/files/13739/HTTPResume3.png" alt="When the partially downloaded resource has been modified, the preconditions will fail and the resource will have to be downloaded again completely." /><li>HTTP는 이것을 피하기 위한 특별한 헤더인 <strong><code class="language-plaintext highlighter-rouge">If-Range</code></strong>를 가지고 있다. <code class="language-plaintext highlighter-rouge">If-Range</code>를 사용할 경우 리소스가 변경되었을 때 1번처럼 서버에서 오류를 반환하고 클라이언트에서 다시 리소스 요청을 하는 <strong>과정이 생략</strong>된다. 클라이언트가 변경할 시 바로 처음부터 다운로드를 시작한다. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://mdn.mozillademos.org/files/13741/HTTPResume4.png" alt="The If-Range headers allows the server to directly send back the complete resource if it has been modified, no need to send a 412 error and wait for the client to re-initiate the download." /></ol><h3 id="최적화된-잠금으로-업데이트-손실-문제-피하기">최적화된 잠금으로 업데이트 손실 문제 피하기</h3><p><code class="language-plaintext highlighter-rouge">PUT</code> 메서드를 이용해 <strong>원격 문서를 <em>갱신</em></strong>하는 기능을 구현할 수 있다. 클라이언트는 원본 파일을 읽어들인 후 그것을 수정하고 최종적으로 서버로 수정된 파일을 내보낸다.</p><p>문제는 하나의 클라이언트가 리소스의 새로운 복사본을 지역적으로 수정하고 있는 동안에도, 두번째 클라이언트가 동일한 리소스를 내려받고 자신의 영역 내에서 동일한 작업을 할 수 있다. 어떤 클라이언트의 변경 사항이 유지될 지는 <strong>커밋하는 시점, 클라이언트와 서버의 성능</strong>, 클라이언트에서 <strong>문서를 수정하는 속도</strong>에 의해서도 달라진다. 중요한 것은 <strong>받아들여진 클라이언트의 변경 사항으로 모두 변경</strong>된다는 것이다. 이것을 <strong>race condition</strong>(경쟁상태)라고 하며 감지하고 디버깅하기 어려운 불확실한 동작을 유발한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://mdn.mozillademos.org/files/13749/HTTPLock2.png" alt="When several clients update the same resource in parallel, we are facing a race condition: the slowest win, and the others don't even know they lost. Problematic!" /></p><p><strong>두 클라이언트 중 하나를 불편하게 만들지 않고는 이를 해결할 수 있는 방법은 없다</strong>. 다만 업데이트 손실과 경쟁 상태는 피할 수는 있다. 조건부 요청은 <em>최적화 잠금 알고리즘</em>을 구현할 수 있도록 합니다. 잠금 메커니즘은 <strong>클라이언트들이 리소스의 복사본</strong>들을 갖고 <strong>로컬에서 그것을 수정</strong>하며 첫번째 클라이언트가 그 <strong>수정된 내용을 성공적으로 제출</strong>하고 나서 <strong>이전 버전이 된 리소스가 거절</strong>되도록 하여 <strong>모든 업데이트가 순차적으로 이루어질 수 있도록 하여 동시성을 제어</strong>할 수 있도록 해준다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://mdn.mozillademos.org/files/13751/HTTPLock3.png" alt="Conditional requests allow to implement optimistic locking: now the quickest wins, and the others get an error." /></p><p>이 메커니즘은 <code class="language-plaintext highlighter-rouge">If-Match</code>나 <code class="language-plaintext highlighter-rouge">If-Unmodified-Since</code> 헤더를 사용해 구현한다. <strong>etag가 원본 파일과 일치하지 않거나 혹은 파일을 수신한 이후에 파일이 수정</strong>된 경우, 해당 변경 사항은 <code class="language-plaintext highlighter-rouge">412 Precondition Failed</code> 오류와 함께 거절될 것이다. 이후 <strong>현재 가장 최신의 버전으로부터 다시 시작하도록 클라이언트에게 알려주거나 “diff”를 보여주고 변경된 내용을 유지하도록 선택</strong>할 수 있게 도움을 줄 수 있다.</p><blockquote><p>diff: 두 개의 파일 간 차이에 대한 정보를 출력하는 파일 비교 유틸리티이다. 일반적으로 하나의 파일 버전과 동일한 파일의 다른 버전 간의 변경 사항을 보여주는 데 쓰인다. diff는 문서 파일의 줄 사이 변경사항을 보여준다.</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://doc-snapshots.qt.io/qtcreator-4.0/images/creator-diff-editor.png" alt="diff" /></p><h3 id="리소스의-첫번째-업로드-다루기">리소스의 첫번째 업로드 다루기</h3><p>두 클라이언트가 업데이트를 동시에 실행하려고 하는 경우도 경쟁상태이다. 이를 방지하기 위해 조건부 요청을 사용할 수 있다: 어떤 etag든지 나타내는 <code class="language-plaintext highlighter-rouge">'*'</code>라고 하는 특별한 값을 <a href="https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/If-None-Match"><code class="language-plaintext highlighter-rouge">If-None-Match</code></a>에 추가하여, <strong>리소스가 이전에 존재하지 않은 경우에만 요청이 성공하게 할 수 있다.</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://mdn.mozillademos.org/files/13753/HTTPFirst.png" alt="Like for a regular upload, the first upload of a resource is subject to a race condition: If-None-Match can prevent it." /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/network/'>network</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/network/" class="post-tag no-text-decoration" >network</a> <a href="/tags/http/" class="post-tag no-text-decoration" >http</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=💻 HTTP #8: HTTP 조건부 요청 - 하연&url=https://hayeon17kim.github.io//posts/network08/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=💻 HTTP #8: HTTP 조건부 요청 - 하연&u=https://hayeon17kim.github.io//posts/network08/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=💻 HTTP #8: HTTP 조건부 요청 - 하연&url=https://hayeon17kim.github.io//posts/network08/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/system-deisign-capacity-estimation/">System Design: Capacity Estimate</a><li><a href="/posts/today-i-learned-2021-04-27/">주니어 성장일기: 2021.04.27</a><li><a href="/posts/today-i-learned-2021-04-26/">주니어 성장일기: 2021.04.26</a><li><a href="/posts/fastcampus-01/">자료구조와 알고리즘이란</a><li><a href="/posts/today-i-learned-2021-04-25/">주니어 성장일기: 2021.04.25</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/bitcamp/">bitcamp</a> <a class="post-tag" href="/tags/modernjs/">modernJS</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/trouble-shooting/">trouble-shooting</a> <a class="post-tag" href="/tags/devil/">devil</a> <a class="post-tag" href="/tags/corejs/">corejs</a> <a class="post-tag" href="/tags/network/">network</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/network04/"><div class="card-body"> <span class="timeago small" > Aug 27, 2020 <i class="unloaded">2020-08-27T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>💻 HTTP #4: 교차 출처 리소스 공유(CORS)</h3><div class="text-muted small"><p> 교차 출처 리소스 공유 (CORS) 등장 배경 동일 출처 정책 (SOP: Same-Origin Policy) 원래 도메인이 다르면 요청을 주고받을 수 없게 하려는 게 웹브라우저의 주요 정책이었다. 동일출처정책은 어떤 출처(origin)에서 불러온 문서나 스크립트가 다른 출처에서 가져온 리소스와 상호작용하는 것을 제한하는 중요한 보안 방식이다,...</p></div></div></a></div><div class="card"> <a href="/posts/network05/"><div class="card-body"> <span class="timeago small" > Sep 13, 2020 <i class="unloaded">2020-09-13T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>💻 HTTP #5: HTTP의 진화</h3><div class="text-muted small"><p> HTTP의 진화 월드 와이드 웹의 발명 1990년에 팀 버너스 리에 의해 만들어졌다. TCP/IP 프로토콜 상에서 만들어진 월드 와이드 웹은 HTML, HTTP, 월드 와이드 웹이라고 불리는 브라우저, 문서에 접근하게 해주는 httpd의 초기 버전으로 구성되어 있다. HTTP/0.9: 원-라인 프로토콜 HTTP 초기 버전은 매우 단순했다. GE...</p></div></div></a></div><div class="card"> <a href="/posts/network06/"><div class="card-body"> <span class="timeago small" > Sep 23, 2020 <i class="unloaded">2020-09-23T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>💻 HTTP #6: HTTP 메시지</h3><div class="text-muted small"><p> HTTP 메시지 HTTP 메시지 HTTP 메시지는 서버와 클라이언트 간에 데이터가 교환되는 방식이다. 메시지의 타입은 요청(request)와 응답(response)로 나뉘어진다. 메시지 특징 ASCII로 인코딩된 텍스트 정보이며 여러 줄로 되어 있다. HTTP 초기와 HTTP1.1의 메시지는 사람이 읽을 수 있었지만, HTTP/2에서는...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/corejs0210/" class="btn btn-outline-primary" prompt="Older"><p>코어 자바스크립트 #2.10: if와 '?'를 사용한 조건 처리</p></a> <a href="/posts/textbook-0800/" class="btn btn-outline-primary" prompt="Newer"><p>:book: 자바의 정석 #8: 예외처리</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Loading comments from <a href="https://disqus.com/">Disqus</a> ...</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//hayeon17kim-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = '💻 HTTP #8: HTTP 조건부 요청'; this.page.url = 'https://hayeon17kim.github.io//posts/network08/'; this.page.identifier = '/posts/network08/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/MONI56219559">hayeon_kim</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/bitcamp/">bitcamp</a> <a class="post-tag" href="/tags/modernjs/">modernJS</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/trouble-shooting/">trouble shooting</a> <a class="post-tag" href="/tags/devil/">devil</a> <a class="post-tag" href="/tags/corejs/">corejs</a> <a class="post-tag" href="/tags/network/">network</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://hayeon17kim.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
