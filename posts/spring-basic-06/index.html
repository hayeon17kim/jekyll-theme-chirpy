<!DOCTYPE html><html lang="kr-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="스프링 입문 #6 스프링 DB 접근 기술" /><meta name="author" content="hayeon_kim" /><meta property="og:locale" content="kr_KR" /><meta name="description" content="Section 6. 스프링 DB 접근 기술" /><meta property="og:description" content="Section 6. 스프링 DB 접근 기술" /><link rel="canonical" href="https://hayeon17kim.github.io//posts/spring-basic-06/" /><meta property="og:url" content="https://hayeon17kim.github.io//posts/spring-basic-06/" /><meta property="og:site_name" content="하연" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-18T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="스프링 입문 #6 스프링 DB 접근 기술" /><meta name="twitter:site" content="@MONI56219559" /><meta name="twitter:creator" content="@hayeon_kim" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"hayeon_kim"},"headline":"스프링 입문 #6 스프링 DB 접근 기술","dateModified":"2021-01-18T00:00:00+08:00","datePublished":"2021-01-18T00:00:00+08:00","description":"Section 6. 스프링 DB 접근 기술","url":"https://hayeon17kim.github.io//posts/spring-basic-06/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hayeon17kim.github.io//posts/spring-basic-06/"},"@context":"https://schema.org"}</script><title>스프링 입문 #6 스프링 DB 접근 기술 | 하연</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-173202420-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-173202420-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/bio-photo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">하연</a></div><div class="site-subtitle font-italic">어제보다 나은 코드를 위해</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-laptop-code ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/hayeon17kim" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/MONI56219559" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hayeon17kim','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>스프링 입문 #6 스프링 DB 접근 기술</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>스프링 입문 #6 스프링 DB 접근 기술</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Jan 18, 2021, 12:00 AM +0800" > Jan 18 <i class="unloaded">2021-01-18T00:00:00+08:00</i> </span> by <span class="author"> hayeon_kim </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="6856 words">38 min</span></div></div><div class="post-content"><h1 id="section-6-스프링-db-접근-기술">Section 6. 스프링 DB 접근 기술</h1><p>실무에서는 MySql이나 Oracle DB가 많이 쓰이는데, 특히 MySql 계열 DB를 많이 사용된다.</p><h2 id="1강-h2-데이터베이스-설치">1강. H2 데이터베이스 설치</h2><p>개발이나 테스트 용도(교육용)로 가볍고 편리한 DB, 웹 화면 제공</p><ul><li><p><a href="https://h2database.com">H2 공식 사이트</a>에서 다운로드 및 설치</p><li><p>h2 데이터베이스 버전은 스프링 부트 버전에 맞춘다.</p><li><p>권한 주기: <code class="language-plaintext highlighter-rouge">chmod 755 h2.sh</code></p><li><p>실행: <code class="language-plaintext highlighter-rouge">/h2.sh</code></p><li><p>데이터베이스 파일 생성 방법</p><ul><li><code class="language-plaintext highlighter-rouge"> jdbc:h2:~/test</code> (최초 한번)</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/104896773-e8d51580-59ba-11eb-9d63-295fa59a2686.png" alt="image" /></p><ul><li><code class="language-plaintext highlighter-rouge">~/test.mv.db</code> 파일 생성 확인<li>이후부터는 ` jdbc:h2:tcp://localhost/~/test`</ul><p>JDBC URL에 있는 값 <code class="language-plaintext highlighter-rouge">jdbc:h2: ~/test</code>는 파일 경로이다. 이렇게 파일로 접근하게 되면 애플리케이션과 웹 콘솔이 충돌할 수 있기 때문에 값을 <code class="language-plaintext highlighter-rouge">jdbc:h2:tcp://localhost/~/test</code>로 바꿔준다. 파일을 직접 접근하는 것이 아니라, <strong>소켓을 통해 접근</strong>하게 만든다. 이제 여러 곳에서 에러 없이 접근할 수 있다.</p></ul><blockquote><p>만약 문제가 있다면 <code class="language-plaintext highlighter-rouge">rm test.vs.db</code> 명령어로 파일 자체를 지우고, 서버를 닫고, 다시 처음부터 시도한다.</p></blockquote><p><strong>테이블 생성하기</strong></p><p>테이블 관리를 위해 프로젝트 루트에 <code class="language-plaintext highlighter-rouge">sql/ddl.sql</code> 파일을 생성</p><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">drop</span> <span class="k">table</span> <span class="n">if</span> <span class="k">exists</span> <span class="n">member</span> <span class="k">CASCADE</span><span class="p">;</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">member</span>
<span class="p">(</span>
  <span class="n">id</span> <span class="nb">bigint</span> <span class="k">generated</span> <span class="k">by</span> <span class="k">default</span> <span class="k">as</span> <span class="k">identity</span><span class="p">,</span>
  <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
</pre></table></code></div></div><ul><li>H2 데이터베이스에 접근해서 <code class="language-plaintext highlighter-rouge">member</code> 테이블 생성<li><code class="language-plaintext highlighter-rouge">bigint</code>: long 타입<li><code class="language-plaintext highlighter-rouge">generated by default as identity</code>: 값을 셋팅하지 않고 insert 했을 때 값을 자동으로 채워준다. 즉 PK 값에 대한 생성을 DB가 알아서 하도록 넘긴 것이다.</ul><p><strong>H2 데이터베이스가 정상 생성되지 않을 때</strong></p><ul><li>H2 데이터베이스를 종료하고 다시 시작한다.<li>웹 브라우저가 자동 실행되면 주소창에 localhost가 아니라 임의의 숫자(ex: 100.1.2.3)가 나온다.<li>앞 부분만 임의의 숫자(ex: 100.1.2.3) =&gt; <code class="language-plaintext highlighter-rouge">localhost</code>로 변경하고 Enter를 입력한다. 나머지 부분은 절대 변경하면 안 된다. (특히 뒤의 세션 부분이 변경되면 안 된다.)<li>데이터베이스 파일을 생성하면(<code class="language-plaintext highlighter-rouge">jdbc:h2:~/test</code>), 데이터베이스가 정상 생성된다.</ul><h2 id="2강-순수-jdbc">2강. 순수 Jdbc</h2><h3 id="환경-설정">환경 설정</h3><p><strong>build.gradle 파일에 jdbc, h2 데이터베이스 관련 라이브러리 추가</strong></p><div class="language-groovy highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-jdbc'</span>
<span class="n">runtimeOnly</span> <span class="s1">'com.h2database:h2'</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">spring-boot-starter-jdbc</code>: 자바는 기본적으로 DB와 붙으려면 JDBC 드라이버가 꼭 있어야 한다.<li><code class="language-plaintext highlighter-rouge">com.h2database:h2</code>: DB에 붙으려면 DB가 제공하는 클라이언트가 필요하다.</ul><p>작성 후 intelliJ에서는 <code class="language-plaintext highlighter-rouge">buid.gradle</code>에서 코끼리 아이콘을 클릭하면 라이브러리가 다운받아진다.</p><p><strong>스프링 부트 데이터베이스 연결 설정 추가</strong></p><p><code class="language-plaintext highlighter-rouge">resources/application.properties</code></p><p>DB 접속 정보를 적어야 한다.</p><div class="language-properties highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="py">spring.datasource.url</span><span class="p">=</span><span class="s">jdbc:h2:tcp://localhost/~/test</span>
<span class="py">spring.datasource.driver-class-name</span><span class="p">=</span><span class="s">org.h2.Driver</span>
<span class="py">spring.datasource.username</span><span class="p">=</span><span class="s">sa</span>
</pre></table></code></div></div><blockquote><p>주의: 스프링부트 2.4부터는 <code class="language-plaintext highlighter-rouge">spring.datasource.username=sa</code>를 꼭 추가해주어야 한다. 그렇지 않으면 <code class="language-plaintext highlighter-rouge">wrong user name or password</code> 오류가 발생한다. 또한 마지막에 공백이 들어가면 같은 오류가 발생한다. 공백은 모두 제거해야 한다.</p></blockquote><blockquote><p>참고: 인텔리J 커뮤니티 버전의 경우 <code class="language-plaintext highlighter-rouge">application.properties</code> 파일의 왼쪽이 회색으로 나온다. 엔터프라이즈 버전에서 제공하는 스프링의 소스 코드를 연결해주는 편의 기능이 빠진 것인데, 실제 동작에는 아무런 문제가 없다.</p></blockquote><h3 id="jdbc-리포지토리-구현">Jdbc 리포지토리 구현</h3><p>회원을 저장한다는 역할은 <code class="language-plaintext highlighter-rouge">MemberRepository</code>가 하지만, 구현은 메모리에 저장할 것인지, DB와 연동해서 저장할 것인지에 따라 다르다. 한편 이렇게 JDBC API로 직접 코딩하는 것은 20년 전 이야기다.</p><p><strong>Jdbc 회원 리포지토리</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JdbcMemberRepository</span> <span class="kd">implements</span> <span class="nc">MemberRepository</span> <span class="o">{</span>
  
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="nf">JdbcMemberRepository</span><span class="o">(</span><span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
  <span class="o">}</span>
  
  <span class="c1">//..</span>
<span class="o">}</span>
</pre></table></code></div></div><p>DB에 붙으려면 <code class="language-plaintext highlighter-rouge">DataSource</code>라는 것이 필요하다. 그리고 이것을 스프링으로부터 주입받는다. 그리고 이 <code class="language-plaintext highlighter-rouge">dataSource</code>로 부터 <code class="language-plaintext highlighter-rouge">getConnection</code>을 해서 열린 소켓을 얻을 수 있다. 여기에 sql문을 보내서 DB에 전달해주면 된다.</p><p><code class="language-plaintext highlighter-rouge">insert into member(name) values(?)</code>: 파라미터 바인딩을 위해 물음표를 사용한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">hello.hellospring.repository</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JdbcMemberRepository</span> <span class="kd">implements</span> <span class="nc">MemberRepository</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">JdbcMemberRepository</span><span class="o">(</span><span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 여기서는 sql 문자열을 로컬 변수로 선언했지만</span>
    <span class="c1">// 상수로 해주는 것이 좋다.</span>
    <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"insert into member(name) values(?)"</span><span class="o">;</span>
    
    <span class="nc">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="nc">PreparedStatement</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">conn</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
      <span class="c1">// insert를 할 때 자동 생성되는 값을 가져오기 위함</span>
      <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">,</span>
              <span class="nc">Statement</span><span class="o">.</span><span class="na">RETURN_GENERATED_KEYS</span><span class="o">);</span>
      
      <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">member</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
      
      <span class="c1">// DB에 실제 쿼리가 날아간다.</span>
      <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
      <span class="c1">// insert 시 자동 생성된 값을 가져옴</span>
      <span class="n">rs</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">getGeneratedKeys</span><span class="o">();</span>
      
      <span class="c1">// 값이 있으면 값을 꺼낸다.</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">SQLException</span><span class="o">(</span><span class="s">"id 조회 실패"</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">member</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
      
      <span class="c1">// 자원 release</span>
      <span class="c1">// DB 커넥션 같은 경우 외부 네트워크와 연결된 것이기 때문에 끝나면 바로 자원을 반환해야 한다.</span>
      <span class="c1">// 그렇지 않으면 DB 커넥션이 쌓이다가 큰 장애가 발생할 수 있다!!!!</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">close</span><span class="o">(</span><span class="n">conn</span><span class="o">,</span> <span class="n">pstmt</span><span class="o">,</span> <span class="n">rs</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"select * from member where id = ?"</span><span class="o">;</span>
    <span class="nc">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="nc">PreparedStatement</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">conn</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
      <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
      <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
      
      <span class="c1">// 조회는 executeUpdate가 아닌 executeQuery</span>
      <span class="n">rs</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
      
      <span class="c1">// 값이 있으면 객체 생성</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">();</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="s">"id"</span><span class="o">));</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>
        <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">close</span><span class="o">(</span><span class="n">conn</span><span class="o">,</span> <span class="n">pstmt</span><span class="o">,</span> <span class="n">rs</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"select * from member"</span><span class="o">;</span>
    <span class="nc">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="nc">PreparedStatement</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">conn</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
      <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
      
      <span class="n">rs</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
      
      <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
      <span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">();</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="s">"id"</span><span class="o">));</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>
        <span class="n">members</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
      <span class="o">}</span>
      
      <span class="k">return</span> <span class="n">members</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">close</span><span class="o">(</span><span class="n">conn</span><span class="o">,</span> <span class="n">pstmt</span><span class="o">,</span> <span class="n">rs</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"select * from member where name = ?"</span><span class="o">;</span>
    <span class="nc">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="nc">PreparedStatement</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">conn</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
      
      <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
      <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
      
      <span class="n">rs</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">();</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="s">"id"</span><span class="o">));</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>
        <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">close</span><span class="o">(</span><span class="n">conn</span><span class="o">,</span> <span class="n">pstmt</span><span class="o">,</span> <span class="n">rs</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="c1">// dataSource.getConnection()을 하면 계속해서 새로운 커넥션이 주어진다.</span>
  <span class="c1">// 스프링 프레임워크를 통해 커넥션을 쓸 때는 </span>
  <span class="c1">// dataSourceUtils을 통해서 커넥션을 획득해야 한다.</span>
  <span class="c1">// 그래야 이전에 DB 트랜잭션이 걸릴 수 있는데 그러면 DB 커넥션을 똑같은 걸로 유지시켜줘야 한다. 이걸 유지시켜줌. </span>
  
  <span class="kd">private</span> <span class="nc">Connection</span> <span class="nf">getConnection</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">DataSourceUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">conn</span><span class="o">,</span> <span class="nc">PreparedStatement</span> <span class="n">pstmt</span><span class="o">,</span> <span class="nc">ResultSet</span> <span class="n">rs</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">rs</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">pstmt</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">pstmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">conn</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">close</span><span class="o">(</span><span class="n">conn</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

    <span class="c1">// 닫을 때도 dataSourceUtils을 통해서 닫는다.</span>
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">conn</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
    <span class="nc">DataSourceUtils</span><span class="o">.</span><span class="na">releaseConnection</span><span class="o">(</span><span class="n">conn</span><span class="o">,</span> <span class="n">dataSource</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">MemberRepository</code> 인터페이스를 구현체를 하나 더 만들어서 확장하였다.</p><p><strong>스프링 설정 변경</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">hello.hellospring</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>

  <span class="nd">@Autowired</span>
  <span class="kd">public</span> <span class="nf">SpringConfig</span><span class="o">(</span><span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">MemberService</span> <span class="nf">memberService</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">MemberService</span><span class="o">(</span><span class="n">memberRepository</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">MemberRepository</span> <span class="nf">memberRepository</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">//return new MemoryMemberRepository();</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">JdbcMemberRepository</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p>객체지향적 설계가 좋은 이유? 이걸 다형성이라고 부른다. 인터페이스를 두고 구현체를 바꿔끼기를 할 수 있다. 스프링에서는 이것을 아주 쉽게 할 수 있도록 스프링 컨테이너를 통해서 지원한다. DI를 통해. 스프링 없이 DB를 변경하려면? MemberService의 생성자와 필드를 MemoryMemberRepository에서 JdbcMemberRepository로 바꿔줘야 할 것이다. 즉 코드의 수정이 있어야 한다. 반면 스프링의 DI를 사용하면 기존 코드는 전혀 손대지 않고, 설정 파일 변경만으로 구현 클래스를 변경할 수 있다. 이때 설정은 객체 Assemble(조립)이라고도 한다. 즉 조립하는 코드만 변경하면 구현체를 교체할 수 있다.</p><p>DataSource는 <strong>데이터베이스 커넥션을 획득할 때 사용하는 객체</strong>다. 스프링 부트는 <strong>데이터베이스 커넥션 정보</strong>를 바탕으로 <strong>DataSource를 생성</strong>하고 <strong>스프링 빈</strong>으로 만들어둔다. 그래서 DI를 받을 수 있다.</p><ul><li>개방-폐쇄 원칙(<strong>OCP, Open-Closed Principle</strong>)<ul><li>확장에는 열려있고, 수정, 변경에는 닫혀있다.</ul><li>스프링의 <strong>DI(Dependencies Injection)</strong>을 사용하면 <strong>기존 코드는 전혀 손대지 않고, 설정만으로 구현 클래스를 변경</strong>할 수 있다.<li>데이터를 DB에 저장하므로 스프링 서버를 다시 실행해도 데이터가 안전하게 저장된다.</ul><blockquote><p>객체지향의 진짜 매력은 기존 코드를 변경 없이 인터페이스의 구현체를 교체할 수 있는 것</p></blockquote><h2 id="3강-스프링-통합-테스트">3강. 스프링 통합 테스트</h2><p>스프링 컨테이너와 DB까지 연결한 통합 테스트를 진행한다.</p><p>순수한 자바 코드로 JdbcMemberRepository 테스트 코드를 작성할 수 없다. DB 커넥션도 스프링 부트가 들고 있기 때문이다. 이제부터는 테스트를 스프링과 엮어서 할 것이다.</p><p>스프링 컨테이너에게 MemberService, MemberRepository 내놓으라고 해야 한다. Test는 제일 끝단에 있기 때문에 가장 편한 방법을 사용하면 된다. Test를 다른 곳에서 갖다 쓸 것이 아니라 Test에서 Injection받아서 사용할 것이기 때문이다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">MemberServiceIntegrationTest</span> <span class="o">{</span>

  <span class="nd">@Autowired</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>
	<span class="c1">//..</span>
<span class="o">}</span>
</pre></table></code></div></div><p>다음 테스트에 영향을 주지 않도록 저장공간을 비워주는 <code class="language-plaintext highlighter-rouge">afterEach()</code> 메서드도 삭제한다. 필요가 없기 때문이다.</p><p>보통 Test 전용 DB를 따로 구축을 하거나 로컬 PC에 있는 DB로 테스트를 한다.</p><p>이전 Test에서는 Spring이 뜨지 않았는데 이번에는 뜬다. Test가 끝나면 Spring이 내려간다.</p><p>Test는 반복할 수 있어야 한다. 하지만 지금은 다시 Test를 돌리면 같은 이름으로 회원을 저장할 수 없기 때문에 오류를 던진다. DB는 기본적으로 Transaction이라는 개념이 있다. insert, update, delete를 했다고 바로 DB에 반영이 되는 것이 아니라, <strong>commit을 해야 비로소 DB에 반영이 된다</strong>. auto commit(자동으로 커밋이 됨)을 하냐, 하지 않느냐의 차이지. 테스트가 끝나고 바로 rollback해버리면 DB에 반영이 안 된다.</p><p><code class="language-plaintext highlighter-rouge">@Transactional</code>이라는 애노테이션을 테스트 케이스에 달면, 테스트를 실행할 때 트랜잭션을 먼저 실행하고, DB에 insert 쿼리 등등을 실행한 뒤에 테스트가 끝나면 rollback을 해준다. 그러면 DB에 넣었던 데이터가 반영이 안된다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nd">@SpringBootTest</span>
<span class="nd">@Transactional</span>
<span class="kd">class</span> <span class="nc">MemberServiceIntegrationTest</span> <span class="o">{</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">@SpringBootTest</code>: 스프링 컨테이너와 테스트를 함께 실행한다.<li><code class="language-plaintext highlighter-rouge">@Transactional</code>: 테스트 케이스에 이 애노테이션이 있으면, 테스트 시작 전에 트랜잭션을 시작하고, 테스트 완료 후에 항상 롤백한다. 이렇게 하면 DB에 데이터가 남지 않으므로 다음 테스트에 영향을 주지 않는다. 단 <code class="language-plaintext highlighter-rouge">Service</code>에 <code class="language-plaintext highlighter-rouge">@Transactional</code> 애노테이션을 붙이면 항상 롤백하지 않는다. (다르게 동작한다.)</ul><p>순수하게 자바 코드로 하면서 최소한의 단위로 테스트하는 것을 <strong>단위 테스트</strong>라고 한다. 스프링 컨테이너와 DB까지 연동하는 것을 <strong>통합 테스트</strong>라고 한다. 가급적이면 <strong>스프링 없이 순수한 자바 코드로 단위로 쪼개서 테스트 하는 것이 더 좋은 방법이다.</strong> 스프링 컨테이너까지 올려서 테스트를 하는 경우는 테스트 설계가 잘못되었을 확률이 높다.</p><h2 id="4강-스프링-jdbctemplate">4강. 스프링 JdbcTemplate</h2><p>순수 Jdbc로 개발하기 너무 어려우니까 스프링이 중복을 제거해서 Jdbc Template 이라는 기술을 제공한다. 이걸로 애플리케이션에서 데이터베이스로 sql문을 편리하게 날릴 수 있다.</p><ul><li>순수 Jdbc와 동일한 환경 설정을 하면 된다.<li><strong>스프링 JdbcTemplate과 MyBatis</strong> 같은 라이브러리는 <strong>JDBC API에서 본 반복 코드를 대부분 제거</strong>해준다. 하지만 SQL은 직접 작성해야 한다.</ul><p><strong>스프링 JdbcTemplate 회원 리포지토리</strong></p><ul><li><code class="language-plaintext highlighter-rouge">JdbcTemplate</code> 자체를 주입받을 수는 없다. 대신 <code class="language-plaintext highlighter-rouge">DataSource</code>를 주입받아 <code class="language-plaintext highlighter-rouge">new JdbcTemplate(dataSource)</code>로 생성한다.<li><strong>생성자가 하나만 있으면 <code class="language-plaintext highlighter-rouge">@Autowired</code>를 생략할 수 있다.</strong><li>jdbcTemplate 라이브러리가 기존 JDBC에서 중복 코드를 줄여주었다. Template 이라고 이름 붙인 이유는 디자인 패턴 중<code class="language-plaintext highlighter-rouge">Template Method Pattern</code>을 통해 만들었기 때문이다.<li><code class="language-plaintext highlighter-rouge">save(Member member)</code>: <code class="language-plaintext highlighter-rouge">JdbcTemplate</code> 객체를 넘겨서 만드는 <code class="language-plaintext highlighter-rouge">SimpleJdbcInsert</code> 객체는 재밌는 기능이 있다. 테이블명과 generated 되어야 하는 PK 컬럼명을 넘겨주면 쿼리를 짤 필요가 없다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">hello.hellospring.repository</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JdbcTemplateMemberRepository</span> <span class="kd">implements</span> <span class="nc">MemberRepository</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">JdbcTemplate</span> <span class="n">jdbcTemplate</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">JdbcTemplateMemberRepository</span><span class="o">(</span><span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">jdbcTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JdbcTemplate</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">SimpleJdbcInsert</span> <span class="n">jdbcInsert</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleJdbcInsert</span><span class="o">(</span><span class="n">jdbcTemplate</span><span class="o">);</span>
    <span class="n">jdbcInsert</span><span class="o">.</span><span class="na">withTableName</span><span class="o">(</span><span class="s">"member"</span><span class="o">).</span><span class="na">usingGeneratedKeyColumns</span><span class="o">(</span><span class="s">"id"</span><span class="o">);</span>

    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="n">parameters</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">member</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

    <span class="nc">Number</span> <span class="n">key</span> <span class="o">=</span> <span class="n">jdbcInsert</span><span class="o">.</span><span class="na">executeAndReturnKey</span><span class="o">(</span><span class="k">new</span> <span class="nc">MapSqlParameterSource</span><span class="o">(</span><span class="n">parameters</span><span class="o">));</span>
    <span class="n">member</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">longValue</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">member</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">"select * from where id = ?"</span><span class="o">,</span> <span class="n">memberRowMapper</span><span class="o">(),</span> <span class="n">id</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">findAny</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">"select * from member"</span><span class="o">,</span> <span class="n">memberRowMapper</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">"select * from member where name = ?"</span><span class="o">,</span> <span class="n">memberRowMapper</span><span class="o">(),</span> <span class="n">name</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">findAny</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="c1">// 객체 생성에 대한 일은 여기서 한다.</span>
  <span class="kd">private</span> <span class="nc">RowMapper</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">memberRowMapper</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">rs</span><span class="o">,</span> <span class="n">rowNum</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">();</span>
      <span class="n">member</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="s">"id"</span><span class="o">));</span>
      <span class="n">member</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>
      <span class="k">return</span> <span class="n">member</span><span class="o">;</span>
    <span class="o">};</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><strong>JdbcTemplate을 사용하도록 스프링 설정 변경</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">hello.hellospring</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>

  <span class="nd">@Autowired</span>
  <span class="kd">public</span> <span class="nf">SpringConfig</span><span class="o">(</span><span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">MemberService</span> <span class="nf">memberService</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">MemberService</span><span class="o">(</span><span class="n">memberRepository</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">MemberRepository</span> <span class="nf">memberRepository</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">//return new MemoryMemberRepository();</span>
    <span class="c1">//return new JdbcMemberRepository(dataSource);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">JdbcTemplateMemberRepository</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><blockquote><p>실무에서 프로덕션 코드를 짜는 시간보다 테스트 코드를 작성하는 시간이 더 길다. 거의 60~70퍼센트 정도 된다. 작은 버그 하나가 수억, 수십억의 피해로 돌아오기 때문이다.</p></blockquote><h2 id="5강-jpa">5강. JPA</h2><ul><li>JPA는 기존의 반복 코드는 물론이고, <strong>기본적인 SQL도 JPA가 직접 만들어서 실행</strong>해준다. JdbcTemplate 을 사용하면서 중복 코드는 줄었지만 여전히 SQL문은 개발자가 직접 작성해야 한다. 그러나 JPA 기술을 사용하면 SQL 쿼리도 JPA가 자동으로 처리해준다. 마치 우리가 MemoryMemberRepository에서 메모리에 객체를 넣듯이, 객체를 JPA에 집어넣으면 JPA가 중간에서 DB에 SQL을 날리고 데이터를 DB에서 가져오는 것을 처리해준다.<li>JPA를 사용하면, <strong>SQL과 데이터 중심의 설계에서 객체 중심의 설계로 패러다임을 전환</strong>할 수 있다.<li>JPA를 사용하면 개발 생산성을 크게 높일 수 있다.<li>JPA(Java Persistance API)와 비교되는 것이 MyBatis 프레임워크이다. 국내에서는 JPA와 MyBatis의 인지도가 비슷하지만, 전 세계에서 보면 JPA가 MyBatis와 비교도 안 되게 많이 사용된다.<li>JPA도 스프링만큼 성숙한 기술이고(나온 시기가 비슷하다), 학습해야 할 분량도 방대하다. 스프링도 JPA를 많이 지원한다. 특히 스프링 프레임워크에서 제공하는 관계형 데이터베이스 관련 예제들은 대개 JPA를 사용한다.</ul><p><strong>build.gradle 파일에 JPA, h2 데이터베이스 관련 라이브러리 추가</strong></p><div class="language-groovy highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">dependencies</span> <span class="o">{</span>
	<span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-thymeleaf'</span>
	<span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-web'</span>
	<span class="c1">//implementation 'org.springframework.boot:spring-boot-starter-jdbc'</span>
	<span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-data-jpa'</span>
	<span class="n">runtimeOnly</span> <span class="s1">'com.h2database:h2'</span>
	<span class="n">testImplementation</span><span class="o">(</span><span class="s1">'org.springframework.boot:spring-boot-starter-test'</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">exclude</span> <span class="nl">group:</span> <span class="s1">'org.junit.vintage'</span><span class="o">,</span> <span class="nl">module:</span> <span class="s1">'junit-vintage-engine'</span>
	<span class="o">}</span>
</pre></table></code></div></div><p><strong><code class="language-plaintext highlighter-rouge">spring-boot-starter-data-jpa</code></strong>는 <strong>내부에 jdbc 관련 라이브러리를 포함</strong>한다. 따라서 jdbc는 <strong>제거해도 된다.</strong></p><p>JPA는 인터페이스(표준)이다. 이 JPA의 구현체로 Hibernate, Eclipse 등 여러 개의 벤더가 있는데, 그 중 거의 Hibernate를 많이 사용한다. <code class="language-plaintext highlighter-rouge">spring-boot-starter-data-jpa</code>를 작성하면 hibernate가 자동으로 의존 라이브러리에 추가된다.</p><p><strong>스프링 부트에 JPA 설정 추가</strong></p><p><code class="language-plaintext highlighter-rouge">resouces/application.properties</code></p><div class="language-properties highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="py">spring.datasource.url</span><span class="p">=</span><span class="s">jdbc:h2:tcp://localhost/~/test</span>
<span class="py">spring.datasource.driver-class-name</span><span class="p">=</span><span class="s">org.h2.Driver</span>
<span class="py">spring.datasource.username</span><span class="p">=</span><span class="s">sa</span>
<span class="py">spring.jpa.show-sql</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.jpa.hibernate.ddl-auto</span><span class="p">=</span><span class="s">none</span>
</pre></table></code></div></div><blockquote><p>스프링부트 2.4부터는 <code class="language-plaintext highlighter-rouge">spring-datasource.username=sa</code>를 꼭 추가해줘야 한다. 그렇지 않으면 오류가 발생한다.</p></blockquote><ul><li><code class="language-plaintext highlighter-rouge">show-sql</code>: <strong>JPA가 생성하는 SQL을 출력</strong>한다.<li><code class="language-plaintext highlighter-rouge">ddl-auto</code>: JPA는 <strong>테이블을 자동으로 생성</strong>하는 기능을 제공한다. 그러나 우리는 만들어진 테이블을 사용할 것이기 때문에 <code class="language-plaintext highlighter-rouge">none</code>를 사용하여 해당 기능을 끈다.<ul><li><code class="language-plaintext highlighter-rouge">create</code>을 사용하면 <strong>엔티티 정보를 바탕으로 테이블도 직접 생성</strong>해준다.</ul></ul><p><strong>JPA 엔티티 매핑</strong></p><p>JPA는 객체와 ORM(Object Relational Mapping; 객체-관계 매핑) 기술이다. ORM이란 <strong>객체와 관계형 데이터베이스의 데이터</strong>를 <strong>자동으로 매핑(연결)해주는 것</strong>을 말한다. 객체 모델과 관계형 모델 간에 불일치가 존재하는데, ORM을 통해 객체 간의 관계를 바탕으로 SQL을 자동으로 생성하여 불일치를 해결한다. 이 <strong>매핑은 Annotation으로 만들어준다.</strong></p><ul><li><code class="language-plaintext highlighter-rouge">@Entity</code>: 객체에 이 애노테이션을 붙이면 JPA가 관리하는 Entity가 된다.<li><code class="language-plaintext highlighter-rouge">@Id</code>: PK를 매핑<li><code class="language-plaintext highlighter-rouge">@GeneratedValue(strategy=GenerationType.IDENTITY)</code>: DB에서 생성되는 값 (Identity: DB가 알아서 생성해주는 것)<li><code class="language-plaintext highlighter-rouge">@Column(name="username")</code>: 객체 필드명(name)과 컬럼명(username)이 다르다면 이 애노테이션으로 매핑한다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">hello.hellospring.domain</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="o">{</span>
    <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><strong>JPA 회원 리포지토리</strong></p><ul><li><strong>JPA를 쓰려면 EntityManager를 주입받아야 한다.</strong><li><code class="language-plaintext highlighter-rouge">EntityManager</code>: JPA는 EntityManager로 모든 것이 동작한다. <code class="language-plaintext highlighter-rouge">spring-boot-starer-data-jpa</code> 라이브러리를 다운받으면 스프링부트가 EntityManager를 자동으로 만들어준다. Entity Manager는 스프링이 <code class="language-plaintext highlighter-rouge">properties</code> 정보와 데이터베이스 커넥션 정보를 기반으로 현재 데이터베이스랑 연결을 해놓은 것이다. 그럼 이렇게 만들어진 EntityManager를 주입받으면 된다.<li>EntityManager는 dataSource 객체 등을 내부적으로 가지고 있다. 따라서 DB와 통신하는 것을 다 처리한다.<li><code class="language-plaintext highlighter-rouge">persist()</code>: 영속하다. 영구 저장하다. JPA 내부적으로 insert 해주고 Generated된 PK를 <code class="language-plaintext highlighter-rouge">setId()</code>를 호출하여 셋팅하는 일까지 해준다.<li><code class="language-plaintext highlighter-rouge">find()</code>: PK로 조회하는 것을 이 메서드를 사용하면 된다.<li><code class="language-plaintext highlighter-rouge">createQuery("select m from m", Member.class)</code>: PK로 조회하는 것이 아니라면 JPQL이라는 객체지향 쿼리를 써야 한다. SQL은 테이블을 대상으로 쿼리를 날리지만, JPQL은 Entity를 대상으로 쿼리를 날린다는 게 차이점이다. 이때, <code class="language-plaintext highlighter-rouge">select * from Member m</code>이 아니라 <code class="language-plaintext highlighter-rouge">select m from Member m</code>으로 객체 자체를 select한다.<li>한편 스프링 데이터 JPA를 사용하면 findAll, findByName를 작성할 때 createQuery를 사용하지 않아도 된다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">hello.hellospring.repository</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaMemberRepository</span> <span class="kd">implements</span> <span class="nc">MemberRepository</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">EntityManager</span> <span class="n">em</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">JpaMemberRepository</span><span class="o">(</span><span class="nc">EntityManager</span> <span class="n">em</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">em</span> <span class="o">=</span> <span class="n">em</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// persist: 영속하다. 영구저장하다.</span>
    <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">member</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select m from Member m"</span><span class="o">,</span> <span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select m from Member m where m.name = :name"</span><span class="o">,</span> <span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span>
            <span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">findAny</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>서비스 계층에 트랜잭션 추가</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberService</span> <span class="o">{</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">org.springframework.transaction.annotation.Transactional</code>을 사용한다.<li>스프링은 해당 클래스의 메서드를 실행할 때 트랜잭션을 시작하고, 메서드가 정상 종료되면 트랜잭션을 커밋한다. 만약 런타임 예외가 발생하면 롤백한다.<li><strong>JPA를 통한 모든 데이터 변경은 트랜잭션 안에서 실행해야 한다.</strong></ul><p><strong>JPA를 사용하도록 스프링 설정 변경</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">hello.hellospring</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">EntityManager</span> <span class="n">em</span><span class="o">;</span>

  <span class="nd">@Autowired</span>
  <span class="kd">public</span> <span class="nf">SpringConfig</span><span class="o">(</span><span class="nc">EntityManager</span> <span class="n">em</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">em</span> <span class="o">=</span> <span class="n">em</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">MemberService</span> <span class="nf">memberService</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">MemberService</span><span class="o">(</span><span class="n">memberRepository</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">MemberRepository</span> <span class="nf">memberRepository</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">//return new MemoryMemberRepository();</span>
    <span class="c1">//return new JdbcMemberRepository(dataSource);</span>
    <span class="c1">//return new JdbcTemplateMemberRepository(dataSource);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">JpaMemberRepository</span><span class="o">(</span><span class="n">em</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><h2 id="6강-스프링-데이터-jpa">6강. 스프링 데이터 JPA</h2><p>스프링 부트와 JPA만 사용해도 개발 생산성이 정말 많이 증가하고, 개발해야 할 코드도 확연히 줄어든다. 여기에 스프링 데이터 JPA를 사용하면, 기존의 한계를 넘어 마치 마법처럼, 리포지토리에 구현 클래스 없이 인터페이스만으로 개발을 완료할 수 있다. 그리고 반복 개발해온 CRUD 기능도 스프링 데이터 JPA가 모두 제공한다.</p><p>스프링 부트와 JPA라는 기반 위에, 스프링 데이터 JPA라는 환상적인 프레임워크를 더하면 개발이 정말 즐거워진다. 지금까지 조금이라도 단순하고 반복이라 생각했던 개발 코드들이 확연하게 줄어든다. 따라서 개발자는 핵심 비즈니스 로직을 개발하는 데 집중할 수 있다.</p><p>실무에서 관계형 데이터베이스를 사용한다면 스프링 데이터 JPA는 선택이 아니라 필수이다.</p><p>한편 스프링 데이터 JPA는 JPA를 편리하게 사용하도록 도와주는 기술이다. 따라서 JPA를 먼저 학습한 후에 스프링 데이터 JPA를 학습해야 한다.</p><ul><li>앞의 JPA 설정을 그대로 사용한다.</ul><p><strong>스프링 데이터 JPA 회원 리포지토리</strong></p><ul><li>interface가 interface를 받을 때는 implements가 아니라 extends 를 사용한다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">hello.hellospring.repository</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SpringDataJpaMemberRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="cm">/*Entity*/</span><span class="o">,</span> <span class="nc">Long</span><span class="cm">/*PK:id*/</span><span class="o">&gt;,</span> <span class="nc">MemberRepository</span> <span class="o">{</span>
  
  <span class="c1">// JPQL select m from Member m where m.name = ?</span>
  <span class="nd">@Override</span>
  <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span>

</pre></table></code></div></div><p><strong>스프링 데이터 JPA 회원 리포지토리를 사용하도록 스프링 설정 변경</strong></p><p><code class="language-plaintext highlighter-rouge">memberRepository</code>를 주입받게 만들면 스프링 데이터 JPA가 만들어놓은 구현체가 등록이 된다. 우리가 만든 것은 <code class="language-plaintext highlighter-rouge">SpringDataJpaMemberRepository</code> 인터페이스이다. 인터페이스를 생성하고 이 인터페이스가 <code class="language-plaintext highlighter-rouge">JpaRepository</code>를 상속하게 만들면 스프링 데이터 JPA가 인터페이스에 대한 구현체를 만들어주고, 스프링 빈에 등록을 한다. 그래서 우리는 Injection을 받을 수 있다. 주입을 받아서</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">hello.hellospring</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>

  <span class="nd">@Autowired</span> <span class="c1">// 생략가능</span>
  <span class="kd">public</span> <span class="nf">SpringConfig</span><span class="o">(</span><span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">memberRepository</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">MemberService</span> <span class="nf">memberService</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">MemberService</span><span class="o">(</span><span class="n">memberRepository</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p><strong>스프링 데이터 JPA가 <code class="language-plaintext highlighter-rouge">SpringDataJpaMemberRepository</code>를 스프링 빈으로 자동 등록해준다.</strong></p><p><strong>스프링 데이터 JPA 제공 클래스</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/105063817-89acf900-5abf-11eb-8418-d343c88b1259.png" alt="image" /></p><p><strong>스프링 데이터 JPA 제공 기능</strong></p><ul><li><p>인터페이스를 통한 기본적인 CRUD</p><li><p><code class="language-plaintext highlighter-rouge">findByName()</code>, <code class="language-plaintext highlighter-rouge">findByEmail()</code>처럼 메서드 이름만으로 조회 기능 제공</p><p>JpaRepository에 있는 메서드는 공통적인 메서드이다. <code class="language-plaintext highlighter-rouge">findByName()</code>, <code class="language-plaintext highlighter-rouge">findByEmail()</code>의 경우 비즈니즈가 다르기 때문에 공통화할 수 없을 것이다. 그래서 공통 클래스로 제공할 수 없다. 인터페이스에 <code class="language-plaintext highlighter-rouge">findByName(String name);</code> 를 작성하면 JPQL 코드<code class="language-plaintext highlighter-rouge">select m from Member m where m.name = ?</code>로 바꿔준다. 이렇게 인터페이스 이름만으로 개발이 끝날 수 있다. 복잡한 쿼리는 다른 해결방법이 있다. 그러나 단순한 기능은 이 방법으로 끝낼 수 있다.</p><p>실제로는 스프링 데이터 JPA가 메서드 이름과 반환 타입, 파라미터를 Reflection 기술로 읽어서 풀어내는 과정이 내부적으로 동작한다.</p><li><p>페이징 기능 자동 제공</p></ul><p>실무에서는 <strong>JPA와 스프링 데이터 JPA를 기본으로 사용</strong>하고, <strong>복잡한 동적 쿼리</strong>는 <strong>Querydsl</strong>이라는 라이브러리를 사용하면 된다. Querydsl을 사용하면 <strong>쿼리도 자바 코드로 안전하게 작성</strong>할 수 있고, <strong>동적 쿼리</strong>도 편리하게 작성할 수 있다.</p><p><strong>이 조합으로 해결하기 어려운 쿼리는 JPA가 제공하는 네이티브 쿼리를 사용</strong>하거나, 앞서 학습한 스프링 <strong>JdbcTemplate</strong>을 사용하면 된다. Hibernate 기술 만든 사람도 100% ORM 방식으로 해결하라고 개발한 것이 아니라고 말한다. 따라서 ORM 방식에서도 native 쿼리를 사용할 수 있도록 열어놓았다. 필요하면 앞서 JdbcTemplate을 섞어 사용하거나 Mybatis 를 섞어 사용해도 된다!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/spring/'>spring</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=스프링 입문 #6 스프링 DB 접근 기술 - 하연&url=https://hayeon17kim.github.io//posts/spring-basic-06/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=스프링 입문 #6 스프링 DB 접근 기술 - 하연&u=https://hayeon17kim.github.io//posts/spring-basic-06/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=스프링 입문 #6 스프링 DB 접근 기술 - 하연&url=https://hayeon17kim.github.io//posts/spring-basic-06/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/system-deisign-capacity-estimation/">System Design: Capacity Estimate</a><li><a href="/posts/today-i-learned-2021-04-27/">주니어 성장일기: 2021.04.27</a><li><a href="/posts/today-i-learned-2021-04-26/">주니어 성장일기: 2021.04.26</a><li><a href="/posts/fastcampus-01/">자료구조와 알고리즘이란</a><li><a href="/posts/today-i-learned-2021-04-25/">주니어 성장일기: 2021.04.25</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/bitcamp/">bitcamp</a> <a class="post-tag" href="/tags/modernjs/">modernJS</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/trouble-shooting/">trouble-shooting</a> <a class="post-tag" href="/tags/devil/">devil</a> <a class="post-tag" href="/tags/corejs/">corejs</a> <a class="post-tag" href="/tags/network/">network</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/spring-basic-01/"><div class="card-body"> <span class="timeago small" > Jan 11 <i class="unloaded">2021-01-11T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 입문 #1 프로젝트 환경설정</h3><div class="text-muted small"><p> Section 1. 프로젝트 환경설정 1강. 프로젝트 생성 스프링 부트 스타터 사이트에서 스프링 프로젝트를 생성하였다. 프로젝트 선택 Project: Gradle Project (요즘에는 Maven보다 Gradle을 더 많이 사용하는 추세이다.) Spring Boot: 2.3.x Language: J...</p></div></div></a></div><div class="card"> <a href="/posts/spring-basic-02/"><div class="card-body"> <span class="timeago small" > Jan 12 <i class="unloaded">2021-01-12T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 입문 #2 스프링 웹 개발 기초</h3><div class="text-muted small"><p> Section 2: 스프링 웹 개발 기초 웹 개발에는 크게 정적 컨텐츠, MVC와 템플릿 엔진, API의 세 가지 방법이 있다. 정적 컨텐츠: 서버에서 하는 일 없이 서버에서 파일을 그대로 내려준다. MVC와 템플릿 엔진: 가장 많이 사용하는 방식이다. JSP, PHP 등이 템플릿 엔진이다. 정적 컨텐츠는 그냥 파일을 그대로 웹브라우저에게...</p></div></div></a></div><div class="card"> <a href="/posts/spring-basic-03/"><div class="card-body"> <span class="timeago small" > Jan 13 <i class="unloaded">2021-01-13T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 입문 #3 회원관리 예제: 백엔드 개발</h3><div class="text-muted small"><p> Section 3. 회원관리 예제: 백엔드 개발 1강. 비즈니스 요구사항 정리 데이터: 회원ID, 이름 기능: 회원 등록, 조회 아직 데이터 저장소가 선정되지 않음(가상의 시나리오) 따라서 우선 인터페이스(MemberRepository)로 구현 클래스(MemoryMemberRepositor...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/modern-js-0304/" class="btn btn-outline-primary" prompt="Older"><p>모던 자바스크립트 #3.4. 닌자 코드</p></a> <a href="/posts/modern-js-0305/" class="btn btn-outline-primary" prompt="Newer"><p>모던 자바스크립트 #3.5. 테스트 자동화와 Mocha</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Loading comments from <a href="https://disqus.com/">Disqus</a> ...</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//hayeon17kim-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = '스프링 입문 #6 스프링 DB 접근 기술'; this.page.url = 'https://hayeon17kim.github.io//posts/spring-basic-06/'; this.page.identifier = '/posts/spring-basic-06/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/MONI56219559">hayeon_kim</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/bitcamp/">bitcamp</a> <a class="post-tag" href="/tags/modernjs/">modernJS</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/trouble-shooting/">trouble shooting</a> <a class="post-tag" href="/tags/devil/">devil</a> <a class="post-tag" href="/tags/corejs/">corejs</a> <a class="post-tag" href="/tags/network/">network</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://hayeon17kim.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
