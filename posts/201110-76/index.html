<!DOCTYPE html><html lang="kr-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="학원 #76일차: 프로젝트에 MyBatis 적용: MyBatis가 join 결과를 다루는 방법, 프로그램에서 사용하는 객체를 listener에서 준비시키기, sqlSessionFactory 공유," /><meta name="author" content="hayeon_kim" /><meta property="og:locale" content="kr_KR" /><meta name="description" content="지난 시간에는 BoardDaoImpl에 Mybatis를 일부 적용하였다. BoardDaoImpl의 SQL을 뜯어내어 BoardMapper.xml로 옮기고, JDBC 코드를 Mybatis 클래스로 대체하였다. 그리고 mybatis-config.xml에 BoardMapper 파일의 경로를 등록하였다." /><meta property="og:description" content="지난 시간에는 BoardDaoImpl에 Mybatis를 일부 적용하였다. BoardDaoImpl의 SQL을 뜯어내어 BoardMapper.xml로 옮기고, JDBC 코드를 Mybatis 클래스로 대체하였다. 그리고 mybatis-config.xml에 BoardMapper 파일의 경로를 등록하였다." /><link rel="canonical" href="https://hayeon17kim.github.io//posts/201110-76/" /><meta property="og:url" content="https://hayeon17kim.github.io//posts/201110-76/" /><meta property="og:site_name" content="하연" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-10T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="학원 #76일차: 프로젝트에 MyBatis 적용: MyBatis가 join 결과를 다루는 방법, 프로그램에서 사용하는 객체를 listener에서 준비시키기, sqlSessionFactory 공유," /><meta name="twitter:site" content="@MONI56219559" /><meta name="twitter:creator" content="@hayeon_kim" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"hayeon_kim"},"headline":"학원 #76일차: 프로젝트에 MyBatis 적용: MyBatis가 join 결과를 다루는 방법, 프로그램에서 사용하는 객체를 listener에서 준비시키기, sqlSessionFactory 공유,","dateModified":"2020-11-10T00:00:00+08:00","datePublished":"2020-11-10T00:00:00+08:00","description":"지난 시간에는 BoardDaoImpl에 Mybatis를 일부 적용하였다. BoardDaoImpl의 SQL을 뜯어내어 BoardMapper.xml로 옮기고, JDBC 코드를 Mybatis 클래스로 대체하였다. 그리고 mybatis-config.xml에 BoardMapper 파일의 경로를 등록하였다.","url":"https://hayeon17kim.github.io//posts/201110-76/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hayeon17kim.github.io//posts/201110-76/"},"@context":"https://schema.org"}</script><title>학원 #76일차: 프로젝트에 MyBatis 적용: MyBatis가 join 결과를 다루는 방법, 프로그램에서 사용하는 객체를 listener에서 준비시키기, sqlSessionFactory 공유, | 하연</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-173202420-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-173202420-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/bio-photo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">하연</a></div><div class="site-subtitle font-italic">어제보다 나은 코드를 위해</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-laptop-code ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/hayeon17kim" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/MONI56219559" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hayeon17kim','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>학원 #76일차: 프로젝트에 MyBatis 적용: MyBatis가 join 결과를 다루는 방법, 프로그램에서 사용하는 객체를 listener에서 준비시키기, sqlSessionFactory 공유,</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>학원 #76일차: 프로젝트에 MyBatis 적용: MyBatis가 join 결과를 다루는 방법, 프로그램에서 사용하는 객체를 listener에서 준비시키기, sqlSessionFactory 공유,</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Nov 10, 2020, 12:00 AM +0800" > Nov 10, 2020 <i class="unloaded">2020-11-10T00:00:00+08:00</i> </span> by <span class="author"> hayeon_kim </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5632 words">31 min</span></div></div><div class="post-content"><p>지난 시간에는 <code class="language-plaintext highlighter-rouge">BoardDaoImpl</code>에 Mybatis를 일부 적용하였다. <code class="language-plaintext highlighter-rouge">BoardDaoImpl</code>의 SQL을 뜯어내어 <code class="language-plaintext highlighter-rouge">BoardMapper.xml</code>로 옮기고, JDBC 코드를 <code class="language-plaintext highlighter-rouge">Mybatis</code> 클래스로 대체하였다. 그리고 <code class="language-plaintext highlighter-rouge">mybatis-config.xml</code>에 <code class="language-plaintext highlighter-rouge">BoardMapper</code> 파일의 경로를 등록하였다.</p><p>오늘 수업에서는 <code class="language-plaintext highlighter-rouge">MemberDaoImpl</code>과 <code class="language-plaintext highlighter-rouge">ProjectDaoImpl</code>, <code class="language-plaintext highlighter-rouge">TaskDaoImpl</code>도 SLQ을 뜯어내어 <code class="language-plaintext highlighter-rouge">XxxMaper.xml</code>로 옮기고, JDBC 코드를 <code class="language-plaintext highlighter-rouge">Mybatis</code> 클래스로 대체하였다. 다만 <code class="language-plaintext highlighter-rouge">BoardDaoImpl</code>과 다르게 다른 테이블과의 연관성 때문에 <code class="language-plaintext highlighter-rouge">BoardDaoImpl</code>을 해체하는 작업보다는 난이도가 있었다.</p><p>한편, <code class="language-plaintext highlighter-rouge">BoardDaoImpl</code> 에서는 <code class="language-plaintext highlighter-rouge">SqlSessionFactory</code>를 각 메서드마다 준비하였는데, 이를 이를 <code class="language-plaintext highlighter-rouge">AppInitListner</code>에서 준비하도록 바꿔주었다.</p><h3 id="실습">실습</h3><h4 id="3단계-boarddaoimpl에-mybatis-적용">3단계: <code class="language-plaintext highlighter-rouge">BoardDaoImpl</code>에 <code class="language-plaintext highlighter-rouge">Mybatis</code> 적용</h4><p>Object 타입 자리에 원시타입 no가 오면, 컴파일러가 박싱하는 것이 아니라 컴파일러는 <code class="language-plaintext highlighter-rouge">Integer.valueOf(no)</code> 코드로 바꿔준다.</p><p><strong>BoardMapper.findByNo</strong></p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findByNo"</span> 
    <span class="na">parameterType=</span><span class="s">"java.lang.Integer"</span> 
    <span class="na">resultMap=</span><span class="s">"BoardMap"</span><span class="nt">&gt;</span>
    select
	    b.no,
	    b.title,
	    b.content,
	    b.cdt,
	    b.vw_cnt,
	    m.no writer_no,
	    m.name
    from 
      pms_board b inner join pms_member m on b.writer=m.no
    where b.no = #{no}
  <span class="nt">&lt;/select&gt;</span>
</pre></table></code></div></div><p>이때 property 이름과 똑같은 이름의 컬럼이 되도록 다음과 같이 별명을 붙인다.</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findByNo"</span> 
    <span class="na">parameterType=</span><span class="s">"java.lang.Integer"</span> 
    <span class="na">resultType=</span><span class="s">"com.eomcs.pms.domain.Board"</span><span class="nt">&gt;</span>
    select
	    b.no,
	    b.title,
	    b.content,
	    b.cdt registeredDate,
	    b.vw_cnt viewCount,
	    m.no writer_no,
	    m.name
    from 
      pms_board b inner join pms_member m on b.writer=m.no
    where b.no = #{no}
  <span class="nt">&lt;/select&gt;</span>
</pre></table></code></div></div><p>그러나 SQL문을 쓸 때마다 이렇게 별명을 지정하기는 귀찮다. <code class="language-plaintext highlighter-rouge">&lt;resultMap&gt;</code>에 미리 정의해두면 사용하기 편하다. 즉 <strong>컬럼-프로퍼티의 연결 정보</strong>를 정의한다.</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>  <span class="nt">&lt;resultMap</span> <span class="na">type=</span><span class="s">"com.eomcs.pms.domain.Board"</span> <span class="na">id=</span><span class="s">"BoardMap"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">"no"</span>           <span class="na">property=</span><span class="s">"no"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"title"</span>    <span class="na">property=</span><span class="s">"title"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"content"</span>  <span class="na">property=</span><span class="s">"content"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"cdt"</span>      <span class="na">property=</span><span class="s">"registeredDate"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"vw_cnt"</span>   <span class="na">property=</span><span class="s">"viewCount"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">"writer"</span> <span class="na">javaType=</span><span class="s">"com.eomcs.pms.domain.Member"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">"writer_no"</span>    <span class="na">property=</span><span class="s">"no"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"name"</span>     <span class="na">property=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/association&gt;</span>
  <span class="nt">&lt;/resultMap&gt;</span>
</pre></table></code></div></div><p>이제 <code class="language-plaintext highlighter-rouge">&lt;select&gt;</code> 속성을 <code class="language-plaintext highlighter-rouge">resultType</code>이 아니라 위의 <code class="language-plaintext highlighter-rouge">resultMap="BoardMap"</code>으로 지정한다.</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findByNo"</span> <span class="na">parameterType=</span><span class="s">"java.lang.Integer"</span> <span class="na">resultMap=</span><span class="s">"BoardMap"</span><span class="nt">&gt;</span>
</pre></table></code></div></div><p>한편, <code class="language-plaintext highlighter-rouge">#{값}</code>에서 <code class="language-plaintext highlighter-rouge">값</code>은 아무 이름이나 지정해도 상관 없다. <code class="language-plaintext highlighter-rouge">#{}</code>문법은 JDBC에서 <code class="language-plaintext highlighter-rouge">?</code> 형태로 파라미터를 전달하는 것과 같이 작동한다.</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>where b.no= #{ohora}
</pre></table></code></div></div><p><strong>BoardDaoImpl.detail()</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>  <span class="kd">public</span> <span class="nc">Board</span> <span class="nf">findByNo</span><span class="o">(</span><span class="kt">int</span> <span class="n">no</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// mybatis 객체 준비</span>

    <span class="c1">// =&gt; mybatis 설정 파일을 읽어 입력 스트림을 준비한다.</span>
    <span class="c1">// 입력 스트림에서 mybatis 설정 값을 읽어 SqlSessionFactory를 만든다.</span>
    <span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span> 
    <span class="o">=</span> <span class="k">new</span> <span class="nc">SqlSessionFactoryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">(</span><span class="nc">Resources</span><span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">"com/eomcs/pms/conf/mybatis/-config.xml"</span><span class="o">));</span>

    <span class="c1">// =&gt; SqlSessionFactory에서 SqlSession 객체를 얻는다.</span>
    <span class="c1">//    SqlSession 객체는 SQL문을 실행하는 객체다.</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">Board</span> <span class="n">board</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">selectOne</span><span class="o">(</span><span class="s">"BoardDao.findByNo"</span><span class="o">,</span> <span class="n">no</span><span class="o">);</span>
      <span class="n">sqlSession</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">"BoardDao.updateViewCount"</span><span class="o">,</span> <span class="n">no</span><span class="o">);</span>
      <span class="c1">// SqlSession 객체에게 별도 파일에 분리한 SQL을 찾아 실행하라고 말한다.</span>
      <span class="k">return</span> <span class="n">board</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
</pre></table></code></div></div><p>여기서 어차피 <code class="language-plaintext highlighter-rouge">update</code>는 한 번만 하기 때문에 오토커밋을 true로 바꾼다.</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>  <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">"updateViewCount"</span> <span class="na">parameterType=</span><span class="s">"java.lang.Integer"</span><span class="nt">&gt;</span>
    update pms_board set 
      vw_cnt = vw_cnt + 1
    where no = #{no}
  <span class="nt">&lt;/update&gt;</span>
</pre></table></code></div></div><p><strong>BoardDaoImpl.update()</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Board</span> <span class="n">board</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SqlSessionFactoryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">(</span>
        <span class="nc">Resources</span><span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">"com/eomcs/pms/conf/mybatis-config.xml"</span><span class="o">));</span>

    <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">"BoardDao.update"</span><span class="o">,</span> <span class="n">board</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
</pre></table></code></div></div><p><strong>BoardMapper.update</strong></p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c">&lt;!-- update는 무조건 int니까 resultType을 적지 않아도 된다. --&gt;</span>
	<span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">"update"</span> <span class="na">parameterType=</span><span class="s">"com.eomcs.pms.domain.Board"</span><span class="nt">&gt;</span>
		update pms_board set
		title =#{title},
		content=#{content},
		where no = #{no}
	<span class="nt">&lt;/update&gt;</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">update</code>의 경우 <code class="language-plaintext highlighter-rouge">resultType</code>을 개발자들이 임의로 지정할 수 있으니 이를 아예 막아놨다. <code class="language-plaintext highlighter-rouge">update</code>는 무조건 <code class="language-plaintext highlighter-rouge">int</code>를 리턴하도록 프로그래밍 되어 있다.</p><h4 id="4단계-app에서-사용하는-객체를-appinitlistener에서-모두-준비한다">4단계: <code class="language-plaintext highlighter-rouge">App</code>에서 사용하는 객체를 <code class="language-plaintext highlighter-rouge">AppInitListener</code>에서 모두 준비한다</h4><p>현재 <code class="language-plaintext highlighter-rouge">BoardDaoImpl</code>에서는 <code class="language-plaintext highlighter-rouge">SqlSession</code> 객체를 생성하는 객체인 <code class="language-plaintext highlighter-rouge">SqlSessionFactory</code> 객체를 다음과 같이 각 메서드마다 준비하였다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoardDaoImpl</span> <span class="kd">implements</span> <span class="n">com</span><span class="o">.</span><span class="na">eomcs</span><span class="o">.</span><span class="na">pms</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">BoardDao</span><span class="o">{</span>

  <span class="nc">Connection</span> <span class="n">con</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">BoardDaoImpl</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">con</span> <span class="o">=</span> <span class="n">con</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">insert</span><span class="o">(</span><span class="nc">Board</span> <span class="n">board</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="nc">Resources</span><span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span>
        <span class="s">"com/eomcs/pms/conf/mybatis-config.xml"</span><span class="o">);</span>
    <span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nf">SqlSessionFactoryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">(</span><span class="n">inputStream</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span> <span class="o">{</span>

      <span class="k">return</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"BoardDao.insert"</span><span class="o">,</span> <span class="n">board</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">no</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SqlSessionFactoryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">(</span>
        <span class="nc">Resources</span><span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">"com/eomcs/pms/conf/mybatis-config.xml"</span><span class="o">));</span>

    <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="s">"BoardDao.delete"</span><span class="o">,</span> <span class="n">no</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">//,,,,</span>
</pre></table></code></div></div><p>현재 각 메서드마다 <code class="language-plaintext highlighter-rouge">sqlFactory</code>를 빌드하고 있다. <code class="language-plaintext highlighter-rouge">mybatis-config.xml</code> 경로를 <code class="language-plaintext highlighter-rouge">InputStream </code> <code class="language-plaintext highlighter-rouge">Resources.getResourceAsStream()</code>의 파라미터로 받아 <code class="language-plaintext highlighter-rouge">inputStream</code> 객체를 리턴받고, 리턴받은 객체를 <code class="language-plaintext highlighter-rouge">SqlSessionFactoryBuilder</code> 객체의 <code class="language-plaintext highlighter-rouge">build()</code> 메서드의 파라미터로 넘기고 <code class="language-plaintext highlighter-rouge">SqlSessionFactory</code> 객체를 리턴받아 <code class="language-plaintext highlighter-rouge">SqlSession</code> 객체를 생성하고 있다. <strong><code class="language-plaintext highlighter-rouge">sqlSession</code>은 커밋과 관련되어 있기 때문에 다른 메서드와 공유할 수 없다.</strong> 대신 <code class="language-plaintext highlighter-rouge">sqlSessionFactory</code>를 공유한다.</p><blockquote><p><strong>SqlSessionFactoryBuilder</strong>: 이 클래스는 인스턴스화되어 사용되고 던져질 수 있다. <code class="language-plaintext highlighter-rouge">SqlSEssionFactory</code>를 생성한 후 유지할 필요는 없다. 따라서 가장 좋은 스코프는 메서드 스코프(지역변수)이다. 여러 개의 <code class="language-plaintext highlighter-rouge">SqlSessionFactory</code> 인스턴스를 빌드하기 위해 <code class="language-plaintext highlighter-rouge">SqlSessionFactoryBuilder</code>를 재사용할 수는 있지만 유지하지 않는 것이 좋다.</p></blockquote><blockquote><p><strong>SqlSessionFactory</strong>: 한 번 만든 뒤 <code class="language-plaintext highlighter-rouge">SqlSessionFactory</code>는 <strong>애플리케이션을 실행하는 동안 존재</strong>하여야 한다. 그래서 삭제하거나 재생성할 필요가 없다. 애플리케이션이 실행되는 동안 <strong>여러 차례 <code class="language-plaintext highlighter-rouge">SqlSessionFactory</code>를 다시 빌드하지 않는 것이 가장 좋은 형태</strong>이다. <code class="language-plaintext highlighter-rouge">SqlSessionFactory</code>의 가장 좋은 스코프는 <strong>애플리케이션 스코프</strong>이다. 애플리케이션 스코프로 유지하기 위해서는 싱글턴 패턴이나 <code class="language-plaintext highlighter-rouge">static </code> 싱글턴 패턴을 사용하는 방법, 또는 구글 쥬스나 스프링과 같은 의존성 삽입 컨테이너는 <code class="language-plaintext highlighter-rouge">SqlSessionFactory</code>의 생명주기를 싱글턴으로 관리한다.</p></blockquote><blockquote><p><strong>공유될 수 없는 SqlSession</strong>: 각각의 스레드는 자체적으로 <code class="language-plaintext highlighter-rouge">SqlSession</code> 인스턴스를 가져야 한다. <code class="language-plaintext highlighter-rouge">SqlSession</code> 인스턴스는 공유되지 않고 스레드에 안전하지도 않다. 그러므로 가장 좋은 스코프는 <strong>요청</strong> 또는 <strong>메서드 스코프</strong>이다. <code class="language-plaintext highlighter-rouge">SqlSession</code>을 <code class="language-plaintext highlighter-rouge">static</code> 필드나 클래스의 인스턴스 <strong>필드로 지정해서는 안 된다.</strong></p></blockquote><blockquote><p><strong>싱글턴</strong> 패턴(Singleton pattern): <strong>생성자가 여러 차례 호출되더라도 실제로 생성되는 객체는 하나</strong>이고, 최초 생성 <strong>이후에 호출된 생성자는 최초의 생성자가 생성한 객체를 리턴</strong>한다. 주로 공통된 객체를 여러개 생성해서 사용하는 <code class="language-plaintext highlighter-rouge">DBCP</code>(<strong>Database Connection Pool</strong>)와 같은 상황에서 많이 사용된다.</p></blockquote><p>출처: https://mybatis.org/mybatis-3/ko/getting-started.html</p><p>공식 문서에 따르면 <code class="language-plaintext highlighter-rouge">SqlSessionFactory</code>는 애플리케이션 스코프로 유지하는 것이 좋다고 한다. 따라서 <code class="language-plaintext highlighter-rouge">XxxDao</code> 클래스의 각 메서드에서 <code class="language-plaintext highlighter-rouge">SqlSessionFactory</code>를 준비하는 대신에 <code class="language-plaintext highlighter-rouge">XxxDao</code>의 <strong>생성자의 파라미터로 주입</strong>받을 수 있도록 코드를 바꾸도록 하자. 따라서 시스템에서 사용할 객체를 준비하는 <code class="language-plaintext highlighter-rouge">AppInitListener</code>에서 이 일을 하도록 하자.</p><p><code class="language-plaintext highlighter-rouge">com.eomcs.pms.listener.AppInitListener</code></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppInitListener</span> <span class="kd">implements</span> <span class="nc">ApplicationContextListener</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextInitialized</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"프로젝트 관리 시스템(PMS)에 오신 걸 환영합니다!"</span><span class="o">);</span>

    <span class="c1">// 시스템에서 사용할 객체를 준비한다.</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span>
          <span class="s">"jdbc:mysql://localhost:3306/studydb?user=study&amp;password=1111"</span><span class="o">);</span>
      <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"con"</span><span class="o">,</span> <span class="n">con</span><span class="o">);</span>
      
      
      <span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SqlSessionFactoryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">(</span>
          <span class="nc">Resources</span><span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">"com/eomcs/pms/conf/mybatis-config.xml"</span><span class="o">));</span>
      <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"sqlSessionFactory"</span><span class="o">,</span> <span class="n">sqlSessionFactory</span><span class="o">);</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"DB 커넥션을 준비하는 중에 오류 발생"</span><span class="o">);</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">XxxDao</code> 구현체 생성 코드도 <code class="language-plaintext highlighter-rouge">App</code>에서 <code class="language-plaintext highlighter-rouge">AppInitListener</code>의 <code class="language-plaintext highlighter-rouge">contextInitialized()</code>로 옮긴다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">BoardDao</span> <span class="n">boardDao</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BoardDaoImpl</span><span class="o">(</span><span class="n">sqlSessionFactory</span><span class="o">);</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">App</code>에 있던 <code class="language-plaintext highlighter-rouge">Command</code> 구현체 생성 코드도 이 메서드로 옮긴다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Command</span><span class="o">&gt;</span> <span class="n">commandMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

<span class="n">commandMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/board/add"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BoardAddCommand</span><span class="o">(</span><span class="n">boardDao</span><span class="o">,</span> <span class="n">memberDao</span><span class="o">));</span>
<span class="n">commandMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/board/list"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BoardListCommand</span><span class="o">(</span><span class="n">boardDao</span><span class="o">));</span>
<span class="n">commandMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/board/detail"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BoardDetailCommand</span><span class="o">(</span><span class="n">boardDao</span><span class="o">));</span>
<span class="n">commandMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/board/update"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BoardUpdateCommand</span><span class="o">(</span><span class="n">boardDao</span><span class="o">));</span>
<span class="n">commandMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/board/delete"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BoardDeleteCommand</span><span class="o">(</span><span class="n">boardDao</span><span class="o">));</span>
<span class="c1">//..</span>
<span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"commandMap"</span><span class="o">,</span> <span class="n">commandMap</span><span class="o">);</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">com.eomcs.pms.App</code>에서 <code class="language-plaintext highlighter-rouge">DAO</code> 구현체 생성 코드와 <code class="language-plaintext highlighter-rouge">Command</code> 구현체 생성 코드를 제거한다. <code class="language-plaintext highlighter-rouge">commandMap</code> 객체 생성 코드도 제거한다.</p><p>이제 <code class="language-plaintext highlighter-rouge">App</code>에서는 <code class="language-plaintext highlighter-rouge">Command</code>를 실행하는 코드는 찾아볼 수 없다. 이렇게 되면 실제 명령을 하면 어떤 작업이 수행되는지 바로바로 추적하기가 힘들다. 감춰져 있기 때문이다. 우리가 오픈소스를 봤을 때 코드를 쉽게 이해하기 힘든 이유가 다른 프로젝트도 이런 식으로 커맨드가 감춰져있기 때문이다. 이처럼 이해가 쉽지 않은 단점이 있지만, 향후 새로운 커맨드를 추가할 때 더이상 <code class="language-plaintext highlighter-rouge">App</code> 클래스를 직접 손댈 필요가 없어 유지보수가 편하다는 장점이 있다. 새로운 커맨드를 추가하려면 그냥 <code class="language-plaintext highlighter-rouge">AppInitListener</code>에 한 줄만 추가하면 된다.</p><blockquote><p><code class="language-plaintext highlighter-rouge">VO</code>(Value Object; 값 객체): 값을 위해 쓴다. 자바는 값 타입을 표현하기 위해 불변 클래스를 만들어 사용한다. 불변 클래스라 하면, <code class="language-plaintext highlighter-rouge">readOnly</code> 특징을 가진다. 이러한 클래스는 중간에 값을 바꿀 수 없고, 새로 만들어야 한다.</p></blockquote><blockquote><p>실무에서는 <code class="language-plaintext highlighter-rouge">VO</code> 와 도메인 객체를 혼용해서 사용하는 듯하다.</p></blockquote><h4 id="5단계-memberdaoimpl에-mybatis-적용">5단계: <code class="language-plaintext highlighter-rouge">MemberDaoImpl</code>에 <code class="language-plaintext highlighter-rouge">Mybatis</code> 적용</h4><p><strong><code class="language-plaintext highlighter-rouge">com.eomcs.pms.dao.mariadb.MemberDaoImpl</code></strong></p><p>JDBC 코드를 뜯어 내고 그 자리에 <code class="language-plaintext highlighter-rouge">Mybatis</code> 클래스로 대체한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberDaoImpl</span> <span class="kd">implements</span> <span class="n">com</span><span class="o">.</span><span class="na">eomcs</span><span class="o">.</span><span class="na">pms</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">MemberDao</span> <span class="o">{</span>

  <span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">MemberDaoImpl</span><span class="o">(</span><span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sqlSessionFactory</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">insert</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"MemberDao.insert"</span><span class="o">,</span> <span class="n">member</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">no</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="s">"MemberDao.delete"</span><span class="o">,</span> <span class="n">no</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">findByNo</span><span class="o">(</span><span class="kt">int</span> <span class="n">no</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">selectOne</span><span class="o">(</span><span class="s">"MemberDao.findByNo"</span><span class="o">,</span> <span class="n">no</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">findByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">selectList</span><span class="o">(</span><span class="s">"MemberDao.findByName"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">members</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">members</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">selectList</span><span class="o">(</span><span class="s">"MemberDao.findAll"</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// select는 값은 조회하는 것이기 때문에 autocommit을 설정할 필요가 없다.</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">"MemberDao.update"</span><span class="o">,</span> <span class="n">member</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByProjectNo</span><span class="o">(</span><span class="kt">int</span> <span class="n">projectNo</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">selectList</span><span class="o">(</span><span class="s">"MemberDao.findByProjectNo"</span><span class="o">,</span> <span class="n">projectNo</span><span class="o">);</span>
    <span class="o">}</span><span class="c1">// select는 값은 조회하는 것이기 때문에 autocommit을 설정할 필요가 없다.</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">findByEmailPassword</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"email"</span><span class="o">,</span> <span class="n">email</span><span class="o">);</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">selectOne</span><span class="o">(</span><span class="s">"MemberDao.findByEmailPassword"</span><span class="o">,</span> <span class="n">map</span><span class="o">);</span>
    <span class="o">}</span><span class="c1">// select는 값은 조회하는 것이기 때문에 autocommit을 설정할 필요가 없다.</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong><code class="language-plaintext highlighter-rouge">com/eomcs/pms/mapper/MemberMapper.xml</code></strong></p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>
  
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">"MemberDao"</span><span class="nt">&gt;</span>
  
  <span class="nt">&lt;resultMap</span> <span class="na">type=</span><span class="s">"com.eomcs.pms.domain.Member"</span> <span class="na">id=</span><span class="s">"MemberMap"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">"no"</span>           <span class="na">property=</span><span class="s">"no"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"name"</span>     <span class="na">property=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"email"</span>    <span class="na">property=</span><span class="s">"email"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"photo"</span>    <span class="na">property=</span><span class="s">"photo"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"tel"</span>      <span class="na">property=</span><span class="s">"tel"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"cdt"</span>      <span class="na">property=</span><span class="s">"registeredDate"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/resultMap&gt;</span>

  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findAll"</span> <span class="na">resultMap=</span><span class="s">"MemberMap"</span><span class="nt">&gt;</span>
    select 
      no, 
      name, 
      email, 
      tel, 
      cdt
    from 
      pms_member
    order by 
      no desc
  <span class="nt">&lt;/select&gt;</span>
  
  <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">"insert"</span> <span class="na">parameterType=</span><span class="s">"com.eomcs.pms.domain.Member"</span><span class="nt">&gt;</span>
    insert into pms_member(name,email,password,photo,tel)
    values(#{name},#{email},password(#{password}),#{photo},#{tel})
  <span class="nt">&lt;/insert&gt;</span>
  
  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findByNo"</span> 
    <span class="na">parameterType=</span><span class="s">"java.lang.Integer"</span> 
    <span class="na">resultMap=</span><span class="s">"MemberMap"</span><span class="nt">&gt;</span>
    select 
      no, 
      name, 
      email, 
      photo, 
      tel, 
      cdt
    from 
      pms_member
    where 
      no = #{no}
  <span class="nt">&lt;/select&gt;</span>
  
  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findByName"</span> 
    <span class="na">parameterType=</span><span class="s">"java.lang.String"</span> 
    <span class="na">resultMap=</span><span class="s">"MemberMap"</span><span class="nt">&gt;</span>
    select 
      no, 
      name, 
      email, 
      photo, 
      tel, 
      cdt
    from 
      pms_member
    where 
      name = #{name}
  <span class="nt">&lt;/select&gt;</span>
  
  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findByProjectNo"</span> 
    <span class="na">parameterType=</span><span class="s">"java.lang.Integer"</span> 
    <span class="na">resultMap=</span><span class="s">"MemberMap"</span><span class="nt">&gt;</span>
    select 
      m.no, 
      m.name
    from 
      pms_member_project mp 
      inner join pms_member m on mp.member_no=m.no
    where 
      mp.project_no=#{no}
    order by 
      m.name asc
  <span class="nt">&lt;/select&gt;</span>

  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findByEmailPassword"</span> 
    <span class="na">parameterType=</span><span class="s">"java.util.Map"</span> 
    <span class="na">resultMap=</span><span class="s">"MemberMap"</span><span class="nt">&gt;</span>
    select 
      no, 
      name, 
      email, 
      photo, 
      tel, 
      cdt
    from 
      pms_member
    where 
      email = #{email}
      and password = password(#{password})
  <span class="nt">&lt;/select&gt;</span>
  
  <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">"update"</span> <span class="na">parameterType=</span><span class="s">"com.eomcs.pms.domain.Member"</span><span class="nt">&gt;</span>
    update pms_member set
      name = #{name},
      email = #{email},
      password = password(#{password}),
      photo = #{photo},
      tel = #{tel}
    where no = #{no}
  <span class="nt">&lt;/update&gt;</span>
  
  <span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">"delete"</span> <span class="na">parameterType=</span><span class="s">"java.lang.Integer"</span><span class="nt">&gt;</span>
    delete from pms_member 
    where no=#{no}
  <span class="nt">&lt;/delete&gt;</span>
  
<span class="nt">&lt;/mapper&gt;</span>
</pre></table></code></div></div><h4 id="6단계-projectdaoimpl에-mybatis-적용">6단계: <code class="language-plaintext highlighter-rouge">ProjectDaoImpl</code>에 <code class="language-plaintext highlighter-rouge">Mybatis</code> 적용</h4><p><code class="language-plaintext highlighter-rouge">pms.domain.Project</code>를 확인해보자.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Project</span> <span class="o">{</span>
  <span class="c1">//..</span>
  <span class="kd">private</span> <span class="nc">Member</span> <span class="n">owner</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">members</span><span class="o">;</span>
  <span class="c1">//..</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOwner</span><span class="o">(</span><span class="nc">Member</span> <span class="n">owner</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">owner</span> <span class="o">=</span> <span class="n">owner</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMembers</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">members</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">members</span> <span class="o">=</span> <span class="n">members</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Project</code> 클래스는 <code class="language-plaintext highlighter-rouge">Member</code> 타입의 프로퍼티가 있다. 이때 <code class="language-plaintext highlighter-rouge">Member</code> 객체에다 <code class="language-plaintext highlighter-rouge">no</code>와 <code class="language-plaintext highlighter-rouge">name</code>을 담아야 한다. <code class="language-plaintext highlighter-rouge">&lt;resultMap&gt;</code> 태그 안에 <code class="language-plaintext highlighter-rouge">&lt;association&gt;</code> 태그를 사용하면 <code class="language-plaintext highlighter-rouge">Project</code> 객체를 만들 때 컬럼 값을 <code class="language-plaintext highlighter-rouge">Member</code> 도메인 객체에 어떻게 저장할 지 지정할 수 있다.</p><p><strong>컬럼-프로퍼티의 연결 정보 지정하기</strong></p><p>컬럼의 값을 어떤 자바 객체에 담을 것인지 <code class="language-plaintext highlighter-rouge">&lt;resultMap&gt;</code> 태그를 통해서 따로 정의할 수 있다. <code class="language-plaintext highlighter-rouge">type</code> 속성은 자바 클래스명을, <code class="language-plaintext highlighter-rouge">id</code> 속성의 값으로는 <strong>컬럼-프로퍼티의 연결 정보</strong>를 가리킬 이름을 적는다.</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>	<span class="nt">&lt;resultMap</span> <span class="na">type=</span><span class="s">"com.eomcs.pms.domain.Project"</span>
		<span class="na">id=</span><span class="s">"ProjectMap"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"no"</span> <span class="na">property=</span><span class="s">"no"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"title"</span> <span class="na">property=</span><span class="s">"title"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"content"</span> <span class="na">property=</span><span class="s">"content"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"sdt"</span> <span class="na">property=</span><span class="s">"startDate"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"edt"</span> <span class="na">property=</span><span class="s">"endDate"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">"owner"</span> <span class="na">javaType=</span><span class="s">"com.eomcs.pms.domain.Member"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"owner_no"</span> <span class="na">property=</span><span class="s">"owner"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"owner_name"</span> <span class="na">property=</span><span class="s">"owner"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/association&gt;</span>
	<span class="nt">&lt;/resultMap&gt;</span>
</pre></table></code></div></div><p>자바 코드로는 다음과 같다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nc">Project</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Project</span><span class="o">();</span>
<span class="n">p</span><span class="o">.</span><span class="na">setNo</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">"no"</span><span class="o">));</span>
<span class="n">p</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"title"</span><span class="o">));</span>
<span class="n">p</span><span class="o">.</span><span class="na">setRegisteredDate</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getDate</span><span class="o">(</span><span class="s">"cdt"</span><span class="o">));</span>
<span class="n">p</span><span class="o">.</span><span class="na">setViewCount</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">"vw_cnt"</span><span class="o">));</span>

<span class="nc">Member</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">();</span>
<span class="n">m</span><span class="o">.</span><span class="na">setNo</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">"no"</span><span class="o">));</span>
<span class="n">m</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>
<span class="n">p</span><span class="o">.</span><span class="na">setOwner</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
</pre></table></code></div></div><p>즉 <code class="language-plaintext highlighter-rouge">&lt;association&gt;</code>은 Mybatis에게 <code class="language-plaintext highlighter-rouge">Member</code> 객체를 생성해 <code class="language-plaintext highlighter-rouge">setName()</code>, <code class="language-plaintext highlighter-rouge">setNo()</code>(프로퍼티)라는 메서드를 호출해서 컬럼값을 프로퍼티에 담는다. 이렇게 컬럼값이 담겨진 <code class="language-plaintext highlighter-rouge">Member</code> 객체는 <code class="language-plaintext highlighter-rouge">setOwner()</code>를 호출해 <code class="language-plaintext highlighter-rouge">Project</code> 객체의 <code class="language-plaintext highlighter-rouge">owner</code>프로퍼티에 담는다.</p><p>기존 <code class="language-plaintext highlighter-rouge">projectListCommand</code>는 프로젝트 목록을 출력할 때 각 프로젝트에 해당하는 팀원(<code class="language-plaintext highlighter-rouge">Member</code>) 이름도 함께 출력해야 한다. 이는 어떻게 구현할 수 있을까? <strong><code class="language-plaintext highlighter-rouge">memberDao</code>를 <code class="language-plaintext highlighter-rouge">projectDao.findAll()</code> 안에서 사용해서는 안된다</strong>. <code class="language-plaintext highlighter-rouge">memberDao</code>와 <code class="language-plaintext highlighter-rouge">projectDao</code>는 <strong>같은 레벨의 클래스</strong>이기 때문이다. 따라서 <code class="language-plaintext highlighter-rouge">ProjectListCommmand</code> 클래스 안에서 <code class="language-plaintext highlighter-rouge">MemberDao</code>객체의 <code class="language-plaintext highlighter-rouge">findByProjectNo()</code> 메서드를 호출하고, (<code class="language-plaintext highlighter-rouge">MemberDao</code>를 사용하고) <code class="language-plaintext highlighter-rouge">ProjectDao</code> 객체의 <code class="language-plaintext highlighter-rouge">findAll()</code> 메서드를 호출하는 것이 맞다.<br /> 이를 위해서 <code class="language-plaintext highlighter-rouge">ProjectDao</code> 객체뿐만 아니라 <code class="language-plaintext highlighter-rouge">MemberDao</code> 객체도 생성자로 주입받도록 만든다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProjectListCommand</span> <span class="kd">implements</span> <span class="nc">Command</span> <span class="o">{</span>
  <span class="nc">ProjectDao</span> <span class="n">projectDao</span><span class="o">;</span>
  <span class="nc">MemberDao</span> <span class="n">memberDao</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">ProjectListCommand</span><span class="o">(</span><span class="nc">ProjectDao</span> <span class="n">projectDao</span><span class="o">,</span> <span class="nc">MemberDao</span> <span class="n">memberDao</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">projectDao</span> <span class="o">=</span> <span class="n">projectDao</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">memberDao</span> <span class="o">=</span> <span class="n">memberDao</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"[프로젝트 목록]"</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
      <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Project</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">projectDao</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"번호, 프로젝트명, 시작일 ~ 종료일, 관리자, 팀원"</span><span class="o">);</span>

      <span class="k">for</span> <span class="o">(</span><span class="nc">Project</span> <span class="n">project</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">StringBuilder</span> <span class="n">members</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Member</span> <span class="n">member</span> <span class="o">:</span> <span class="n">memberDao</span><span class="o">.</span><span class="na">findByProjectNo</span><span class="o">())</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">members</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">members</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
          <span class="o">}</span>
          <span class="n">members</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%d, %s, %s ~ %s, %s, [%s]\n"</span><span class="o">,</span>
            <span class="n">project</span><span class="o">.</span><span class="na">getNo</span><span class="o">(),</span>
            <span class="n">project</span><span class="o">.</span><span class="na">getTitle</span><span class="o">(),</span>
            <span class="n">project</span><span class="o">.</span><span class="na">getStartDate</span><span class="o">(),</span>
            <span class="n">project</span><span class="o">.</span><span class="na">getEndDate</span><span class="o">(),</span>
            <span class="n">project</span><span class="o">.</span><span class="na">getOwner</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span>
            <span class="n">members</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"프로젝트 목록 조회 중 오류 발생!"</span><span class="o">);</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p>이 방법은<code class="language-plaintext highlighter-rouge">projectDao.findAll</code>을 할 때 한 번 <code class="language-plaintext highlighter-rouge">select</code>를 하는 것이 아니라, 각각의 프로젝트에 대해 <code class="language-plaintext highlighter-rouge">select</code>를 해야 한다. 이렇게 하는 것이 아니라 한 번 <code class="language-plaintext highlighter-rouge">select</code>를 하고 <code class="language-plaintext highlighter-rouge">Project</code> 객체를 리턴할 때 <code class="language-plaintext highlighter-rouge">members</code> 프로퍼티까지 채워서 리턴할 수는 없을까? <code class="language-plaintext highlighter-rouge">owner</code> 프로퍼티처럼 말이다. 이를 위해서는 <code class="language-plaintext highlighter-rouge">findAll</code> 메서드에서 <code class="language-plaintext highlighter-rouge">select</code>를 할 때 join을 두 번 해야 한다.</p><p>현재 <code class="language-plaintext highlighter-rouge">owner</code> 프로퍼티만을 채웠다. <code class="language-plaintext highlighter-rouge">Member</code> 객체의 <code class="language-plaintext highlighter-rouge">setNo()</code>와 <code class="language-plaintext highlighter-rouge">setName()</code>을 하기 위해서 다음과 같이 <code class="language-plaintext highlighter-rouge">pms_member</code> 테이블과 inner join을 했다.</p><pre><code class="language-SQL">		select
			p.no,
			p.title,
			p.sdt,
			p.edt,
			m.no owner_no,
			m.name owner_name
		from
			pms_project p
		inner join pms_member m on p.owner=m.no
		order by p.no desc
</code></pre><p>실행 결과는 다음과 같다. 프로젝트를 등록할 때 <code class="language-plaintext highlighter-rouge">owner_name</code>는 반드시 있으므로 데이터가 누락될 염려는 없다. 문제는 <code class="language-plaintext highlighter-rouge">members</code> 프로퍼티를 채우기 위해 <code class="language-plaintext highlighter-rouge">pms_member_project</code>와 조인할 때 나타난다. <code class="language-plaintext highlighter-rouge">members</code>는 값이 없을 수 있기 때문이다.</p><pre><code class="language-SQL">+----+---------+------------+------------+----------+------------+
| no | title   | sdt        | edt        | owner_no | owner_name |
+----+---------+------------+------------+----------+------------+
| 15 | project | 2020-01-02 | 2020-02-02 |        1 | hayeon     |
| 14 | test200 | 2020-01-01 | 2020-01-02 |        6 | x1         |
</code></pre><p>members 프로퍼티를 채우기 위해서는 <code class="language-plaintext highlighter-rouge">pms_member_project</code> 테이블과도 조인을 해야 한다. 따라서 다음과 같이 inner join을 두 번 해주었다.</p><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">select</span>
  <span class="n">p</span><span class="p">.</span><span class="k">no</span><span class="p">,</span>
	<span class="n">p</span><span class="p">.</span><span class="n">title</span><span class="p">,</span>
	<span class="n">p</span><span class="p">.</span><span class="n">sdt</span><span class="p">,</span>
	<span class="n">p</span><span class="p">.</span><span class="n">edt</span><span class="p">,</span>
	<span class="n">m</span><span class="p">.</span><span class="k">no</span> <span class="n">owner_no</span><span class="p">,</span>
	<span class="n">m</span><span class="p">.</span><span class="n">name</span> <span class="n">owner_name</span><span class="p">,</span>
	<span class="n">mp</span><span class="p">.</span><span class="n">member_no</span>
<span class="k">from</span>
  <span class="n">pms_project</span> <span class="n">p</span>
  <span class="k">inner</span> <span class="k">join</span> <span class="n">pms_member</span> <span class="n">m</span> <span class="k">on</span> <span class="n">p</span><span class="p">.</span><span class="k">owner</span><span class="o">=</span><span class="n">m</span><span class="p">.</span><span class="k">no</span>
  <span class="k">inner</span> <span class="k">join</span> <span class="n">pms_member_project</span> <span class="n">mp</span> <span class="k">on</span> <span class="n">p</span><span class="p">.</span><span class="k">no</span><span class="o">=</span><span class="n">mp</span><span class="p">.</span><span class="n">project_no</span> 
  <span class="k">order</span> <span class="k">by</span> <span class="n">p</span><span class="p">.</span><span class="k">no</span> <span class="k">desc</span>

</pre></table></code></div></div><p>위와 같이 <strong>inner join을 한다면 조건과 일치하는 데이터가 없다면 누락된다.</strong> 따라서 팀원이 없는 프로젝트라면 해당 프로젝트는 조인된 테이블에 나오지도 않을 것이다. 이때 사용하는 것이 <strong>outer join</strong>이다. <strong>프로젝트를 기준점으로 left outer join</strong>을 한다. outer join은 <strong>일치하는 데이터가 없다고 하더라도 기준이 되는 데이터</strong>는 무조건 나오게 된다. 단 일치하지 않는 컬럼값은 null 값으로 나온다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/98709917-561a6800-23c6-11eb-9071-b1ce6b37e4d2.png" alt="image" /></p><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>		<span class="k">select</span>
			<span class="n">p</span><span class="p">.</span><span class="k">no</span><span class="p">,</span>
			<span class="n">p</span><span class="p">.</span><span class="n">title</span><span class="p">,</span>
			<span class="n">p</span><span class="p">.</span><span class="n">sdt</span><span class="p">,</span>
			<span class="n">p</span><span class="p">.</span><span class="n">edt</span><span class="p">,</span>
			<span class="n">m</span><span class="p">.</span><span class="k">no</span> <span class="n">owner_no</span><span class="p">,</span>
			<span class="n">m</span><span class="p">.</span><span class="n">name</span> <span class="n">owner_name</span><span class="p">,</span>
		  <span class="n">mp</span><span class="p">.</span><span class="n">member_no</span>
		<span class="k">from</span>
			<span class="n">pms_project</span> <span class="n">p</span>
		<span class="k">inner</span> <span class="k">join</span> <span class="n">pms_member</span> <span class="n">m</span> <span class="k">on</span> <span class="n">p</span><span class="p">.</span><span class="k">owner</span><span class="o">=</span><span class="n">m</span><span class="p">.</span><span class="k">no</span>
		<span class="k">left</span> <span class="k">outer</span> <span class="k">join</span> <span class="n">pms_member_project</span> <span class="n">mp</span> <span class="k">on</span> <span class="n">p</span><span class="p">.</span><span class="k">no</span><span class="o">=</span><span class="n">mp</span><span class="p">.</span><span class="n">project_no</span> 
		<span class="k">order</span> <span class="k">by</span> <span class="n">p</span><span class="p">.</span><span class="k">no</span> <span class="k">desc</span>
</pre></table></code></div></div><p>여기에 팀원들의 이름까지 출력하고자 한다면 다음과 같이 sql문을 짠다.</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findAll"</span> <span class="na">resultMap=</span><span class="s">"ProjectMap"</span><span class="nt">&gt;</span>
    select 
      p.no, 
      p.title, 
      m.no owner_no, 
      m.name owner_name,
      mp.member_no,
      m2.name member_name
    from 
      pms_project p 
      inner join pms_member m on p.owner=m.no
      left outer join pms_member_project mp on p.no=mp.project_no
      left outer join pms_member m2 on mp.member_no=m2.no
    order by p.no desc
  <span class="nt">&lt;/select&gt;</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/98711511-692e3780-23c8-11eb-8266-538dbbb73cdb.png" alt="image" /></p><blockquote><p><code class="language-plaintext highlighter-rouge">mybatis</code>의 <code class="language-plaintext highlighter-rouge">&lt;id&gt;</code> 태그는 PK 처럼 작동한다. 번호가 같으면 같은 객체로 간주한다. 만약 title 컬럼을 id로 지정하면 title이 같으면 같은 데이터로 취급한다. 습관적으로 여러 테이블을 조인할 때도 primary key 컬럼을 id 태그로 지정하라. 객체를 만들 때는 반드시 누가 pk인지 id로 지정하라.</p></blockquote><p><strong>ProjectDao.insert()</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">insert</span><span class="o">(</span><span class="nc">Project</span> <span class="n">project</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

  <span class="c1">// 트랜젝션을 위해 오토커밋을 비활성화한다.</span>
  <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">())</span> <span class="o">{</span>

    <span class="c1">// 프로젝트 정보 입력</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"ProjectDao.insert"</span><span class="o">,</span> <span class="n">project</span><span class="o">);</span>

    <span class="c1">// 프로젝트의 멤버 정보 입력</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Member</span> <span class="n">member</span> <span class="o">:</span> <span class="n">project</span><span class="o">.</span><span class="na">getMembers</span><span class="o">())</span> <span class="o">{</span>
      <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
      <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"memberNo"</span><span class="o">,</span> <span class="n">member</span><span class="o">.</span><span class="na">getNo</span><span class="o">());</span>
      <span class="c1">// 객체에 프로젝트 no 프로퍼티가 등록되어있어야 한다.</span>
      <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"projectNo"</span><span class="o">,</span> <span class="n">project</span><span class="o">.</span><span class="na">getNo</span><span class="o">());</span>
      <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"ProjectDao.insertMember"</span><span class="o">,</span> <span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="c1">// 묶인 작업이 다 끝났을 때 커밋을 한다.</span>
    <span class="n">sqlSession</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">count</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ProjectMapper.insert</strong></p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">"insert"</span> <span class="na">parameterType=</span><span class="s">"com.eomcs.pms.domain.Project"</span><span class="nt">&gt;</span>
  insert into pms_project(title,content,sdt,edt,owner)
  values(#{title},#{content},#{startDate},#{endDate},#{owner.no})
<span class="nt">&lt;/insert&gt;</span>
<span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">"insertMember"</span> <span class="na">parameterType=</span><span class="s">"java.util.Map"</span><span class="nt">&gt;</span>
  insert into pms_member_project(member_no, project_no)
  values(#{memberNo},#{projectNo})
<span class="nt">&lt;/insert&gt;</span>
</pre></table></code></div></div><p>위에서 알 수 있듯, <code class="language-plaintext highlighter-rouge">ProjectDao</code>는 <code class="language-plaintext highlighter-rouge">insertMember</code>를 통해 <code class="language-plaintext highlighter-rouge">pms_member_project</code> 테이블에 데이터를 삽입하고 있다. 즉 <strong><code class="language-plaintext highlighter-rouge">ProjectDao</code>는 <code class="language-plaintext highlighter-rouge">pms_member_project</code>의 owner이다.</strong> 따라서 <strong>다른 <code class="language-plaintext highlighter-rouge">DAO</code>는 owner가 되면 안된다.</strong> 한 테이블에 대해서 한 DAO만 insert, update, delete를 해야지 여러 DAO가 owner가 되면 유지보수가 어렵기 때문이다.</p><p>한편, ProjectDao의 <code class="language-plaintext highlighter-rouge">insert()</code> 메서드의 파라미터로 넘어온 <code class="language-plaintext highlighter-rouge">Project</code> 객체에는 사용자가 입력한 프로젝트 title, startDate, endDate, owner가 들어 있는데, <strong>프로젝트의 no는 들어 있지 않다(혹은 int의 기본값이 0이 들어 있다).</strong> 이 no값은 DBMS에서 자동으로 증가하는 값이기 때문이다.</p><p>따라서 이 상태에서 프로젝트를 추가하려고 시도하면 다음과 같은 에러가 나온다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Cannot</span> <span class="n">add</span> <span class="n">or</span> <span class="n">update</span> <span class="n">a</span> <span class="n">child</span> <span class="nl">row:</span> <span class="n">a</span> <span class="n">foreign</span> <span class="n">key</span> <span class="n">constraint</span> <span class="nf">fails</span> <span class="o">(</span><span class="err">`</span><span class="n">studydb</span><span class="err">`</span><span class="o">.</span><span class="err">`</span><span class="n">pms_member_project</span><span class="err">`</span><span class="o">,</span> <span class="no">CONSTRAINT</span> <span class="err">`</span><span class="n">pms_member_project_fk2</span><span class="err">`</span> <span class="no">FOREIGN</span> <span class="nf">KEY</span> <span class="o">(</span><span class="err">`</span><span class="n">project_no</span><span class="err">`</span><span class="o">)</span> <span class="no">REFERENCES</span> <span class="err">`</span><span class="n">pms_project</span><span class="err">`</span> <span class="o">(</span><span class="err">`</span><span class="n">no</span><span class="err">`</span><span class="o">))</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nd">@Override</span>
<span class="c1">// no 파라미터가 비어 있는 project 객체</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">insert</span><span class="o">(</span><span class="nc">Project</span> <span class="n">project</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">())</span> <span class="o">{</span>

    <span class="c1">// insert를 하면 project 객체의 no 값이 채워져야 한다.</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"ProjectDao.insert"</span><span class="o">,</span> <span class="n">project</span><span class="o">);</span>

    <span class="k">for</span> <span class="o">(</span><span class="nc">Member</span> <span class="n">member</span> <span class="o">:</span> <span class="n">project</span><span class="o">.</span><span class="na">getMembers</span><span class="o">())</span> <span class="o">{</span>
      <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
      <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"memberNo"</span><span class="o">,</span> <span class="n">member</span><span class="o">.</span><span class="na">getNo</span><span class="o">());</span>
      <span class="c1">// 객체에 프로젝트 no 프로퍼티가 등록되어있어야 한다.</span>
      <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"projectNo"</span><span class="o">,</span> <span class="n">project</span><span class="o">.</span><span class="na">getNo</span><span class="o">());</span>
      <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"ProjectDao.insertMember"</span><span class="o">,</span> <span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="n">sqlSession</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">count</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이를 위해서는 <code class="language-plaintext highlighter-rouge">insert</code> 태그에 특별한 속성을 지정해야 한다.</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">"insert"</span> <span class="na">parameterType=</span><span class="s">"com.eomcs.pms.domain.Project"</span>
        <span class="na">useGeneratedKeys=</span><span class="s">"true"</span> <span class="na">keyColumn=</span><span class="s">"no"</span> <span class="na">keyProperty=</span><span class="s">"no"</span><span class="nt">&gt;</span>
  insert into pms_project(title,content,sdt,edt,owner)
  values(#{title},#{content},#{startDate},#{endDate},#{owner.no})
<span class="nt">&lt;/insert&gt;</span>
</pre></table></code></div></div><p>위와 같이 <code class="language-plaintext highlighter-rouge">userGeneratedKeys</code>, <code class="language-plaintext highlighter-rouge">keyColumn</code>, <code class="language-plaintext highlighter-rouge">keyProperty</code> 속성을 지정한다. 파라미터로 객체(의 주소)를 넘겨주면 mybatis는 객체에 기록되어 있는 정보를 바탕으로 데이터베이스에 저장하는 것으로 끝나느 것이 아니라, 객체에 <code class="language-plaintext highlighter-rouge">setNo()</code>로 <strong>기록한다</strong>. 따라서 우리는 자동 증가된 값을 <code class="language-plaintext highlighter-rouge">getNo()</code>받을 수 있다. 내가 객체의 주소를 넘겨준다는 것은 나도 이 주소를 사용할 수 있다는 뜻이다. 즉 객체는 원시타입처럼 직접 넘겨주는 것이 아니라 주소를 넘겨주기 때문에 가능한 일이다.객체는 Heap 메모리에 있고, 주소를 가지고 공유할 수 있기 때문에 가능하다. 따라서 <strong>프로그램이 <code class="language-plaintext highlighter-rouge">getNo()</code>를 가지고 사용</strong>하면 된다. 이제 <code class="language-plaintext highlighter-rouge">project.getNo()</code>를 호출하여 pms_member_project 테이블에 프로젝트 번호를 저장할 수 있게 되었다.</p><p>수동 커밋일 때는 <code class="language-plaintext highlighter-rouge">sqlSession.commit()</code>을 호출해야 작업한 내용이 DBMS에 반영된다.</p><p><strong>ProjectDao.delete()</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">no</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">())</span> <span class="o">{</span>
    <span class="c1">// 프로젝트에 소속된 모든 멤버를 삭제한다.</span>
    <span class="n">sqlSession</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="s">"ProjectDao.deleteMembers"</span><span class="o">,</span> <span class="n">no</span><span class="o">);</span>

    <span class="c1">// =&gt; 프로젝트를 삭제한다.</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="s">"ProjectDao.delete"</span><span class="o">,</span> <span class="n">no</span><span class="o">);</span>

    <span class="n">sqlSession</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">count</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ProjectMapper.delete</strong></p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">"deleteMembers"</span> <span class="na">parameterType=</span><span class="s">"java.lang.Integer"</span><span class="nt">&gt;</span>
  delete from pms_member_project 
  where project_no=#{no}
<span class="nt">&lt;/delete&gt;</span>

<span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">"delete"</span> <span class="na">parameterType=</span><span class="s">"java.lang.Integer"</span><span class="nt">&gt;</span>
  delete from pms_project
  where no=#{no}
<span class="nt">&lt;/delete&gt;</span>
</pre></table></code></div></div><p><strong>ProjecDao.update()</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Project</span> <span class="n">project</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">())</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">"ProjectDao.update"</span><span class="o">,</span> <span class="n">project</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 프로젝트 팀원 변경한다.</span>
    <span class="c1">// =&gt; 기존에 설정된 모든 팀원을 삭제한다.</span>
    <span class="n">sqlSession</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="s">"ProjectDao.deleteMembers"</span><span class="o">,</span> <span class="n">project</span><span class="o">.</span><span class="na">getNo</span><span class="o">());</span>

    <span class="c1">// =&gt; 새로 팀원을 입력한다.</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Member</span> <span class="n">member</span> <span class="o">:</span> <span class="n">project</span><span class="o">.</span><span class="na">getMembers</span><span class="o">())</span> <span class="o">{</span>
      <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
      <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"memberNo"</span><span class="o">,</span> <span class="n">member</span><span class="o">.</span><span class="na">getNo</span><span class="o">());</span>
      <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"projectNo"</span><span class="o">,</span> <span class="n">project</span><span class="o">.</span><span class="na">getNo</span><span class="o">());</span>
      <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"ProjectDao.insertMember"</span><span class="o">,</span> <span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">sqlSession</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ProjectMapper.update</strong></p><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>	<span class="o">&lt;</span><span class="k">update</span> <span class="n">id</span><span class="o">=</span><span class="nv">"update"</span> <span class="n">parameterType</span><span class="o">=</span><span class="nv">"com.eomcs.pms.domain.Project"</span><span class="o">&gt;</span>
    <span class="k">update</span> <span class="n">pms_project</span> <span class="k">set</span>
      <span class="n">title</span> <span class="o">=</span> <span class="o">#</span><span class="err">{</span><span class="n">title</span><span class="err">}</span><span class="p">,</span>
      <span class="n">content</span> <span class="o">=</span> <span class="o">#</span><span class="err">{</span><span class="n">content</span><span class="err">}</span><span class="p">,</span>
      <span class="n">sdt</span> <span class="o">=</span> <span class="o">#</span><span class="err">{</span><span class="n">startDate</span><span class="err">}</span><span class="p">,</span>
      <span class="n">edt</span> <span class="o">=</span> <span class="o">#</span><span class="err">{</span><span class="n">endDate</span><span class="err">}</span><span class="p">,</span>
      <span class="k">owner</span> <span class="o">=</span> <span class="o">#</span><span class="err">{</span><span class="k">owner</span><span class="p">.</span><span class="k">no</span><span class="err">}</span>
    <span class="k">where</span> <span class="k">no</span> <span class="o">=</span> <span class="o">#</span><span class="err">{</span><span class="k">no</span><span class="err">}</span>
  <span class="o">&lt;/</span><span class="k">update</span><span class="o">&gt;</span>
  
  <span class="o">&lt;</span><span class="k">delete</span> <span class="n">id</span><span class="o">=</span><span class="nv">"deleteMembers"</span> <span class="n">parameterType</span><span class="o">=</span><span class="nv">"java.lang.Integer"</span><span class="o">&gt;</span>
    <span class="k">delete</span> <span class="k">from</span> <span class="n">pms_member_project</span> 
    <span class="k">where</span> <span class="n">project_no</span><span class="o">=#</span><span class="err">{</span><span class="k">no</span><span class="err">}</span>
  <span class="o">&lt;/</span><span class="k">delete</span><span class="o">&gt;</span>
  
  <span class="o">&lt;</span><span class="k">insert</span> <span class="n">id</span><span class="o">=</span><span class="nv">"insertMember"</span> <span class="n">parameterType</span><span class="o">=</span><span class="nv">"java.util.Map"</span><span class="o">&gt;</span>
    <span class="k">insert</span> <span class="k">into</span> <span class="n">pms_member_project</span><span class="p">(</span><span class="n">member_no</span><span class="p">,</span> <span class="n">project_no</span><span class="p">)</span> 
    <span class="k">values</span><span class="p">(</span><span class="o">#</span><span class="err">{</span><span class="n">memberNo</span><span class="err">}</span><span class="p">,</span><span class="o">#</span><span class="err">{</span><span class="n">projectNo</span><span class="err">}</span><span class="p">)</span>
  <span class="o">&lt;/</span><span class="k">insert</span><span class="o">&gt;</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/bitcamp/'>bitcamp</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/bitcamp/" class="post-tag no-text-decoration" >bitcamp</a> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=학원 #76일차: 프로젝트에 MyBatis 적용: MyBatis가 join 결과를 다루는 방법, 프로그램에서 사용하는 객체를 listener에서 준비시키기, sqlSessionFactory 공유, - 하연&url=https://hayeon17kim.github.io//posts/201110-76/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=학원 #76일차: 프로젝트에 MyBatis 적용: MyBatis가 join 결과를 다루는 방법, 프로그램에서 사용하는 객체를 listener에서 준비시키기, sqlSessionFactory 공유, - 하연&u=https://hayeon17kim.github.io//posts/201110-76/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=학원 #76일차: 프로젝트에 MyBatis 적용: MyBatis가 join 결과를 다루는 방법, 프로그램에서 사용하는 객체를 listener에서 준비시키기, sqlSessionFactory 공유, - 하연&url=https://hayeon17kim.github.io//posts/201110-76/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/system-deisign-capacity-estimation/">System Design: Capacity Estimate</a><li><a href="/posts/today-i-learned-2021-04-27/">주니어 성장일기: 2021.04.27</a><li><a href="/posts/today-i-learned-2021-04-26/">주니어 성장일기: 2021.04.26</a><li><a href="/posts/fastcampus-01/">자료구조와 알고리즘이란</a><li><a href="/posts/today-i-learned-2021-04-25/">주니어 성장일기: 2021.04.25</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/bitcamp/">bitcamp</a> <a class="post-tag" href="/tags/modernjs/">modernJS</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/trouble-shooting/">trouble-shooting</a> <a class="post-tag" href="/tags/devil/">devil</a> <a class="post-tag" href="/tags/corejs/">corejs</a> <a class="post-tag" href="/tags/network/">network</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/201123-85/"><div class="card-body"> <span class="timeago small" > Nov 23, 2020 <i class="unloaded">2020-11-23T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>학원 #85일차:서블릿 프로그래밍, WAS, JavaEE와 Servlet 컨테이너, Servlet 인터페이스의 Life-cycle 메서드</h3><div class="text-muted small"><p> 서블릿 프로그래밍 웹 애플리케이션 서버 아키텍쳐의 개념 JavaEE와 Servlet API의 관계 JavaEE 구현체와 서블릿 컨테이너의 관계 eomcs-web-project/src-00 예제 실습 Servlet 인터페이스와 Life-cycle 메서드 WAS(Web Application Server) 아키텍처 이전까지는 사...</p></div></div></a></div><div class="card"> <a href="/posts/201124-86/"><div class="card-body"> <span class="timeago small" > Nov 24, 2020 <i class="unloaded">2020-11-24T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>학원 #86일차:서블릿 프로그래밍, 프로젝트를 WAS 아키텍처로 전환</h3><div class="text-muted small"><p> 서블릿 컨테이너가 관리하는 컴포넌트는 서블릿, 필터, 리스너로 3가지이다. Servlet 만들기 1. javax.servlet.Servlet 인터페이스 구현 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38...</p></div></div></a></div><div class="card"> <a href="/posts/201125-87/"><div class="card-body"> <span class="timeago small" > Nov 25, 2020 <i class="unloaded">2020-11-25T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>학원 #87일차: HTML 태그 사용법</h3><div class="text-muted small"><p> HTML/CSS 학습법: 결과 화면 먼저 보고 소스코드를 확인하자 UI와 UX UX(User Experience; 사용자 경험): 사용자 편의성 ex: 링크에 hover했을 때 커서가 손모양으로 바뀌어야 한다. UI(User Interface): 기능을 하는 화면이 있는가 HTML ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/201109-75/" class="btn btn-outline-primary" prompt="Older"><p>학원 #75일차: Chain of Responsibility 패턴, Persistance 프레임워크 MyBatis</p></a> <a href="/posts/201111-77/" class="btn btn-outline-primary" prompt="Newer"><p>학원 #77일차: MyBatis 기본 문법 및 프로젝트에 적용</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Loading comments from <a href="https://disqus.com/">Disqus</a> ...</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//hayeon17kim-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = '학원 #76일차: 프로젝트에 MyBatis 적용: MyBatis가 join 결과를 다루는 방법, 프로그램에서 사용하는 객체를 listener에서 준비시키기, sqlSessionFactory 공유,'; this.page.url = 'https://hayeon17kim.github.io//posts/201110-76/'; this.page.identifier = '/posts/201110-76/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/MONI56219559">hayeon_kim</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/bitcamp/">bitcamp</a> <a class="post-tag" href="/tags/modernjs/">modernJS</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/trouble-shooting/">trouble shooting</a> <a class="post-tag" href="/tags/devil/">devil</a> <a class="post-tag" href="/tags/corejs/">corejs</a> <a class="post-tag" href="/tags/network/">network</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://hayeon17kim.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
