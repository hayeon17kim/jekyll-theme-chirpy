<!DOCTYPE html><html lang="kr-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="학원 #61일차: 스레드풀의 구현과 사용, DBMS" /><meta name="author" content="hayeon_kim" /><meta property="og:locale" content="kr_KR" /><meta name="description" content="복습" /><meta property="og:description" content="복습" /><link rel="canonical" href="https://hayeon17kim.github.io//posts/201020-61/" /><meta property="og:url" content="https://hayeon17kim.github.io//posts/201020-61/" /><meta property="og:site_name" content="하연" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-10-20T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="학원 #61일차: 스레드풀의 구현과 사용, DBMS" /><meta name="twitter:site" content="@MONI56219559" /><meta name="twitter:creator" content="@hayeon_kim" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"hayeon_kim"},"headline":"학원 #61일차: 스레드풀의 구현과 사용, DBMS","dateModified":"2020-10-20T00:00:00+08:00","datePublished":"2020-10-20T00:00:00+08:00","description":"복습","url":"https://hayeon17kim.github.io//posts/201020-61/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hayeon17kim.github.io//posts/201020-61/"},"@context":"https://schema.org"}</script><title>학원 #61일차: 스레드풀의 구현과 사용, DBMS | 하연</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-173202420-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-173202420-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/bio-photo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">하연</a></div><div class="site-subtitle font-italic">어제보다 나은 코드를 위해</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-laptop-code ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/hayeon17kim" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/MONI56219559" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hayeon17kim','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>학원 #61일차: 스레드풀의 구현과 사용, DBMS</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>학원 #61일차: 스레드풀의 구현과 사용, DBMS</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Oct 20, 2020, 12:00 AM +0800" > Oct 20, 2020 <i class="unloaded">2020-10-20T00:00:00+08:00</i> </span> by <span class="author"> hayeon_kim </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5207 words">28 min</span></div></div><div class="post-content"><h2 id="복습">복습</h2><ul><li>stateful<ul><li>스레드를 덜 생산하고 삭제한다. 따라서 가비지가 덜 생긴다<li>많은 클라이언트에 연결할 수 없다.</ul><li>stateless<ul><li>클라이언트가 요청할 때 스레드를 생성해서 응답하면 스레드를 즉시 삭제<li>가비지가 많이 생성된다.</ul><li>stateless + thread pool<ul><li>가비지를 줄인다<li>인스턴스 생성 시간을 줄인다.</ul></ul><h1 id="스레드풀">스레드풀</h1><h2 id="v36-스레드풀-구현">v36. 스레드풀 구현</h2><ul><li><p>스레드풀</p><ul><li>스레드를 풀링 기법(pooling)을 이용하여 관리한다.<li>스레드를 사용한 후에 버리지 않고 재사용하여 가비지 생성을 줄인다.</ul><li><p>풀링 기법(pooling)</p><ul><li>사용한 객체를 버리지 않고 보관해 두었다가 재사용하는 객체 관리 기법이다.<li>동일한 객체를 자주 생성하고, 생성한 객체를 쓰고 버리는 상황에서 대량이 가비지가 생성되는 경우에 적합하다.<li>GoF의 디자인 패턴에서 Flyweight 패턴의 한 예이다.</ul></ul><h3 id="1단계-스레드풀을-정의한다">1단계: 스레드풀을 정의한다.</h3><ul><li><code class="language-plaintext highlighter-rouge">com.eomcs.util.concurrent.ThreadPool</code> 추가<ul><li>스레드 + 작업을 맡기고 + 깨우는 기능 + 작업 완료 후 잠자는 기능</ul></ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadPool</span> <span class="o">{</span>

  <span class="c1">// 스레드풀의 종료 상태</span>
  <span class="kt">boolean</span> <span class="n">stopping</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Worker</span><span class="o">&gt;</span> <span class="n">workers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

  <span class="c1">// 스레드 + 작업을 맡기고 + 깨우는 기능 + 작업 완료 후 잠자는 기능</span>
  <span class="kd">class</span> <span class="nc">Worker</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>

    <span class="nc">Runnable</span> <span class="n">task</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTask</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// 스레드가 할 작업을 배정한 후</span>
      <span class="k">this</span><span class="o">.</span><span class="na">task</span> <span class="o">=</span> <span class="n">task</span><span class="o">;</span>

      <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 스레드를 깨운다.</span>
        <span class="k">this</span><span class="o">.</span><span class="na">notify</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">try</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"[%s] - 스레드 대기 중...\n"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

            <span class="k">this</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>

            <span class="k">if</span> <span class="o">(</span><span class="nc">ThreadPool</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">stopping</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 스레드풀이 종료 상태라면,</span>
              <span class="c1">// 스레드는 깨어나는 즉시 실행을 멈춘다.</span>
              <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"[%s] - 스레드 작업 시작!\n"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
            <span class="c1">// 이 스레드 객체에 대해 대기 상태로 있다가</span>
            <span class="c1">// 이 스레드에게 깨어나라는 알림(notify()/nofifyAll())이 온다면</span>
            <span class="c1">// 즉시 running 상태로 되돌아 간다.</span>

          <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"[%s] - 스레드 실행 중 오류 발생!\n"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
            <span class="k">break</span><span class="o">;</span>
            <span class="c1">// 기다리다가 인터럽트 예외가 발생하면</span>
            <span class="c1">// 스레드를 종료한다.</span>
          <span class="o">}</span>
          <span class="k">try</span> <span class="o">{</span>
            <span class="n">task</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"[%s] - 스레드 작업 종료!\n"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

          <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"[%s] - %s\n"</span><span class="o">,</span>
                <span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="c1">// 작업 수행 중 오류가 발생하더라도</span>
            <span class="c1">// 스레드는 계속 유효하다.</span>
          <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="c1">// 정상적인 종료든 작업 수행 중 예외가 발생했든 간에</span>
            <span class="c1">// 작업을 마친 스레드는 재사용할 수 있도록</span>
            <span class="c1">// 다시 목록에 보관되어야 한다.</span>
            <span class="n">workers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"[%s] - 스레드풀로 되돌아 감!\n"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">stopping</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"스레드풀이 종료 상태입니다!"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nc">Worker</span> <span class="n">t</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">workers</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// 스레드가 없다면 새로 생성한다.</span>
      <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Worker</span><span class="o">();</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"[%s] - 스레드 생성!\n"</span><span class="o">,</span> <span class="n">t</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

      <span class="c1">// 그리고 즉시 실행한다.</span>
      <span class="c1">// - 실행하더라도 스레드는 처음에 스스로 대기 상태로 갈 것이다.</span>
      <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

      <span class="c1">// 현재 main 스레드를 잠깐 멈추게 하여</span>
      <span class="c1">// 새로 만든 스레드가 실행할 틈을 주자!</span>
      <span class="c1">// 그래야만 새로 만든 스레드가 실행하자 마자 대기상태로 간다.</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// sleep() 중 발생한 예외는 무시한다.</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="c1">// 스레드가 있다면, 스레드풀에서 한 개 꺼낸다.</span>
      <span class="c1">// - 스레드풀에서 꺼낸 스레드는 현재 대기 상태이다.</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">workers</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"[%s] - 스레드 꺼내서 재사용!\n"</span><span class="o">,</span> <span class="n">t</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="c1">// 스레드를 깨워서 일을 시킨다.</span>
    <span class="c1">// - 스레드에게 해야 할 작업을 배정하면 된다.</span>
    <span class="n">t</span><span class="o">.</span><span class="na">setTask</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">shutdown</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">stopping</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

      <span class="k">while</span> <span class="o">(!</span><span class="n">workers</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span> <span class="c1">// 스레드풀에 대기 중인 스레드가 있다면,</span>
        <span class="nc">Worker</span> <span class="n">worker</span> <span class="o">=</span> <span class="n">workers</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="c1">// 맨 앞에 있는 스레드를 꺼내서</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="n">worker</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">worker</span><span class="o">.</span><span class="na">notify</span><span class="o">();</span> <span class="c1">// 스레드를 깨운다.</span>
          <span class="c1">// 스레드는 깨어나면 stopping 상태에 따라 종료 여부를 결정하도록 프로그래밍 되어 있다.</span>
          <span class="c1">// =&gt; Worker 스레드를 코드를 보라!</span>
        <span class="o">}</span>
      <span class="o">}</span>

      <span class="c1">// 스레드풀에서 대기하지 않고 현재 작업을 수행하는 스레드가 있을 수 있다.</span>
      <span class="c1">// 그 스레드가 작업을 끝낼 때까지 좀 기다리자.</span>
      <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>

      <span class="c1">// 다시 한 번 대기하고 있는 스레드를 종료해 보자!</span>
      <span class="k">while</span> <span class="o">(!</span><span class="n">workers</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span> <span class="c1">// 스레드풀에 대기 중인 스레드가 있다면,</span>
        <span class="nc">Worker</span> <span class="n">worker</span> <span class="o">=</span> <span class="n">workers</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="c1">// 맨 앞에 있는 스레드를 꺼내서</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="n">worker</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">worker</span><span class="o">.</span><span class="na">notify</span><span class="o">();</span> <span class="c1">// 스레드를 깨운다.</span>
          <span class="c1">// 스레드는 깨어나면 stopping 상태에 따라 종료 여부를 결정하도록 프로그래밍 되어 있다.</span>
          <span class="c1">// =&gt; Worker 스레드를 코드를 보라!</span>
        <span class="o">}</span>
      <span class="o">}</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"스레드풀을 종료하는 중에 예외 발생!"</span><span class="o">);</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p><strong>ThreadPool.worker.run()</strong></p><p><code class="language-plaintext highlighter-rouge">wait()</code>에서 인터럽트 예외가 발생할 수 있고, <code class="language-plaintext highlighter-rouge">run()</code>에서 런타임 예외도 발생할 수 있다. 예외 처리를 따로 할 수도 있고 한꺼번에 묶어서 할 수도 있지만 , 여기서는 따로 처리해주었다. 따로 처리해줄 경우 <code class="language-plaintext highlighter-rouge">run()</code> 메서드 중 예외가 발생해도 해당 작업만 취소하고 스레드 자체는 유효하다. 예외를 한꺼번에 처리할 경우 run()에서 예외가 발생했을 때 전체 작업이 종료되어야 한다. 한편 wait()`에서 인터럽트 예외가 발생하면 스레드를 종료시키도록 하자.</p><p><strong>ThreadPool.execute()</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Worker</span> <span class="n">t</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">workers</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Worker</span><span class="o">();</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"[%s] - 스레드 생성!\n"</span><span class="o">,</span> <span class="n">t</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
      <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">workers</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"[%s] - 스레드 꺼내서 재사용!\n"</span><span class="o">,</span> <span class="n">t</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="n">t</span><span class="o">.</span><span class="na">setTask</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
  <span class="o">}</span>
</pre></table></code></div></div><p>위의 코드에서 <code class="language-plaintext highlighter-rouge">Thread.sleep(500)</code>을 하는 이유는 main 스레드를 잠간 멈추게 해서 새로 만든 스레드가 실행할 틈을 주는 것이다. 그래야만 새로 만든 스레드가 실행하자마자 대기상태로 간다.</p><p>만약 이렇게 틈을 주지 않으면, 스레드가 실행하기도 전에 운영체제가 CPU를 메인 스레드에게 줘서 다음 코드인 <code class="language-plaintext highlighter-rouge">t.setTask(task)</code>를 먼저 실행해버린다. 그러면 아직 스레드가 기다리지도 않는데 (<code class="language-plaintext highlighter-rouge">this.wait()</code> 실행 안되었음) 깨어나라고(<code class="language-plaintext highlighter-rouge">notify()</code>) 명령하기 때문에 프로그램이 제대로 실행되지 않는다.</p><p>물론 운영체제가 CPU를 생성된 스레드에게 주고 <code class="language-plaintext highlighter-rouge">wait()</code>까지 실행한 다음에 메인 스레드에게 CPU를 줄 수도 있다. 그러나 이것은 CPU 스케줄링에 따른 것으로 어떨 때는 실행이 잘 되고, 어떨 때는 실행이 잘 안 될 수 있다.</p><p>이처럼 <strong>멀티 스레딩</strong>을 구현하였을 때는 미세한 <strong>실행 순서를 잘 파악</strong>해야 한다. <strong>언제 실행되는 지가 중요하다</strong>. 이러한 <strong>비동기 처리</strong> 문제는 나중에 자바스크립트할 때 많이 발생한다. 예를 들어, 자바스크립트에서 보였다 보이지 않았다 한다면 그 프로그램은 비동기 처리를 제대로 해주지 않아서 잘 동작하지 않는 것이다. 일단 데이터를 가져오는 스레드가 동작하고 색을 바꾸는 스레드가 작업해야 하는데, 이 순서가 뒤바뀌면 색을 바꿀 데이터가 없으니 프로그램 동작이 보였다 보이지 않았다 하는 것이다.</p><blockquote><p>스레드는 스레드풀을 통해 재사용할 수 있어도 소켓은 재사용할 수 없다.</p></blockquote><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">notifyApplicationContextListenerOnServiceStarted</span><span class="o">();</span>

    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="n">port</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Socket</span> <span class="n">clientSocket</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">stop</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// 직접 스레드를 생성하는 것이 아니라 스레드풀에 작업을 맡긴다.</span>
        <span class="n">threadPool</span><span class="o">.</span><span class="na">execute</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">handleClient</span><span class="o">(</span><span class="n">clientSocket</span><span class="o">));</span>
      <span class="o">}</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="n">notifyApplicationContextListenerOnServiceStopped</span><span class="o">();</span>
    <span class="n">threadPool</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
  <span class="o">}</span>

</pre></table></code></div></div><p>클라이언트 앱을 실행해서 다음과 같이 입력한다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="o">(</span>master<span class="o">)</span>⚡ % java <span class="nt">-cp</span> bin/main com.eomcs.pms.ClientApp localhost 8888
명령&gt; /hello
안녕하세요!
명령&gt; /board/list
<span class="o">[</span>게시물 목록]
1, 1, 1, 2020-09-24, 0
1, 1, , 2020-09-25, 0
4, 4, 4, 2020-09-25, 0
명령&gt; stop
서버를 종료하는 중입니다!
안녕!
</pre></table></code></div></div><p>서버 앱의 실행 결과는 다음과 같다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>프로젝트 관리 시스템<span class="o">(</span>PMS<span class="o">)</span>에 오신 걸 환영합니다!
<span class="s1">'board.json'</span> 파일에서 총 3 개의 객체를 로딩했습니다.
<span class="s1">'member.json'</span> 파일에서 총 1 개의 객체를 로딩했습니다.
<span class="s1">'project.json'</span> 파일에서 총 1 개의 객체를 로딩했습니다.
<span class="s1">'task.json'</span> 파일에서 총 1 개의 객체를 로딩했습니다.
서버 실행 중...
<span class="o">[</span>Thread-0] - 스레드 생성!
<span class="o">[</span>Thread-0] - 스레드 대기 중...
<span class="o">[</span>Thread-0] - 스레드 작업 시작!
클라이언트<span class="o">(</span>127.0.0.1<span class="o">)</span>가 연결되었습니다.
클라이언트<span class="o">(</span>127.0.0.1<span class="o">)</span>와의 연결을 끊었습니다.
<span class="o">[</span>Thread-0] - 스레드 작업 종료!
<span class="o">[</span>Thread-0] - 스레드풀로 되돌아 감!
<span class="o">[</span>Thread-0] - 스레드 대기 중...
<span class="o">[</span>Thread-0] - 스레드 꺼내서 재사용!
<span class="o">[</span>Thread-0] - 스레드 작업 시작!
클라이언트<span class="o">(</span>127.0.0.1<span class="o">)</span>가 연결되었습니다.
클라이언트<span class="o">(</span>127.0.0.1<span class="o">)</span>와의 연결을 끊었습니다.
<span class="o">[</span>Thread-0] - 스레드 작업 종료!
<span class="o">[</span>Thread-0] - 스레드풀로 되돌아 감!
<span class="o">[</span>Thread-0] - 스레드 대기 중...
<span class="o">[</span>Thread-0] - 스레드 꺼내서 재사용!
<span class="o">[</span>Thread-0] - 스레드 작업 시작!
클라이언트<span class="o">(</span>127.0.0.1<span class="o">)</span>가 연결되었습니다.
<span class="o">[</span>Thread-0] - 스레드 작업 종료!
<span class="o">[</span>Thread-0] - 스레드풀로 되돌아 감!
<span class="o">[</span>Thread-0] - 스레드 대기 중...
프로젝트 관리 시스템<span class="o">(</span>PMS<span class="o">)</span>을 종료합니다!
총 3 개의 객체를 <span class="s1">'board.json'</span> 파일에 저장했습니다.
총 1 개의 객체를 <span class="s1">'member.json'</span> 파일에 저장했습니다.
총 1 개의 객체를 <span class="s1">'project.json'</span> 파일에 저장했습니다.
총 1 개의 객체를 <span class="s1">'task.json'</span> 파일에 저장했습니다.
</pre></table></code></div></div><p>클라이언트를 하나만 연결했기 때문에 스레드가 하나만 생성되어 다시 대기열로 되돌아가고 다시 사용되고 있다. 그러나 수업시간에 강사님 컴퓨터로 23명의 학생이 동시에 접속하였을 때는 스레드가 하나 더 생겨서 (<code class="language-plaintext highlighter-rouge">Thread-0</code>과 <code class="language-plaintext highlighter-rouge">Thread-1</code>) 23명이 요청한 작업들을 수행하였다.</p><p>즉 동접자가 n명이라고 n개의 스레드가 생기는 것이 아니다. 동접자가 만 명 정도 되면 10개 정도의 스레드가 만들어진다. 단 이 개수는 정해진 게 아니라 CPU 램 속도가 얼마나 빠른지에 따라 다르다. 실무에서는 시스템 엔지니어링 팀이 하드웨어를 관리하면서 최소와 최대 스레드 수를 조절할 수 있다. 메모리 한계가 있어서 스레드 수를 무한정 증가시킬 수 없다. 그러지 않으면 시스템이 뻗어버린다(급격하게 느려진다). 그럴 위험이 있거나 그런 일이 자주 발생한다면 시스템(하드웨어)을 확장해야 한다.</p><p><strong>ServerApp.service()</strong></p><p>마지막 코드에 <code class="language-plaintext highlighter-rouge">threadPool.shutdown()</code>를 삽입해야 한다. 만약 <code class="language-plaintext highlighter-rouge">shutdown()</code>호출하지 않는다면, 메인 스레드가 죽더라도 다른 스레드가 살아있을 경우 시스템 종료가 되지 않는다.스레드가 작업을 하는 중이 아니라 하더라도 스레드풀에 스레드들이 대기 상태로 살아 있기 때문에 다음과 같이 메인 스레드는 죽지만 프로그램 자체는 종료가 되지 않는다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/96567048-4a74dd80-1301-11eb-8bc8-a1919f35c933.png" alt="image" /></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//..</span>
    <span class="n">notifyApplicationContextListenerOnServiceStopped</span><span class="o">();</span>
    <span class="n">threadPool</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
  <span class="o">}</span>
</pre></table></code></div></div><p>위와 같이 <code class="language-plaintext highlighter-rouge">threadPool.shutdown()</code>을 호출하면</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/96567399-af303800-1301-11eb-9d8e-885af7f2fa62.png" alt="image" /></p><p>시스템이 정상적으로 종료된 것을 확인할 수 있다.</p><h2 id="자바에서-제공하는-스레드풀-사용하기">자바에서 제공하는 스레드풀 사용하기</h2><h3 id="concurrent-프레임워크">Concurrent 프레임워크</h3><ul><li>동시성 프로그래밍ㅇ을 위해 자바에서 제공하는 프레임워크이다.<li><p>스레드풀이나 비동기 입출력, 간단한 태스크 프레임워크 포함</p><li>멀티 스레드를 사용할 것이다.<li>스레드 풀을 사용할 것이다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>
  <span class="nc">ExecutorService</span> <span class="n">threadPool</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newCachedThreadPool</span><span class="o">();</span>
  <span class="c1">//..</span>
  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">notifyApplicationContextListenerOnServiceStarted</span><span class="o">();</span>
    
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="n">port</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>
      
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Socket</span> <span class="n">clientSocket</span> <span class="o">=</span> <span class="n">serverSocke</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
        
        <span class="k">if</span> <span class="o">(</span><span class="n">stop</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span> 
        <span class="n">threadPool</span><span class="o">.</span><span class="na">execute</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">handleClient</span><span class="o">(</span><span class="n">clientSocket</span><span class="o">));</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="n">notifyApplicationContextListenerOnServiceStopped</span><span class="o">();</span>
    <span class="n">threadPool</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="n">threadPool</span><span class="o">.</span><span class="na">awaitTermination</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">))</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"아직 종료 안 된 작업이 있다."</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"남아 있는 작업의 강제 종료를 시도하겠다."</span><span class="o">);</span>
        <span class="n">threadPool</span><span class="o">.</span><span class="na">shutdownNow</span><span class="o">();</span>
        
        <span class="k">if</span> <span class="o">(!</span><span class="n">threadPool</span><span class="o">.</span><span class="na">awaitTermination</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">))</span> <span class="o">{</span>
          <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"스레드풀의 강제 종료를 완료하지 못했다."</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"모든 작업을 강제 종료했다."</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"스레드풀 강제 종료 중 오류 발생!"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">pirnltn</span><span class="o">(</span><span class="s">"서버 종료!"</span><span class="o">);</span>
  <span class="o">}</span>
  
  <span class="c1">//...</span>
<span class="o">}</span>
</pre></table></code></div></div><h1 id="dbms">DBMS</h1><h2 id="현재-요구사항">현재 요구사항</h2><p>이때까지는 개발자가 직접 data 관리를 위해 파일을 조작하였다. 이 방식은 데이터 크기가 작을 때는 괜찮지만, 데이터가 많을 때는 사용할 수 없다. 즉 상용으로는 사용할 수 없다. 그러나 다음과 같은 문제점이 있었다.</p><ul><li>임의의 위치의 값 변경<li>특정 조건에 해당하는 데이터 찾기<li>특정 조건의 data 삭제<li>대량의 데이터를 다루기 쉽게 어떤 기법으로 여러 파일로 분산 저장할 것인가?<li>data와 data 간의 관계는 어덯게 관리할 것인가?<li>유효하지 않은 data 조작을 어떻게 제한할 것인가?<ul><li>이미 삭제된 회원이 프로젝트리스트에서 팀원이 된다.</ul></ul><p>일반적인 프로그램은 괜찮지만 기업용 프로그램에서는 이런 것들이 반드시 해소되어야 한다. 그러나 이런 문제점을 모두 수용하려면 <strong>많은 코딩</strong>을 해야 하고, 많은 사람들이 <strong>중복해서 코딩</strong>해야 한다. 이걸 Data 관리 전문 소프트웨어(Data Base Management System; DBMS)가 해결을 해줄 수 있다.</p><h2 id="dbms-1">DBMS</h2><ul><li>data 관리 전문 소프트웨어(Data Base Management System; DBMS)<li>ex: Oracle, My-SQL, MS-SQL, DB2, (국산: Altibase, Cubrid, Tibero)<ul><li>유료 소프트웨어는 개인 대상은 업그레이드 비용만 내면 되지만, 회사의 경우 유지보수 비용을 해마다 내야 한다.<li>2016년은 CPU당 라이센스 비용을, 지금은 코어당 라이센스 비용을 내야 한다. 동시접속자 수에 대해서도 라이센스 비용을 내야 하고, 연 라이센스 비용도 내야 한다.</ul><li><p>MariaDB는 오픈 소스로 무료고, Oracle은 비용이 많이 든다.</p><ul><li>Google과 Facebook은 직원들이 엔지니어로 구성되어 있어 문제가 발생하면 알아서 해결할 수 있다. 반면 한국기업들이나 관공서에서 MariaDB를 안 쓰고 비싼 Oracle을 사용하는 이유는 문제가 발생하면 관리자들이 책임을 져야 한다. Google이나 Facebook처럼 엔지니어로 구성된 게 아니라 디비에서 발생된 문제를 찾아내 해결할 수도 없기 때문에 Oracle을 사용한다.</ul></ul><h3 id="종류">종류</h3><ul><li>Relational DBMS<ul><li>Oracle, My-SQL, MS-SQL, DB2, (국산: Altibase, Cubrid, Tibero)<li>MariaDB: MySQL 창시자가 MySQL 똑같이 복사해서 만들어서 호환이가능하다</ul><li>O-RDBMS<ul><li>PostgreSQL (데이터를 객체처럼 다루기 위해 )<li>기업에서 잘 사용하지 않는다.</ul><li>NoSQL DBMS<ul><li>[key-value] 형태로 데이터를 다룬다.<li>MongoDB(JSON데이터 형식): 몽고 디비<li>RDBMS는 단순 데이터 저장하기에는 너무 무겁다. 이러한 단순 데이터를 저장할 때는 NoSQL을 사용한다. 그러나 RDBMS를 완전히 대체할 수는 없다.</ul></ul><p>RDBMS를 써야 할 때도 있고 다른 종류의 DBMS를 써야 할 때도 있다. 방문자의 성별, 연령대, 방문 시간과 같이 단순한 데이터를 대량으로 저장하고 싶다고 하자. 자잘한 데이터가 대량으로 발생한다. 데이터 크기 자체가 큰 게 아니라 <strong>자잘한 데이터</strong>가 어마어마하게 발생할 때 이를 빅데이터라 한다. 자잘한 대량의 데이터에서 마케팅에 필요한 정보를 추출하는 데 유용하다.</p><h3 id="rdbms">RDBMS</h3><p>App과 DBMS는 별도의 프로그램이기 때문에 통신을 해야 한다. App이 요청하면 DBMS는 응답한다.</p><ul><li>data 저장, 조회<li>data 변경, 삭제, 찾기<li>client 인증 및 권한 관리<li>data 간의 관계를 <strong>제어</strong> -&gt; 결함이 생기지 않게 <strong>제어</strong> -&gt; <strong>무결성(Integrity; 온전함)</strong><li>통신 관리: stateless / stateful<li>멀티 스레딩: 여러 어플리케이션이 붙어서 데이터를 요청한다.<li>스레드풀이 구현되어 있다.</ul><p>이와 같이 수많은 기능을 DBMS가 갖추고 있다.</p><h3 id="dbms와-sql">DBMS와 SQL</h3><ul><li>로컬이라 하더라도 전혀 다른 컴퓨터인 것처럼 서로 <strong>통신</strong>해야 한다.<li>SQL(Structured Query Language): 명령을 작성하는 문법: 표준<ul><li>특정 DBMS로부터 독립적으로 사용한다.<li>특정 Vendor의 DBMS에 종속되지 않는다.<li>표준 SQL을 따르기만 한다면 어떤 DBMS도 사용할 수 있다.</ul></ul><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">email</span>
<span class="k">from</span> <span class="n">member</span>
<span class="k">where</span> <span class="n">name</span> <span class="k">like</span> <span class="s1">'홍%'</span>
</pre></table></code></div></div><h3 id="sql--a">SQL + a</h3><p>Oracle DBMS가 SQL 2011버전을 사용한다고 하자. 그렇지만 SQL 2011버전의 일부는 지원하지 않을 수 있다. 또한 여기에 oracle 전용 문법이라고 <strong>oracle DBMS에서만 유효한 명령</strong>이 포함되어 있다. 즉,</p><ul><li><strong>모든 DBMS가 SQL표준을 완벽히 지원하지 못한다.</strong><ul><li>일부 문법은 지원하지 못할 수 있다.</ul><li><strong>또는 DBMS마다 지원하는 SQL버전도 다르다.</strong><li><strong>같은 DBMS라도 버전마다 지원하는 SQL이 다르다.</strong></ul><p>따라서 개발자는 사용할 DBMS에 맞춰 SQL을 작성해야 한다.</p><h3 id="sql과-개발-현실">SQL과 개발 현실</h3><p>SQL문 = 표준 SQL + DBMS 전용 문법</p><ul><li>“같은 Vendor의 DBMS”(같은 제품)라 하더라도 버전마다 사용할 수 있는 문법이 차이가 난다.<li>DBMS가 다른 Vendor의 제품이라면 전용 문법이 다르기 때문에 동작이 안될 수 있다.</ul><p><strong>왜 표준 SQL을 사용하지 않을까?</strong></p><ul><li>DBMS마다 <strong>사용 가능한 문법</strong>이 다를 수 있다.<li>DBMS<strong>전용 문법</strong>은 DBMS <strong>성능을 극한으로 이용</strong>할 수 있다.<ul><li>표준 SQL문법만 사용하면 <strong>이런 이점을 누릴 수 없다.</strong></ul><li>개발자로 DBMS 상황에 맞춰 SQL을 변경해 줘야 한다.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/bitcamp/'>bitcamp</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/bitcamp/" class="post-tag no-text-decoration" >bitcamp</a> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=학원 #61일차: 스레드풀의 구현과 사용, DBMS - 하연&url=https://hayeon17kim.github.io//posts/201020-61/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=학원 #61일차: 스레드풀의 구현과 사용, DBMS - 하연&u=https://hayeon17kim.github.io//posts/201020-61/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=학원 #61일차: 스레드풀의 구현과 사용, DBMS - 하연&url=https://hayeon17kim.github.io//posts/201020-61/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/system-deisign-capacity-estimation/">System Design: Capacity Estimate</a><li><a href="/posts/today-i-learned-2021-04-27/">주니어 성장일기: 2021.04.27</a><li><a href="/posts/today-i-learned-2021-04-26/">주니어 성장일기: 2021.04.26</a><li><a href="/posts/fastcampus-01/">자료구조와 알고리즘이란</a><li><a href="/posts/today-i-learned-2021-04-25/">주니어 성장일기: 2021.04.25</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/bitcamp/">bitcamp</a> <a class="post-tag" href="/tags/modernjs/">modernJS</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/trouble-shooting/">trouble-shooting</a> <a class="post-tag" href="/tags/devil/">devil</a> <a class="post-tag" href="/tags/corejs/">corejs</a> <a class="post-tag" href="/tags/network/">network</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/201123-85/"><div class="card-body"> <span class="timeago small" > Nov 23, 2020 <i class="unloaded">2020-11-23T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>학원 #85일차:서블릿 프로그래밍, WAS, JavaEE와 Servlet 컨테이너, Servlet 인터페이스의 Life-cycle 메서드</h3><div class="text-muted small"><p> 서블릿 프로그래밍 웹 애플리케이션 서버 아키텍쳐의 개념 JavaEE와 Servlet API의 관계 JavaEE 구현체와 서블릿 컨테이너의 관계 eomcs-web-project/src-00 예제 실습 Servlet 인터페이스와 Life-cycle 메서드 WAS(Web Application Server) 아키텍처 이전까지는 사...</p></div></div></a></div><div class="card"> <a href="/posts/201124-86/"><div class="card-body"> <span class="timeago small" > Nov 24, 2020 <i class="unloaded">2020-11-24T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>학원 #86일차:서블릿 프로그래밍, 프로젝트를 WAS 아키텍처로 전환</h3><div class="text-muted small"><p> 서블릿 컨테이너가 관리하는 컴포넌트는 서블릿, 필터, 리스너로 3가지이다. Servlet 만들기 1. javax.servlet.Servlet 인터페이스 구현 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38...</p></div></div></a></div><div class="card"> <a href="/posts/201125-87/"><div class="card-body"> <span class="timeago small" > Nov 25, 2020 <i class="unloaded">2020-11-25T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>학원 #87일차: HTML 태그 사용법</h3><div class="text-muted small"><p> HTML/CSS 학습법: 결과 화면 먼저 보고 소스코드를 확인하자 UI와 UX UX(User Experience; 사용자 경험): 사용자 편의성 ex: 링크에 hover했을 때 커서가 손모양으로 바뀌어야 한다. UI(User Interface): 기능을 하는 화면이 있는가 HTML ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/html5-css3-01/" class="btn btn-outline-primary" prompt="Older"><p>HTML5 CSS3 웹 표준의 정석 #1장: HTML 기본 다지기</p></a> <a href="/posts/doit05/" class="btn btn-outline-primary" prompt="Newer"><p>Do it! 자료구조와 함께 배우는 알고리즘 #5장: 재귀 알고리즘</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Loading comments from <a href="https://disqus.com/">Disqus</a> ...</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//hayeon17kim-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = '학원 #61일차: 스레드풀의 구현과 사용, DBMS'; this.page.url = 'https://hayeon17kim.github.io//posts/201020-61/'; this.page.identifier = '/posts/201020-61/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/MONI56219559">hayeon_kim</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/bitcamp/">bitcamp</a> <a class="post-tag" href="/tags/modernjs/">modernJS</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/trouble-shooting/">trouble shooting</a> <a class="post-tag" href="/tags/devil/">devil</a> <a class="post-tag" href="/tags/corejs/">corejs</a> <a class="post-tag" href="/tags/network/">network</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://hayeon17kim.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
