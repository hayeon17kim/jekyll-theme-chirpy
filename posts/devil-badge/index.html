<!DOCTYPE html><html lang="kr-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="개발자를 위한 소셜 네트워크 서비스: 뱃지 수집 시스템 구현하기" /><meta name="author" content="hayeon_kim" /><meta property="og:locale" content="kr_KR" /><meta name="description" content="개발자 소셜 네트워크 서비스인 “DEVIL(Developer Villlage)😈”의 뱃지 수집 기능을 구현하기까지의 과정을 정리하였습니다." /><meta property="og:description" content="개발자 소셜 네트워크 서비스인 “DEVIL(Developer Villlage)😈”의 뱃지 수집 기능을 구현하기까지의 과정을 정리하였습니다." /><link rel="canonical" href="https://hayeon17kim.github.io//posts/devil-badge/" /><meta property="og:url" content="https://hayeon17kim.github.io//posts/devil-badge/" /><meta property="og:site_name" content="하연" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-08T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="개발자를 위한 소셜 네트워크 서비스: 뱃지 수집 시스템 구현하기" /><meta name="twitter:site" content="@MONI56219559" /><meta name="twitter:creator" content="@hayeon_kim" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"hayeon_kim"},"headline":"개발자를 위한 소셜 네트워크 서비스: 뱃지 수집 시스템 구현하기","dateModified":"2021-03-14T19:52:00+08:00","datePublished":"2021-03-08T00:00:00+08:00","description":"개발자 소셜 네트워크 서비스인 “DEVIL(Developer Villlage)😈”의 뱃지 수집 기능을 구현하기까지의 과정을 정리하였습니다.","url":"https://hayeon17kim.github.io//posts/devil-badge/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hayeon17kim.github.io//posts/devil-badge/"},"@context":"https://schema.org"}</script><title>개발자를 위한 소셜 네트워크 서비스: 뱃지 수집 시스템 구현하기 | 하연</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-173202420-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-173202420-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/bio-photo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">하연</a></div><div class="site-subtitle font-italic">어제보다 나은 코드를 위해</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-laptop-code ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/hayeon17kim" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/MONI56219559" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hayeon17kim','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>개발자를 위한 소셜 네트워크 서비스: 뱃지 수집 시스템 구현하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>개발자를 위한 소셜 네트워크 서비스: 뱃지 수집 시스템 구현하기</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Mar 8, 2021, 12:00 AM +0800" > Mar 8 <i class="unloaded">2021-03-08T00:00:00+08:00</i> </span> by <span class="author"> hayeon_kim </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Mar 14, 2021, 8:52 PM +0900" > Mar 14 <i class="unloaded">2021-03-14T19:52:00+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3136 words">17 min</span></div></div><div class="post-content"><p>개발자 소셜 네트워크 서비스인 “DEVIL(Developer Villlage)😈”의 뱃지 수집 기능을 구현하기까지의 과정을 정리하였습니다.</p><h2 id="바로가기">바로가기</h2><ul><li><p>🤔 <a href="#기획">기획</a></p><li><p>📜 <a href="#요구사항">요구사항</a></p><li><p>✨ <a href="#유아이-프로토타입">유아이 프로토타입</a></p><li><p>📂 <a href="#데이터베이스-모델링">데이터베이스 모델링</a></p><li><p>💻 <a href="#개발">개발</a></p><ul><li><p><a href="#뱃지-수집-기능">뱃지 수집 기능</a></p><p>Batch Scheduler로 뱃지 수집 기능 구현하기</p><li><p><a href="#수집한-뱃지-순서-변경-기능">수집한 뱃지 순서 변경 기능</a></p><p>마이페이지에서 드래그 앤 드롭으로 뱃지 순서를 변경하도록 구현하기</p></ul><li><p>🔨 <a href="#리팩토링">리팩토링</a></p></ul><h2 id="기획">기획</h2><p>개발자 소셜 네트워크 서비스를 구현할 때 꼭 해보고 싶은 서비스가 있었으니, 언어별 뱃지 수여/수집 시스템을 구현하는 것이었다. 어쩌다 ‘뱃지 시스템’이 나왔는가..? 기획의 계기는 다음 세 가지다.</p><p><strong>1. “okky”의 활동점수 &amp; “네이버 카페”의 등업</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/110325028-2a4c7d80-805a-11eb-9f3c-c3b351149cb2.png" alt="image" /></p><p>okky에서는 활동을 많이 할 수록 활동 점수가 쌓인다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/110244860-12b2bd80-7fa4-11eb-96b5-7339c4916b19.png" alt="image" /></p><p>네이버 카페 서비스에서는 멤버마다 등급을 부여하는 등급 관리 메뉴가 제공된다.</p><p>활동점수와 등업 시스템과 같이 유저가 활동을 활발하게 할 만한 유인책이 있되, 유저 타겟층이 개발자인 만큼 개발자들이 원할 만한 유인책이면 좋겠다고 생각했다. 이때 떠오른 게 개발자들의 노트북이었다.</p><p><strong>2. 로고 스티커가 붙은 개발자의 노트북</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/110345977-760b2100-8072-11eb-9eb0-0330a277c150.png" alt="image" /></p><p>개발자들을 보면 자신이 사용하는 언어의 로고 스티커를 노트북에 덕지덕지 붙이고 있는 것을 흔히 볼 수 있다. 이 점에서 착안하여, 각 언어에 대한 글을 많이 쓰면 해당 언어 로고 스티커를 얻을 수 있도록 만들어보자..! 는 것이 목표였다.</p><p><strong>3. <code class="language-plaintext highlighter-rouge">dev.to</code> 사이트의 뱃지 시스템</strong></p><p>스티커를 노트북에 붙이는 행위를 웹 사이트에 연결하기는 어려웠는데, <code class="language-plaintext highlighter-rouge">dev.to</code> 사이트를 통해 실마리를 찾을 수 있었다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/110243369-6bcb2300-7f9d-11eb-91df-181f46ae449b.png" alt="image" /></p><p><code class="language-plaintext highlighter-rouge">dev.to</code> 사이트에서는 유저의 활동에 따라 뱃지를 수여하는 시스템을 가지고 있었다. 다음은 내가 받은 가입 1주년 뱃지이다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/110243638-9d90b980-7f9e-11eb-91ef-2e0f91adb06d.png" alt="image" /></p><p>이렇게 뱃지를 받으면 마이페이지에 뱃지 목록이 함께 뜬다. 유저는 많이 활동할 수록 다양한 뱃지로 자신의 마이페이지를 장식할 수 있다.</p><p>결론적으로 <code class="language-plaintext highlighter-rouge">dev.to</code>의 뱃지 시스템을 차용하되, DEVIL 어플리케이션에서는 각 프로그래밍 언어에 해당하는 뱃지가 있고, 그 뱃지는 그 언어 해쉬태그를 사용한 글이나 댓글을 일정 개수 이상 작성하면 얻을 수 있도록 만들고자 하였다. 이에 기반해 작성한 요구사항은 다음과 같다.</p><h2 id="요구사항">요구사항</h2><ul><li><p>각 태그에 해당하는 뱃지가 있다.</p><li><p>뱃지는 다음과 같이 회원 활동량을 기준으로 수여된다.</p><p>이 외에도 기준을 추가하거나 삭제할 수 있도록 만든다.</p><ul><li>해당 태그를 사용해 작성한 게시글 개수<li>해당 태그를 사용한 게시글에 작성한 댓글 개수<li>가입일로부터 지난 날짜<li>팔로워 수</ul><li><p>뱃지에 대한 기준은 관리자 페이지에서 설정할 수 있다.</p><li><p>기준에 맞으면 회원에게 뱃지가 자동으로 수여된다.</p><li><p>유저는 받은 뱃지로 마이페이지를 꾸밀 수 있다.</p></ul><h2 id="유아이-프로토타입">유아이 프로토타입</h2><p>UI 프로토타이핑 툴은 Figma를 사용했다.</p><p><strong>관리자 화면</strong></p><ul><li>뱃지를 추가, 수정, 조회, 삭제할 수 있다.<li>뱃지를 추가, 수정할 때 뱃지 기준도 추가, 수정할 수 있다.</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/110245586-3a575500-7fa7-11eb-95db-e70a9dddbc0f.png" alt="image" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/110245556-1562e200-7fa7-11eb-930f-792360878388.png" alt="image" /></p><p><strong>마이페이지</strong></p><ul><li>유저가 받은 뱃지는 유저 페이지에서 조회할 수 있다.<li>유저는 뱃지 순서를 변경할 수 있다.</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/110245680-9e7a1900-7fa7-11eb-9a2a-5fdc1a0d0244.png" alt="image" /></p><h2 id="데이터베이스-모델링">데이터베이스 모델링</h2><p>뱃지 시스템을 위한 테이블은 다음과 같다.</p><p>기본적으로 유저(<code class="language-plaintext highlighter-rouge">user</code>), 뱃지(<code class="language-plaintext highlighter-rouge">badge</code>), 뱃지기준(<code class="language-plaintext highlighter-rouge">badge_standard</code>), 평가(<code class="language-plaintext highlighter-rouge">badge_evalutation</code>) 테이블이 있다. 여기에 다대다 관계를 위한 유저-뱃지(<code class="language-plaintext highlighter-rouge">user_badge</code>), 뱃지-태그(<code class="language-plaintext highlighter-rouge">badge_tag</code>) 관계형 테이블을 만들어주었다.</p><p>이때, 원래는 뱃지 평가 테이블 없이 뱃지 기준 테이블에 <code class="language-plaintext highlighter-rouge">가입일_count</code>, <code class="language-plaintext highlighter-rouge">팔로워수_count</code>, <code class="language-plaintext highlighter-rouge">게시글_count</code>, <code class="language-plaintext highlighter-rouge">댓글_count</code> 컬럼을 넣어 데이터를 저장하려고 했다. 그러나 평가되는 항목이 더 많아질 수 있음을 고려하여 확장성을 위해 평가(<code class="language-plaintext highlighter-rouge">badge_evalutation</code>) 테이블을 추가하였다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/110246984-375f6300-7fad-11eb-80a0-c07ffb705226.png" alt="image" /></p><p>그렇게 해서 완성한 ERD는 다음과 같다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/105466251-4cbb4f00-5cd7-11eb-9075-35ad804753f5.png" alt="img" /></p><h2 id="개발">개발</h2><h3 id="뱃지-수집-기능">뱃지 수집 기능</h3><p>뱃지와 뱃지 기준 CRUD는 구현하기 어렵지 않았다. 그러나 뱃지 조건에 맞는 유저를 확인하고 이를 수여하는 기능은 어떻게 구현해야 할 지 감이 잡히지 않았다.</p><p>일단 뱃지를 수여/수집하는 기능은 유저-뱃지 테이블에 값을 추가하는 C(Create)에 해당한다. 이때까지 구현한 C는 유저가 직접 폼에 값을 입력하여 제출할 때(게시글 C), 혹은 버튼을 눌렀을 때(팔로우 C) 실행되도록 하였다. 뱃지 수여도 다른 C와 마찬가지로 특정 테이블(<code class="language-plaintext highlighter-rouge">user_badge</code> 관계형 테이블)에 튜플을 insert 하도록 구현해야 한다. <strong>C 로직을 구현하는 것은 어렵지 않다</strong>. 그러나, 이 구현한 create 로직이 <strong>언제 호출되도록 만들지</strong>가 문제였다. 유저가 로그인을 할 때마다? 관리자가 ‘뱃지 수여하기’ 버튼을 누를 때마다?</p><p>그게 아니라 <strong>자동으로</strong> 로직이 실행되도록 만들어야 한다. 이를 위해 검색을 한 결과 배치 스케줄러라는 도구가 있다는 것을 발견했다. <strong>배치 스케줄러(Batch Scheduler)</strong>란 일괄 처리(Batch Processing) 작업이 설정된 주기에 맞춰 자동으로 수행되도록 지원해주는 도구를 말한다. <strong>특정 업무(Job)를 원하는 시간에 처리할 수 있도록 지원한다</strong>는 특성 때문에 Job Scheduler라고도 불린다. 배치 스케줄러에는 Spring Batch와 <strong>Quartz</strong>가 대표적인데, 간단한 스케줄링의 경우 Quartz를 사용하면 편하다고 하여 Quartz를 사용하기로 하였다.</p><p>해당 어플은 특정 시간(새벽 3시)마다 회원들의 활동량과 뱃지 기준들을 비교해, 기준에 충족할 경우 회원이 뱃지를 수집하도록 만드는 (<code class="language-plaintext highlighter-rouge">DB</code>에 <code class="language-plaintext highlighter-rouge">insert</code>하는) 배치다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CollectJob</span> <span class="o">{</span>
  <span class="nc">CollectService</span> <span class="n">collectService</span><span class="o">;</span>
  <span class="nc">UserService</span> <span class="n">userService</span><span class="o">;</span>
  <span class="nc">BadgeService</span> <span class="n">badgeService</span><span class="o">;</span>
  <span class="nc">BadgeStanService</span> <span class="n">badgeStanService</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">CollectJob</span><span class="o">(</span><span class="nc">CollectService</span> <span class="n">collectService</span><span class="o">,</span> <span class="nc">UserService</span> <span class="n">userService</span><span class="o">,</span>
      <span class="nc">BadgeService</span> <span class="n">badgeService</span><span class="o">,</span> <span class="nc">BadgeStanService</span> <span class="n">badgeStanService</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">collectService</span> <span class="o">=</span> <span class="n">collectService</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">badgeService</span> <span class="o">=</span> <span class="n">badgeService</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="c1">// 초 분 시 일 월 요일</span>
  <span class="nd">@Scheduled</span><span class="o">(</span><span class="n">cron</span> <span class="o">=</span> <span class="s">"0 0 0 3 * *"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Badge</span><span class="o">&gt;</span> <span class="n">badges</span> <span class="o">=</span> <span class="n">badgeService</span><span class="o">.</span><span class="na">list</span><span class="o">((</span><span class="nc">String</span><span class="o">)</span> <span class="kc">null</span><span class="o">);</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    
    <span class="k">for</span> <span class="o">(</span><span class="nc">User</span> <span class="n">user</span> <span class="o">:</span> <span class="n">users</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getNickname</span><span class="o">());</span>
      <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Badge</span><span class="o">&gt;</span> <span class="n">collectedBadges</span> <span class="o">=</span> <span class="n">badgeService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">collectedBadgeNos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;();</span>
      
      <span class="k">for</span> <span class="o">(</span><span class="nc">Badge</span> <span class="n">badge</span> <span class="o">:</span> <span class="n">collectedBadges</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">collectedBadgeNos</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">badge</span><span class="o">.</span><span class="na">getNo</span><span class="o">());</span>
      <span class="o">}</span>
        
      <span class="k">for</span> <span class="o">(</span><span class="nc">Badge</span> <span class="n">badge</span> <span class="o">:</span> <span class="n">badges</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Tag</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">badge</span><span class="o">.</span><span class="na">getTag</span><span class="o">();</span>
        <span class="c1">// 이미 가지고 있는 뱃지라면 건너뛰기</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">collectedBadgeNos</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">badge</span><span class="o">.</span><span class="na">getNo</span><span class="o">()))</span> <span class="o">{</span>
          <span class="k">continue</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// 가지고 있지 않은 뱃지 기준 충족되는지 알아보기</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">BadgeStan</span><span class="o">&gt;</span> <span class="n">standards</span> <span class="o">=</span> <span class="n">badgeStanService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">badge</span><span class="o">.</span><span class="na">getNo</span><span class="o">());</span>
        <span class="c1">// 전체 기준 갯수</span>
        <span class="kt">int</span> <span class="n">totalStandards</span> <span class="o">=</span> <span class="n">standards</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="c1">// 충족되는 기준 갯수</span>
        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
          
        <span class="k">for</span> <span class="o">(</span><span class="nc">BadgeStan</span> <span class="n">standard</span> <span class="o">:</span> <span class="n">standards</span><span class="o">)</span> <span class="o">{</span>
          <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
          <span class="n">params</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"userNo"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getNo</span><span class="o">());</span>
          <span class="n">params</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tagNo"</span><span class="o">,</span> <span class="n">tag</span> <span class="o">==</span> <span class="kc">null</span><span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">tag</span><span class="o">.</span><span class="na">getNo</span><span class="o">());</span>
          <span class="n">params</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"evaluationNo"</span><span class="o">,</span> <span class="n">standard</span><span class="o">.</span><span class="na">getEvaluationNo</span><span class="o">());</span>
          <span class="c1">// 충족된다면 충족되는 기준 갯수를 하나씩 높인다.</span>
          <span class="kt">int</span> <span class="n">userCount</span> <span class="o">=</span> <span class="n">collectService</span><span class="o">.</span><span class="na">getCount</span><span class="o">(</span><span class="n">params</span><span class="o">);</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">userCount</span> <span class="o">&gt;=</span> <span class="n">standard</span><span class="o">.</span><span class="na">getCount</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">count</span><span class="o">++;</span>
          <span class="o">}</span>
        <span class="o">}</span>
          
        <span class="c1">// 충족되는 기준 갯수와 뱃지의 전체 기준 갯수가 같으면 뱃지를 수여한다.</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">totalStandards</span> <span class="o">==</span> <span class="n">count</span> <span class="o">&amp;&amp;</span> <span class="n">totalStandards</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">collectService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Collect</span><span class="o">().</span><span class="na">setUser</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">setBadge</span><span class="o">(</span><span class="n">badge</span><span class="o">));</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/110249055-709cd080-7fb7-11eb-999f-45fc42410778.JPG" alt="alarm" /></p><p>회원이 가지고 있지 않은 뱃지 중 기준에 충족하는 뱃지가 있다면 이를 새벽 3시에 자동으로 수여하도록 만들었다. 회원은 이를 알림창과 마이페이지에서 확인할 수 있다.</p><h3 id="수집한-뱃지-순서-변경-기능">수집한 뱃지 순서 변경 기능</h3><p>받은 뱃지는 수집한 순서대로 마이페이지에서 조회할 수 있다. 그러나 이를 유저의 선호에 따라 순서를 변경할 수 있는 기능을 추가하기 위해서 고민했다. 유저마다 선호하는 뱃지가 다를 거라고 생각했기 때문이다. 예를 들어 나는 Java 개발자인데, 최근에 HTML과 CSS 게시판에서 글을 많이 썼다는 이유로 HTML 뱃지와 CSS 뱃지가 Java 뱃지보다 앞에 나오면 속상하지 않겠는가..</p><p>드래그앤 드롭 기능 자체는 jQuery UI를 사용해 구현하였다. 문제는 드래그앤 드롭으로 순서를 변경했을 때, 변경한 순서를 <code class="language-plaintext highlighter-rouge">db</code> 에<code class="language-plaintext highlighter-rouge">update</code>해야 한다는 것이다. 그렇지 않으면 새로고침을 했을 때 다시 변경 전 원래 순서대로 돌아오고 만다. 따라서 순서가 변경되었을 때, 서버에 비동기 요청을 보내 서버가 <code class="language-plaintext highlighter-rouge">db</code>에 해당 유저의 전체 뱃지 순서를<code class="language-plaintext highlighter-rouge">update</code>하도록 만들었다.</p><p><strong>뱃지 리스트</strong></p><p>유저가 드래그 앤 드롭으로 뱃지 순서를 변경할 때마다, <mark><strong>뱃지 고유번호</strong>가 <strong>변경된 순서대로</strong> `,`로 <strong>연결된 문자열</strong>과 함께 클라이언트는 서버에게 뱃지 순서를 업데이트하라는 <strong>비동기 요청</strong>을 보낸다.</mark></p><p>드래그앤 드롭을 할 때마다 생성되는 문자열의 예시이다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/110316118-9eccef80-804d-11eb-92ab-0482953abf92.png" alt="image" /></p><p>클라이언트는 이 문자열을 서버에 비동기 요청으로 보낸다.</p><div class="language-jsp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-3"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;c:choose&gt;</span>
  	<span class="nt">&lt;c:when </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">user</span><span class="o">.</span><span class="na">no</span> <span class="o">!=</span> <span class="n">loginUser</span><span class="o">.</span><span class="na">no</span> <span class="o">&amp;&amp;</span> <span class="kc">null</span> <span class="n">ne</span> <span class="n">user</span><span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"badge-list"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;/c:when&gt;</span>
     <span class="nt">&lt;c:otherwise&gt;</span>
       <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"badge-list"</span> <span class="na">id=</span><span class="s">"sortable"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;/c:otherwise&gt;</span>
  <span class="nt">&lt;/c:choose&gt;</span>
  <span class="nt">&lt;c:forEach </span><span class="na">items=</span><span class="s">"</span><span class="si">${</span><span class="n">badgeList</span><span class="si">}</span><span class="s">"</span><span class="na"> var=</span><span class="s">"b"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">data-no=</span><span class="s">"${b.no}"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"../../upload/badge/${b.photo}_160X160.png"</span> <span class="err">/</span>
         <span class="err">&lt;/</span><span class="na">li</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/c:forEach&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#sortable</span><span class="dl">"</span><span class="p">).</span><span class="nx">sortable</span><span class="p">({</span>
        <span class="na">start</span> <span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-previndex</span><span class="dl">'</span><span class="p">,</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">index</span><span class="p">());</span>
        <span class="p">},</span>
        <span class="na">update</span> <span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#sortable li</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// 뱃지 번호를 변경된 "순서"대로 배열에 담는다.</span>
                <span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">data-no</span><span class="dl">"</span><span class="p">));</span>
            <span class="p">})</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="na">type</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">url</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">../ajax/collect/updateOrder</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// 서버단 메소드 url</span>
                <span class="na">data</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="c1">// 배열을 문자로 바꿔 서버에게 전송한다.</span>
                    <span class="dl">"</span><span class="s2">order</span><span class="dl">"</span> <span class="p">:</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="na">dataType</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">success</span> <span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                    
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#sortable</span><span class="dl">"</span><span class="p">).</span><span class="nx">disableSelection</span><span class="p">();</span>
<span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><p><strong>뱃지 순서 변경</strong></p><p>뱃지 순서 변경 과정을 그림으로 표현하면 다음과 같다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/50407047/110322386-67af0c00-8056-11eb-809c-d832f9d641c8.png" alt="image" /></p><p>클라이언트가 뱃지고유번호를 변경한 순서대로 나열한 문자열(<code class="language-plaintext highlighter-rouge">"3, 2, 1, 4"</code> )과 함께 <code class="language-plaintext highlighter-rouge">/app/ajax/collect/updateOrder/</code> 요청을 보내면 <code class="language-plaintext highlighter-rouge">DispatcherServlet</code>은 이 요청을 받아 <code class="language-plaintext highlighter-rouge">CollectController</code>가 요청을 처리하도록 보낸다. 그러면 <code class="language-plaintext highlighter-rouge">CollectController</code>는 <code class="language-plaintext highlighter-rouge">Service</code>, <code class="language-plaintext highlighter-rouge">Dao</code>를 거쳐 DB에 있는 유저-뱃지(<code class="language-plaintext highlighter-rouge">usr_bdg</code>) 테이블에 있는 순서 컬럼을 변경한다.</p><p><strong>CollectController</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="nd">@Controller</span><span class="o">(</span><span class="s">"ajax.collectController"</span><span class="o">)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/ajax/collect"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CollectController</span> <span class="o">{</span>
    
  <span class="nd">@Autowired</span> <span class="nc">CollectService</span> <span class="n">collectService</span><span class="o">;</span>
  
  <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"updateOrder"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">updateOrder</span><span class="o">(</span><span class="nc">String</span> <span class="n">order</span><span class="o">,</span> <span class="nc">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      
    <span class="nc">String</span><span class="o">[]</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
      
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Collect</span><span class="o">&gt;</span> <span class="n">collects</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
      
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">orders</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="nc">Collect</span> <span class="n">collect</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Collect</span><span class="o">();</span>
      <span class="n">collect</span><span class="o">.</span><span class="na">setUser</span><span class="o">((</span><span class="nc">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"loginUser"</span><span class="o">));</span>
      <span class="n">collect</span><span class="o">.</span><span class="na">setBadge</span><span class="o">(</span><span class="k">new</span> <span class="nc">Badge</span><span class="o">().</span><span class="na">setNo</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">orders</span><span class="o">[</span><span class="n">i</span><span class="o">])));</span>
      <span class="n">collect</span><span class="o">.</span><span class="na">setOrder</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
      <span class="n">collects</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">collect</span><span class="o">);</span>
    <span class="o">}</span>
      
    <span class="n">collectService</span><span class="o">.</span><span class="na">updateAllOrder</span><span class="o">(</span><span class="n">collects</span><span class="o">);</span>
      
    <span class="k">return</span> <span class="s">"redirect:"</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"Referer"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>CollectService</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DefaultCollectService</span> <span class="kd">implements</span> <span class="nc">CollectService</span> <span class="o">{</span>
  <span class="nc">CollectDao</span> <span class="n">collectDao</span><span class="o">;</span>
  <span class="nc">NotificationDao</span> <span class="n">notificationDao</span><span class="o">;</span>
  <span class="c1">//..</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateAllOrder</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Collect</span><span class="o">&gt;</span> <span class="n">collects</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Collect</span> <span class="n">collect</span> <span class="o">:</span> <span class="n">collects</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">collectDao</span><span class="o">.</span><span class="na">updateOrder</span><span class="o">(</span><span class="n">collect</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">//..</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>CollectDao</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CollectDao</span> <span class="o">{</span>
  <span class="c1">//..</span>
  <span class="kt">void</span> <span class="nf">updateOrder</span><span class="o">(</span><span class="nc">Collect</span> <span class="n">collect</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>CollectMapper</strong></p><pre><code class="language-mysql">&lt;update id="updateOrder" parameterType="collect"&gt;
    update usr_bdg set
    ord = #{order}
    where uno=#{user.no} and bno=#{badge.no};
&lt;/update&gt;
</code></pre><h2 id="테스트">테스트</h2><h2 id="리팩토링">리팩토링</h2><p>작업 중입니다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devil/'>devil</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/project/" class="post-tag no-text-decoration" >project</a> <a href="/tags/devil/" class="post-tag no-text-decoration" >devil</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=개발자를 위한 소셜 네트워크 서비스: 뱃지 수집 시스템 구현하기 - 하연&url=https://hayeon17kim.github.io//posts/devil-badge/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=개발자를 위한 소셜 네트워크 서비스: 뱃지 수집 시스템 구현하기 - 하연&u=https://hayeon17kim.github.io//posts/devil-badge/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=개발자를 위한 소셜 네트워크 서비스: 뱃지 수집 시스템 구현하기 - 하연&url=https://hayeon17kim.github.io//posts/devil-badge/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/system-deisign-capacity-estimation/">System Design: Capacity Estimate</a><li><a href="/posts/today-i-learned-2021-04-27/">주니어 성장일기: 2021.04.27</a><li><a href="/posts/today-i-learned-2021-04-26/">주니어 성장일기: 2021.04.26</a><li><a href="/posts/fastcampus-01/">자료구조와 알고리즘이란</a><li><a href="/posts/today-i-learned-2021-04-25/">주니어 성장일기: 2021.04.25</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/bitcamp/">bitcamp</a> <a class="post-tag" href="/tags/modernjs/">modernJS</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/trouble-shooting/">trouble-shooting</a> <a class="post-tag" href="/tags/devil/">devil</a> <a class="post-tag" href="/tags/corejs/">corejs</a> <a class="post-tag" href="/tags/network/">network</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/devil-02/"><div class="card-body"> <span class="timeago small" > Nov 19, 2020 <i class="unloaded">2020-11-19T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DEVIL: 프로그래머스 채용공고 크롤링</h3><div class="text-muted small"><p> 변경사항 사람인의 채용공고의 경우 채용공고 게시글의 내용이 이미지 파일인 경우가 많아, 텍스트로 가져오기가 힘들었다. 채용공고 내용이 텍스트로 되어 있고, 채용공고가 개발자 직군에 한정된 프로그래머스 사이트의 채용공고를 크롤링하기로 결정하였다. 채용공고 내용을 가져오기 위해 크롤링 사이트를 바꾼 만큼, 목록 페이지가 아니라 상세보기 페이...</p></div></div></a></div><div class="card"> <a href="/posts/devil-03/"><div class="card-body"> <span class="timeago small" > Nov 23, 2020 <i class="unloaded">2020-11-23T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DEVIL: mysql의 datatime 타입과 java.util.Date 클래스</h3><div class="text-muted small"><p> 문제 Article의 cdt 컬럼(datetime)에 해당하는 도메인 객체의 필드는 어떤 타입으로 지정해야 할까? 다시 말해, 컬럼의 타입이 datetime일 때는 해당 도메인 객체의 타입을 어떻게 지정하는 것이 좋을까? java.sql.Date 의 경우 시간 정보가 저장되지 않는다. Java.sql.Time의 경우 날짜 정보가 저장되지 않는다. j...</p></div></div></a></div><div class="card"> <a href="/posts/devil-28/"><div class="card-body"> <span class="timeago small" > Dec 4, 2020 <i class="unloaded">2020-12-04T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DEVIL: 태그 언팔로우 시 /tag/list로 redirect하는 문제</h3><div class="text-muted small"><p> 문제 /auth/loginUser/페이지에서 태그를 언팔로우했을 때, UserUnfollowTagServlet에서 /tag/list로 리다이렉트하고 있다. /user/unfollow를 호출한 페이지로 리다이렉트되도록 만들어야 한다. 해결방법 이전에는 UserUnfollowTagServlet에서 다음과 같이 고정된 URL 값을 주었다. 따라서 어떤...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/programmers-survival-kit-07/" class="btn btn-outline-primary" prompt="Older"><p>깊이우선탐색(DFS): 올바른 괄호의 개수</p></a> <a href="/posts/fastcampus-01/" class="btn btn-outline-primary" prompt="Newer"><p>자료구조와 알고리즘이란</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Loading comments from <a href="https://disqus.com/">Disqus</a> ...</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//hayeon17kim-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = '개발자를 위한 소셜 네트워크 서비스: 뱃지 수집 시스템 구현하기'; this.page.url = 'https://hayeon17kim.github.io//posts/devil-badge/'; this.page.identifier = '/posts/devil-badge/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/MONI56219559">hayeon_kim</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/bitcamp/">bitcamp</a> <a class="post-tag" href="/tags/modernjs/">modernJS</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/trouble-shooting/">trouble shooting</a> <a class="post-tag" href="/tags/devil/">devil</a> <a class="post-tag" href="/tags/corejs/">corejs</a> <a class="post-tag" href="/tags/network/">network</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://hayeon17kim.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
