<!DOCTYPE html><html lang="kr-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="학원 #57일차: 네트워크 API를 활용한 C/S 아키텍처" /><meta name="author" content="hayeon_kim" /><meta property="og:locale" content="kr_KR" /><meta name="description" content="네트워크 API를 활용한 C/S 아키텍처" /><meta property="og:description" content="네트워크 API를 활용한 C/S 아키텍처" /><link rel="canonical" href="https://hayeon17kim.github.io//posts/201014-57/" /><meta property="og:url" content="https://hayeon17kim.github.io//posts/201014-57/" /><meta property="og:site_name" content="하연" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-10-14T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="학원 #57일차: 네트워크 API를 활용한 C/S 아키텍처" /><meta name="twitter:site" content="@MONI56219559" /><meta name="twitter:creator" content="@hayeon_kim" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"hayeon_kim"},"headline":"학원 #57일차: 네트워크 API를 활용한 C/S 아키텍처","dateModified":"2020-10-14T00:00:00+08:00","datePublished":"2020-10-14T00:00:00+08:00","description":"네트워크 API를 활용한 C/S 아키텍처","url":"https://hayeon17kim.github.io//posts/201014-57/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hayeon17kim.github.io//posts/201014-57/"},"@context":"https://schema.org"}</script><title>학원 #57일차: 네트워크 API를 활용한 C/S 아키텍처 | 하연</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-173202420-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-173202420-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/bio-photo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">하연</a></div><div class="site-subtitle font-italic">어제보다 나은 코드를 위해</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-laptop-code ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/hayeon17kim" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/MONI56219559" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hayeon17kim','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>학원 #57일차: 네트워크 API를 활용한 C/S 아키텍처</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>학원 #57일차: 네트워크 API를 활용한 C/S 아키텍처</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Oct 14, 2020, 12:00 AM +0800" > Oct 14, 2020 <i class="unloaded">2020-10-14T00:00:00+08:00</i> </span> by <span class="author"> hayeon_kim </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="7265 words">40 min</span></div></div><div class="post-content"><h1 id="네트워크-api를-활용한-cs-아키텍처">네트워크 API를 활용한 C/S 아키텍처</h1><h2 id="클라이언트서버-프로젝트-준비">클라이언트/서버 프로젝트 준비</h2><blockquote><p>git/eomcs-java-project/mini-pms-34-a-client/server</p></blockquote><h3 id="데스크톱-애플리케이션">데스크톱 애플리케이션</h3><ul><li>다른 애플리케이션과 연동하지 않고 단독적으로 실행한다.<li>보통 PC나 노트북에 설치해서 사용한다.<li>MS-Word, Adobe Photoshop, 메모장 등</ul><h3 id="clientserver-애플리케이션">Client/Server 애플리케이션</h3><ul><li>클라이언트는 서버에게 서비스나 자원을 요청하는 일을 한다.<li>서버는 클라이언트에게 자원이나 서비스를 제공하는 일을 한다.</ul><h3 id="실습">실습</h3><ul><li>1단계: 서버/클라이언트 프로젝트 폴더 생성<li>2단계: 서버/클라이언트 프로젝트 폴더를 Maven 기본 자바 디렉토리 구조로 초기화<ul><li><code class="language-plaintext highlighter-rouge">gradle init</code> 실행</ul><li>3단계: 이클립스 IDE로 임포트<ul><li><code class="language-plaintext highlighter-rouge">build.gradle</code>에 <code class="language-plaintext highlighter-rouge">eclipse</code> gradle 플러그인 추가<li><code class="language-plaintext highlighter-rouge">gradle eclipse</code>: 이클립스 설정 파일 생성<li>이클립스에서 프로젝트 폴더 임포트</ul><li>4단계: 애플리케이션 메인 클래스를 변경<ul><li>각 <code class="language-plaintext highlighter-rouge">App.java</code>를 <code class="language-plaintext highlighter-rouge">ServerApp.java</code>와 <code class="language-plaintext highlighter-rouge">ClientApp.java</code>로 변경</ul></ul><h2 id="간단한-메시지-송수신">간단한 메시지 송수신</h2><blockquote><p>git/eomcs-java-project/mini-pms-34-b-client/server</p></blockquote><p><strong>Server</strong></p><ul><li>ServerSocket을 준비해 클라이언트를 기다린다.<li>accept()를 통해 리턴된 소켓 객체로부터 입출력 스트림을 얻는다.<li>클라이언트가 보낸 데이터를 그대로 반송한다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>
      
      <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
          <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
          <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()))</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
      <span class="o">}</span> 
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>Client</strong></p><ul><li>서버와 연결한 후 메시지를 주고 받는다.<li><code class="language-plaintext highlighter-rouge">ClientApp</code>으로 이름을 변경한 후 서버와 연결된 Socket 객체를 통해 입출력 스트림을 준비하여 메시지를 주고받는다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">8888</span><span class="o">);</span>
        <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
         <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()))</span> <span class="o">{</span>
           <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello!"</span><span class="o">);</span>
           <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
           
           <span class="nc">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
           <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
           
         <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
         <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="사용자가-입력한-명령-처리">사용자가 입력한 명령 처리</h2><blockquote><p>git/eomcs-java-project/mini-pms-34-c-client/server</p></blockquote><p><strong>Client</strong></p><ul><li>사용자가 입력한 명령을 서버에 전송한다.<li>사용자가 quit 명령을 입력할 때까지 반복한다.<li>stateful 통신</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">8888</span><span class="o">);</span>
        <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
        <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">())))</span> <span class="o">{</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">input</span> <span class="o">=</span> <span class="nc">Prompt</span><span class="o">.</span><span class="na">inputString</span><span class="o">(</span><span class="s">"명령&gt; "</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

        <span class="nc">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span>
          <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>Server</strong></p><ul><li>클라이언트의 요청을 반복해서 처리한다.<li>클라이언트가 <code class="language-plaintext highlighter-rouge">quit</code> 명령을 보내면 응답한 후 클라이언트와의 연결을 끊는다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>

      <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
          <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
          <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()))</span> <span class="o">{</span>

        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
          <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>

          <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
          <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

          <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="요청응답-프로토콜-정의">요청/응답 프로토콜 정의</h2><blockquote><p>git/eomcs-java-project/mini-pms-34-d-client/server</p></blockquote><ul><li>프로토콜이란 클라이언트/서버 간에 데이터를 주고 받는 형식</ul><p><strong>Server</strong></p><p>응답을 종료할 때 빈 줄을 보낸다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>

      <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
          <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
          <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()))</span> <span class="o">{</span>

        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
          <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>

          <span class="n">sendResponse</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>

          <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sendResponse</span><span class="o">(</span><span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
    <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>Client</strong></p><p>서버가 응답의 끝을 알리는 빈 줄을 보낼 때까지 클라이언트는 계속 읽는다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">8888</span><span class="o">);</span>
        <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
        <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">())))</span> <span class="o">{</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">input</span> <span class="o">=</span> <span class="nc">Prompt</span><span class="o">.</span><span class="na">inputString</span><span class="o">(</span><span class="s">"명령&gt; "</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

        <span class="n">receiveResponse</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span>
          <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">receiveResponse</span><span class="o">(</span><span class="nc">BufferedReader</span> <span class="n">in</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
   <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
     <span class="nc">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
       <span class="k">break</span><span class="o">;</span>
     <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
   <span class="o">}</span>
 <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="다중-클라이언트의-요청-처리">다중 클라이언트의 요청 처리</h2><blockquote><p>git/eomcs-java-project/mini-pms-34-e-client/server</p></blockquote><p><strong>Server</strong></p><ul><li>클라이언트와의 연결을 순차적으로 반복하여 처리한다.<li>클라이언트가 접속하거나 연결을 끊으면 로그를 남긴다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">handleClient</span><span class="o">(</span><span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">());</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sendResponse</span><span class="o">(</span><span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
    <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">handleClient</span><span class="o">(</span><span class="nc">Socket</span> <span class="n">clientSocket</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">InetAddress</span> <span class="n">address</span> <span class="o">=</span> <span class="n">clientSocket</span><span class="o">.</span><span class="na">getInetAddress</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)가 연결되었습니다.\n"</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>
    
    <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">clientSocket</span><span class="o">;</span>
        <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStreamReader</span><span class="o">()));</span>
        <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()))</span> <span class="o">{</span>
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="n">sendResponse</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span>
          <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"클라이언트와의 통신 오류!"</span><span class="o">)</span>
    <span class="o">}</span>
    
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)와의 연결을 끊었습니다.\n"</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>Client</strong></p><ul><li>애플리케이션 아규먼트를 통해 서버 주소와 포트번호를 입력받는다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    
    <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"프로그램 사용법: "</span><span class="o">);</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"	java -cp ... Client 서버주소 포트번호"</span><span class="o">);</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="n">arg</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">arg</span><span class="o">[</span><span class="mi">1</span><span class="o">]));</span>
        <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
        <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">())))</span> <span class="o">{</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">input</span> <span class="o">=</span> <span class="nc">Prompt</span><span class="o">.</span><span class="na">inputString</span><span class="o">(</span><span class="s">"명령&gt; "</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

        <span class="n">receiveResponse</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span>
          <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">receiveResponse</span><span class="o">(</span><span class="nc">BufferedReader</span> <span class="n">in</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
   <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
     <span class="nc">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
       <span class="k">break</span><span class="o">;</span>
     <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
   <span class="o">}</span>
 <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="다중-클라이언트의-동시-접속-처리">다중 클라이언트의 동시 접속 처리</h2><blockquote><p>git/eomcs-java-project/mini-pms-34-f-client/server</p></blockquote><h3 id="서버">서버</h3><p><strong>0단계: 클라이언트 요청 처리 부분을 별도의 스레드로 분리하여 처리</strong></p><ul><li>ClienthandlerThread 추가<ul><li>Thread를 상속받는다.<li>클라이언트의 요청 처리를 담당한다.</ul><li><code class="language-plaintext highlighter-rouge">ServerApp</code> 클래스 변경<ul><li>클라이언트 요청 처리를 <code class="language-plaintext highlighter-rouge">ClientHandlerThread</code>에게 맡긴다.</ul></ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>
      
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">ClientHandlerThread</span><span class="o">(</span><span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">()).</span><span class="na">start</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientHandlerThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
  <span class="nc">Socket</span> <span class="n">socket</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="nf">ClientHandler</span><span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">;</span>
  <span class="o">}</span>
  
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">InetAddress</span> <span class="n">address</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">socket</span><span class="o">.</span><span class="na">getInetAddress</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)가 연결되었습니다.\n"</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>
    
    <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">socket</span><span class="o">;</span>
        <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStreamReader</span><span class="o">()));</span>
        <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()))</span> <span class="o">{</span>
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="n">sendResponse</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
        
        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span>
          <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"클라이언트와의 통신 오류!"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)와의 연결을 끊었습니다.\n"</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">sendResponse</span><span class="o">(</span><span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">,</span> <span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
    <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>1단계: 클라이언트의 요청 처리 부분을 <code class="language-plaintext highlighter-rouge">Runnable</code> 구현체로 분리하여 처리한다.</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>
      
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 외부 클래스 사용</span>
        <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">ClientHandler</span><span class="o">(</span><span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">())).</span><span class="na">start</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientHandler</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span> <span class="c1">//..</span>
</pre></table></code></div></div><p><strong>2단계: <code class="language-plaintext highlighter-rouge">ClientHandler</code>를 <code class="language-plaintext highlighter-rouge">ServerApp</code>의 스태틱 중첩 클래스로 선언한다.</strong></p><p>ClientHandler는 다른 클래스가 사용할 일이 없기 때문에 private으로 선언한다. 바깥 클래스의 특정 인스턴스 멤버를 사용할 일이 없기 때문에 static nested class로 선언한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">ClientHandler</span><span class="o">(</span><span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">())).</span><span class="na">start</span><span class="o">();</span>
      <span class="o">}</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="c1">// static nested class</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ClientHandler</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
    <span class="nc">Socket</span> <span class="n">socket</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ClientHandler</span><span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>

      <span class="nc">InetAddress</span> <span class="n">address</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">socket</span><span class="o">.</span><span class="na">getInetAddress</span><span class="o">();</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)가 연결되었습니다.\n"</span><span class="o">,</span>
          <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>

      <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">socket</span><span class="o">;</span> <span class="c1">// try 블록을 떠날 때 close()가 자동 호출된다.</span>
          <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
          <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()))</span> <span class="o">{</span>

        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
          <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>

          <span class="n">sendResponse</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>

          <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>


      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"클라이언트와의 통신 오류!"</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)와의 연결을 끊었습니다.\n"</span><span class="o">,</span>
          <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">sendResponse</span><span class="o">(</span><span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">,</span> <span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span> <span class="c1">// 응답이 끝났음을 알리는 빈 줄을 보낸다.</span>
      <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>2단계: <code class="language-plaintext highlighter-rouge">ClientHandler</code>를 <code class="language-plaintext highlighter-rouge">main</code>의 익명 클래스로 정의한다.</strong></p><p>익명 클래스는 생성자를 정의해줄 수 없다. 따라서 생성자의 파라미터로 소켓을 받는 것이 아니라, main()의 로컬 변수로 소켓을 선언하고 익명 클래스 내부에서 그 변수에 접근하여 사용하도록 만들어준다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Socket</span> <span class="n">clientSocket</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
        <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>

            <span class="nc">InetAddress</span> <span class="n">address</span> <span class="o">=</span> <span class="n">clientSocket</span><span class="o">.</span><span class="na">getInetAddress</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)가 연결되었습니다.\n"</span><span class="o">,</span>
                <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>

            <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">clientSocket</span><span class="o">;</span>
                <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
                <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()))</span> <span class="o">{</span>

              <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>

                <span class="n">sendResponse</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span>
                  <span class="k">break</span><span class="o">;</span>
              <span class="o">}</span>

            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"클라이언트와의 통신 오류!"</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)와의 연결을 끊었습니다.\n"</span><span class="o">,</span>
                <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>
          <span class="o">}</span>

          <span class="kd">private</span> <span class="kt">void</span> <span class="nf">sendResponse</span><span class="o">(</span><span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">,</span> <span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
            <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span> <span class="c1">// 응답이 끝났음을 알리는 빈 줄을 보낸다.</span>
            <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
          <span class="o">}</span>
        <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
      <span class="o">}</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>3단계: <code class="language-plaintext highlighter-rouge">main()</code>의 익명 클래스의 코드를 바깥 클래스의 멤버로 만든 후 그 바깥 클래스의 멤버를 호출한다.</strong></p><p>중첩이 줄기 때문에 코드를 읽기 쉽다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Socket</span> <span class="n">clientSocket</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
        <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">handleClient</span><span class="o">(</span><span class="n">clientSocket</span><span class="o">);</span>
          <span class="o">}</span>
        <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
      <span class="o">}</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">handleClient</span><span class="o">(</span><span class="nc">Socket</span> <span class="n">clientSocket</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">InetAddress</span> <span class="n">address</span> <span class="o">=</span> <span class="n">clientSocket</span><span class="o">.</span><span class="na">getInetAddress</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)가 연결되었습니다.\n"</span><span class="o">,</span>
        <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>

    <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">clientSocket</span><span class="o">;</span>
        <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
        <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()))</span> <span class="o">{</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="n">sendResponse</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span>
          <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>


    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"클라이언트와의 통신 오류!"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)와의 연결을 끊었습니다.\n"</span><span class="o">,</span>
        <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sendResponse</span><span class="o">(</span><span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">,</span> <span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span> <span class="c1">// 응답이 끝났음을 알리는 빈 줄을 보낸다.</span>
    <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>익명 클래스에 정의되어 있던 <code class="language-plaintext highlighter-rouge">sendResponse()</code>는 <code class="language-plaintext highlighter-rouge">handleClient()</code>에서 사용하기 때문에 <code class="language-plaintext highlighter-rouge">ServerApp</code>의 메서드로 정의한다. 두 메서드는 static 메서드인 <code class="language-plaintext highlighter-rouge">main()</code>에서 호출하고 있기 때문에 모두 static 메서드로 선언한다.</p><p><strong>4단계: 익명 클래스를 람바 문법으로 변경한다.</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">handleClient</span><span class="o">(</span><span class="n">clientSocket</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">start</span><span class="o">();</span>
</pre></table></code></div></div><p>위의 코드를 다음과 같이 바꿔줄 수 있다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span>  <span class="o">-&gt;</span> <span class="n">handleClient</span><span class="o">(</span><span class="n">clientSocket</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</pre></table></code></div></div><h2 id="pms-코드를-cs로-분리">PMS 코드를 C/S로 분리</h2><blockquote><p>git/eomcs-java-project/mini-pms-34-g-client/server</p></blockquote><h3 id="server">Server</h3><h4 id="1단계-json-데이터-포맷을-다룰-gson-라이브러리를-추가한다">1단계: JSON 데이터 포맷을 다룰 Gson 라이브러리를 추가한다.</h4><ul><li><code class="language-plaintext highlighter-rouge">build.gradle</code> 파일에 gson 라이브러리 정보를 추가한다.<li><code class="language-plaintext highlighter-rouge">$ gradle eclipse</code>를 실행하여 라이브러리를 프로젝트에 추가한다.<li>이클립스 IDE에서 프로젝트를 <code class="language-plaintext highlighter-rouge">refresh</code>한다.</ul><h4 id="2단계-기존-애플리케이션에서-관련된-패키지-및-클래스를-가져온다">2단계: 기존 애플리케이션에서 관련된 패키지 및 클래스를 가져온다.</h4><ul><li><code class="language-plaintext highlighter-rouge">com.eomcs.pms.domain</code> 패키지 및 그 하위 클래스를 가져온다.<li><code class="language-plaintext highlighter-rouge">com.eomcs.pms.handler</code> 패키지 및 그 하위 클래스를 가져온다.<li><code class="language-plaintext highlighter-rouge">com.eomcs.context</code> 패키지 및 그 하위 클래스를 가져온다.<li><code class="language-plaintext highlighter-rouge">com.eomcs.pms.listener</code> 패키지 및 그 하위 클래스를 가져온다.<li><code class="language-plaintext highlighter-rouge">com.eomcs.pms.ServerApp</code> 변경<ul><li><code class="language-plaintext highlighter-rouge">com.eomcs.pms.App</code> 클래스에서 옵저버 패턴과 관련된 코드를 가져온다.</ul></ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>
  
  <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Hashtable</span><span class="o">&lt;&gt;();</span>

  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ApplicationContextListener</span><span class="o">&gt;</span> <span class="n">listeners</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addApplicationContextListener</span><span class="o">(</span><span class="nc">ApplicationContextListener</span> <span class="n">listener</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">listeners</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeApplicationContextListener</span><span class="o">(</span><span class="nc">ApplicationContextListener</span> <span class="n">listener</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">listeners</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">notifyApplicationContextListenerOnServiceStarted</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">ApplicationContextListener</span> <span class="n">listener</span> <span class="o">:</span> <span class="n">listeners</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">listener</span><span class="o">.</span><span class="na">contextInitialized</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">notifyApplicationContextListenerOnServiceStopped</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">ApplicationContextListener</span> <span class="n">listener</span> <span class="o">:</span> <span class="n">listeners</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">listener</span><span class="o">.</span><span class="na">contextDestroyed</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">server</span><span class="o">.</span><span class="na">service</span><span class="o">(</span><span class="mi">8888</span><span class="o">);</span>
  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">notifyApplicationContextListenerOnServiceStarted</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="n">port</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Socket</span> <span class="n">clientSocket</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
        <span class="k">new</span> <span class="nf">Thread</span><span class="o">(()</span>  <span class="o">-&gt;</span> <span class="n">handleClient</span><span class="o">(</span><span class="n">clientSocket</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nc">Prompt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="n">notifyApplicationContextListenerOnServiceStopped</span><span class="o">();</span>
  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleClient</span><span class="o">(</span><span class="nc">Socket</span> <span class="n">clientSocket</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">InetAddress</span> <span class="n">address</span> <span class="o">=</span> <span class="n">clientSocket</span><span class="o">.</span><span class="na">getInetAddress</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)가 연결되었습니다.\n"</span><span class="o">,</span>
        <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>

    <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">clientSocket</span><span class="o">;</span>
        <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
        <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()))</span> <span class="o">{</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="n">sendResponse</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span>
          <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"클라이언트와의 통신 오류!"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)와의 연결을 끊었습니다.\n"</span><span class="o">,</span>
        <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="3단계---클라이언트의-stop-명령을-처리한다">3단계 - 클라이언트의 “stop” 명령을 처리한다.</h4><p><strong>ServerApp</strong> 서버의 종료를 제어하기 위해 stop 필드를 추가하였다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="n">stop</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
  <span class="c1">//..</span>
</pre></table></code></div></div><p><strong>ServerApp.handleClient()</strong></p><p>이 메서드에서는 클라이언트에서 <code class="language-plaintext highlighter-rouge">stop</code>을 입력했을 때 서버를 종료할 수 있도록 stop 변수를 true로 바꾼다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleClient</span><span class="o">(</span><span class="nc">Socket</span> <span class="n">clientSocket</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">InetAddress</span> <span class="n">address</span> <span class="o">=</span> <span class="n">clientSocket</span><span class="o">.</span><span class="na">getInetAddress</span><span class="o">();</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)가 연결되었습니다.\n"</span><span class="o">,</span>
                    <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>

  <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">clientSocket</span><span class="o">;</span>
       <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
       <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()))</span> <span class="o">{</span>

    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"stop"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버를 종료하는 중입니다."</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>

  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"클라이언트와의 통신 오류!"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)와의 연결을 끊었습니다.\n"</span><span class="o">,</span>
                    <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ServerApp.service()</strong></p><p><strong>클라이언트와 연결할 때</strong> “stop”의 상태가 true 이면 서버를 멈춘다. 다만 서버를 멈추기 위해서는 반복문이 다시 한번 돌아야 한다, 즉 stop을 입력한 클라이언트 뒤 다른 클라이언트가 접속했을 때 비로소 서버가 종료된다. 이것은 클라이언트 앱에서 처리해준다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">notifyApplicationContextListenerOnServiceStarted</span><span class="o">();</span>
  <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="n">port</span><span class="o">))</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">prinltn</span><span class="o">(</span><span class="s">"서버 실행 중..."</span><span class="o">);</span>
    
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// stop이 true이면 서버를 멈춘다.</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">stop</span><span class="o">)</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="nc">Socket</span> <span class="n">clientSocket</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
      <span class="k">new</span> <span class="nf">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">handleClient</span><span class="o">(</span><span class="n">clientSocket</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="n">notifyApplicationContextListenerOnServicStopped</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="4단계---파일에서-json-데이터를-로딩하고-파일로-저장하는-옵저버를-등록한다">4단계 - 파일에서 JSON 데이터를 로딩하고 파일로 저장하는 옵저버를 등록한다.</h4><p><strong>ServerApp.main()</strong></p><p>AppInitListener와 DataHandlerListener를 등록한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerApp</span> <span class="o">{</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ApplicationContextListener</span><span class="o">&gt;</span> <span class="n">listeners</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addApplicationContextListener</span><span class="o">(</span><span class="nc">ApplicationContextListener</span> <span class="n">listener</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">listeners</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeApplicationContextListener</span><span class="o">(</span><span class="nc">ApplicationContextListener</span> <span class="n">listener</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">listeners</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="c1">//...</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    
    <span class="nc">ServerApp</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerApp</span><span class="o">();</span>
    <span class="c1">// 옵저버 등록</span>
    <span class="n">server</span><span class="o">.</span><span class="na">addApplicationContextListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">AppInitListener</span><span class="o">());</span>
    <span class="n">server</span><span class="o">.</span><span class="na">addApplicationContextListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">DataHandlerListener</span><span class="o">());</span>

    <span class="n">server</span><span class="o">.</span><span class="na">service</span><span class="o">(</span><span class="mi">8888</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="5단계---클라이언트의-요청을-처리하는-command-객체를-준비한다">5단계 - 클라이언트의 요청을 처리하는 Command 객체를 준비한다.</h4><p><strong>pms.listener.RequestMappingListener</strong></p><p><code class="language-plaintext highlighter-rouge">DataHandlerListener</code> 가 준비한 데이터를 가지고 Command 객체를 생성한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestMappingListener</span> <span class="kd">implements</span> <span class="nc">ApplicationContextListener</span><span class="o">{</span>

  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextInitialized</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">&gt;</span> <span class="n">boardList</span> <span class="o">=</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">&gt;)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"boardList"</span><span class="o">);</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">memberList</span> <span class="o">=</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"memberList"</span><span class="o">);</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Project</span><span class="o">&gt;</span> <span class="n">projectList</span> <span class="o">=</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Project</span><span class="o">&gt;)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"projectList"</span><span class="o">);</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Task</span><span class="o">&gt;</span> <span class="n">taskList</span> <span class="o">=</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Task</span><span class="o">&gt;)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"taskList"</span><span class="o">);</span>
    
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/board/add"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BoardAddCommand</span><span class="o">(</span><span class="n">boardList</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/board/list"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BoardListCommand</span><span class="o">(</span><span class="n">boardList</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/board/update"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BoardUpdateCommand</span><span class="o">(</span><span class="n">boardList</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/board/delete"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BoardDeleteCommand</span><span class="o">(</span><span class="n">boardList</span><span class="o">));</span>

    <span class="nc">MemberListCommand</span> <span class="n">memberListCommand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MemberListCommand</span><span class="o">(</span><span class="n">memberList</span><span class="o">);</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/member/add"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberAddCommand</span><span class="o">(</span><span class="n">memberList</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/member/list"</span><span class="o">,</span> <span class="n">memberListCommand</span><span class="o">);</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/member/detail"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberDetailCommand</span><span class="o">(</span><span class="n">memberList</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/member/update"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberUpdateCommand</span><span class="o">(</span><span class="n">memberList</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/member/delete"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberDeleteCommand</span><span class="o">(</span><span class="n">memberList</span><span class="o">));</span>

    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/project/add"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ProjectAddCommand</span><span class="o">(</span><span class="n">projectList</span><span class="o">,</span> <span class="n">memberListCommand</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/project/list"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ProjectListCommand</span><span class="o">(</span><span class="n">projectList</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/project/detail"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ProjectDetailCommand</span><span class="o">(</span><span class="n">projectList</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/project/update"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ProjectUpdateCommand</span><span class="o">(</span><span class="n">projectList</span><span class="o">,</span> <span class="n">memberListCommand</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/project/delete"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ProjectDeleteCommand</span><span class="o">(</span><span class="n">projectList</span><span class="o">));</span>

    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/task/add"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">TaskAddCommand</span><span class="o">(</span><span class="n">taskList</span><span class="o">,</span> <span class="n">memberListCommand</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/task/list"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">TaskListCommand</span><span class="o">(</span><span class="n">taskList</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/task/detail"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">TaskDetailCommand</span><span class="o">(</span><span class="n">taskList</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/task/update"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">TaskUpdateCommand</span><span class="o">(</span><span class="n">taskList</span><span class="o">,</span> <span class="n">memberListCommand</span><span class="o">));</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/task/delete"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">TaskDeleteCommand</span><span class="o">(</span><span class="n">taskList</span><span class="o">));</span>

    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">HelloCommand</span><span class="o">());</span>
    
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextDestroyed</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span> 
  <span class="o">}</span> 
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ServerApp.main()</strong></p><p><code class="language-plaintext highlighter-rouge">RequestMappingListener</code> 를 등록한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

  <span class="nc">ServerApp</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerApp</span><span class="o">();</span>
  
  <span class="n">server</span><span class="o">.</span><span class="na">addApplicationContextListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">AppInitListener</span><span class="o">());</span>
  <span class="n">server</span><span class="o">.</span><span class="na">addApplicationContextListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">DataHandlerListener</span><span class="o">());</span>
  <span class="c1">// 옵저버 등록</span>
  <span class="n">server</span><span class="o">.</span><span class="na">addApplicationContextListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">RequestMappingListener</span><span class="o">());</span>

  <span class="n">server</span><span class="o">.</span><span class="na">service</span><span class="o">(</span><span class="mi">8888</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="6단계---클라이언트-명령이-들어오면-커맨드-객체를-찾아-실행한다">6단계 - 클라이언트 명령이 들어오면 커맨드 객체를 찾아 실행한다.</h4><p><strong>pms.handler.Command</strong> 인터페이스</p><p>커맨드 객체가 클라이언트에게 응답할 수 있도록 출력 스트림 객체를 넘겨준다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">// 사용자의 명령을 처리하는 객체에 대해 호출할 메서드 규칙</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Command</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>handler.XxxListCommand</strong> 구현체 변경</p><p><code class="language-plaintext highlighter-rouge">execute()</code> 메서드의 파라미터로 <code class="language-plaintext highlighter-rouge">PrintWriter out</code>을 정의하고, 콘솔 창에 출력하는 코드(<code class="language-plaintext highlighter-rouge">System.out.println</code>)을 <code class="language-plaintext highlighter-rouge">out.println</code>으로 변경한다. 다음은 BoardListCommand의 코드이다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoardListCommand</span> <span class="kd">implements</span> <span class="nc">Command</span> <span class="o">{</span>

  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">&gt;</span> <span class="n">boardList</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">BoardListCommand</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">boardList</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"[게시물 목록]"</span><span class="o">);</span>

    <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">&gt;</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">boardList</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>

    <span class="k">while</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
      <span class="nc">Board</span> <span class="n">board</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
      <span class="n">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%d, %s, %s, %s, %d\n"</span><span class="o">,</span>
          <span class="n">board</span><span class="o">.</span><span class="na">getNo</span><span class="o">(),</span>
          <span class="n">board</span><span class="o">.</span><span class="na">getTitle</span><span class="o">(),</span>
          <span class="n">board</span><span class="o">.</span><span class="na">getWriter</span><span class="o">(),</span>
          <span class="n">board</span><span class="o">.</span><span class="na">getRegisteredDate</span><span class="o">(),</span>
          <span class="n">board</span><span class="o">.</span><span class="na">getViewCount</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>ServerApp.handleClient</strong></p><p>커맨드 객체의 <code class="language-plaintext highlighter-rouge">execute()</code>를 호출할 때 클라이언트 출력 스트림을 제공한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleClient</span><span class="o">(</span><span class="nc">Socket</span> <span class="n">clientSocket</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//...</span>

    <span class="k">try</span> <span class="o">(</span><span class="c1">//...</span>
    <span class="o">)</span> <span class="o">{</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
			 <span class="c1">//..</span>
        <span class="c1">// 클라이언트가 요청을 보내면 </span>
        <span class="c1">// 요청에 해당하는 커맨드 객체를 context에서 찾는다.</span>
        <span class="nc">Command</span> <span class="n">command</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Command</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">command</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
          <span class="c1">// 출력 스트림 제공</span>
          <span class="n">command</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>
        <span class="k">else</span>
          <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"해당 명령을 처리할 수 없습니다."</span><span class="o">);</span>
        
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
       
      <span class="o">}</span>
</pre></table></code></div></div><h4 id="7단계---클라이언트에게-입력-값을-요구할-수-있도록-프로토콜을-변경한다">7단계 - 클라이언트에게 입력 값을 요구할 수 있도록 프로토콜을 변경한다.</h4><p><strong>pms.handler.Command</strong> 인터페이스</p><p>클라이언트 입력 값을 읽을 수 있도록 파라미터에 입력 스트림을 추가한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Command</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">,</span> <span class="nc">BufferedReader</span> <span class="n">in</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>pms.handler.XxxListCommand</strong></p><p><code class="language-plaintext highlighter-rouge">Command</code> 인터페이스 변경에 따라 구현체의 execute() 메서드의 코드를 수정한다.</p><p><strong>util.Prompt</strong></p><p>파라미터로 받은 출력 스트림으로 프롬프트 제목을 출력하고, 파라미터로 받은 입력 스트림에서 값을 읽어 리턴하는 메서드를 추가한다. 이때 추가하는 메서드는 기존 메서드와 기능이 같기 때문에 이름을 같게 만들자. 다시 말해, 오버로딩하자. 오버로딩하면 메서드이름을 따로따로 암기할 필요 없이 프로그래밍의 일관성을 유지할 수 있게 해준다.</p><blockquote><p>오버로딩: <strong>파라미터가 다르더라도</strong> <strong>같은 일을 하는 메서드에 대해서 같은 이름을 부여함</strong>으로써 호출하는 쪽에서 일관적으로 호출하도록 해서 <strong>프로그래밍의 일관성을 유지</strong>하는 문법</p><p>오버라이딩: 상속받은 메서드가 서브 클래스의 역할에 맞지 않을 때 맞게 다시 재정의</p></blockquote><blockquote><p><strong>oop(상속, 다형성, 캡슐화), 디자인패턴, 리팩토링 이 모든 것의 목표는 소스 코드를 보다 간단하게 만드는 것이다.</strong> 소스 코드가 간단하다는 것은 무엇인가? 첫번째, 읽기 쉽다. 두 번째, 기능 추가/변형/삭제(할 때 기존 코드를 최소로 손대야 한다. 그러면 버그가 줄어들고, 편집 시간은 줄어든다.</p><p>리팩토링은 최적화와 상관 없다.</p></blockquote><p>클라이언트로 출력할 때는 제목 다음에 <code class="language-plaintext highlighter-rouge">!{}!</code> 문자열을 보내 클라이언트가 사용자로부터 값을 입력받아 다시 서버에 보내도록 요청한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Prompt</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="nc">Scanner</span> <span class="n">keyboardScan</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">);</span>
  
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">inputString</span><span class="o">(</span>
      <span class="nc">String</span> <span class="n">title</span><span class="o">,</span>
      <span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">,</span>
      <span class="nc">BufferedReader</span> <span class="n">in</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">title</span><span class="o">);</span> <span class="c1">// 클라이언트가 출력할 프롬프트 제목</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"!{}!"</span><span class="o">);</span> <span class="c1">// 클라이언트에게 값을 보내라는 요청</span>
    <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span> <span class="c1">// 출력하면 버퍼에 쌓인다. "클라이언트로 보내고 싶으면" flush() 호출한다.</span>
    <span class="k">return</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span> <span class="c1">// 클라이언트가 보낸 값을 읽기</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">inputInt</span><span class="o">(</span>
      <span class="nc">String</span> <span class="n">title</span><span class="o">,</span>
      <span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">,</span>
      <span class="nc">BufferedReader</span> <span class="n">in</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">inputString</span><span class="o">(</span><span class="n">title</span><span class="o">,</span> <span class="n">out</span><span class="o">,</span> <span class="n">in</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Date</span> <span class="nf">inputDate</span><span class="o">(</span>
      <span class="nc">String</span> <span class="n">title</span><span class="o">,</span>
      <span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">,</span>
      <span class="nc">BufferedReader</span> <span class="n">in</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Date</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">inputString</span><span class="o">(</span><span class="n">title</span><span class="o">,</span> <span class="n">out</span><span class="o">,</span> <span class="n">in</span><span class="o">));</span>
  <span class="o">}</span>
	<span class="c1">//...</span>
<span class="o">}</span>

</pre></table></code></div></div><p><strong><code class="language-plaintext highlighter-rouge">handler.Xxx[Add|Detail|Update|Delete]Command</code> 구현체 변경</strong></p><p><code class="language-plaintext highlighter-rouge">Command</code> 인터페이스 변경에 따라 execute() 메서드의 코드를 수정한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoardAddCommand</span> <span class="kd">implements</span> <span class="nc">Command</span> <span class="o">{</span>

  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">&gt;</span> <span class="n">boardList</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">BoardAddCommand</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">boardList</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">,</span> <span class="nc">BufferedReader</span> <span class="n">in</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"[게시물 등록]"</span><span class="o">);</span>

      <span class="nc">Board</span> <span class="n">board</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Board</span><span class="o">();</span>
      <span class="n">board</span><span class="o">.</span><span class="na">setNo</span><span class="o">(</span><span class="nc">Prompt</span><span class="o">.</span><span class="na">inputInt</span><span class="o">(</span><span class="s">"번호? "</span><span class="o">,</span> <span class="n">out</span><span class="o">,</span> <span class="n">in</span><span class="o">));</span>
      <span class="n">board</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="nc">Prompt</span><span class="o">.</span><span class="na">inputString</span><span class="o">(</span><span class="s">"제목? "</span><span class="o">,</span> <span class="n">out</span><span class="o">,</span> <span class="n">in</span><span class="o">));</span>
      <span class="n">board</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="nc">Prompt</span><span class="o">.</span><span class="na">inputString</span><span class="o">(</span><span class="s">"내용? "</span><span class="o">,</span> <span class="n">out</span><span class="o">,</span> <span class="n">in</span><span class="o">));</span>
      <span class="n">board</span><span class="o">.</span><span class="na">setWriter</span><span class="o">(</span><span class="nc">Prompt</span><span class="o">.</span><span class="na">inputString</span><span class="o">(</span><span class="s">"작성자? "</span><span class="o">,</span> <span class="n">out</span><span class="o">,</span> <span class="n">in</span><span class="o">));</span>
      <span class="n">board</span><span class="o">.</span><span class="na">setRegisteredDate</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()));</span>
      <span class="n">board</span><span class="o">.</span><span class="na">setViewCount</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

      <span class="n">boardList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>

      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"게시글을 등록하였습니다."</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"게시물 등록 중 오류 발생!"</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong><code class="language-plaintext highlighter-rouge">ServerApp.handleClient</code></strong></p><p>커맨드 객체의 execute()를 호출할 때, 클라이언트 출력 스트림과 입력 스트림을 제공한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">//...</span>
<span class="nc">Command</span> <span class="n">command</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Command</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">command</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">command</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">in</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"해당 명령을 처리할 수 없습니다!"</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
<span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
</pre></table></code></div></div><h4 id="8단계---디자인-패턴와-cs-애플리케이션-아키텍처의-유용성을-확인한다">8단계 - 디자인 패턴와 C/S 애플리케이션 아키텍처의 유용성을 확인한다.</h4><p>지금 프로그램은 커맨드 패턴을 적용하였기 때문에 새로운 기능을 추가하기 굉장히 편하다. 기존 코드를 손 대지 않고 새 클래스를 추가만 하면 되기 때문이다. 따라서 이 방식은 명령 당 한 개의 메서드를 만드는 상황에서 적절한 설계기법이고, 유지보수하기 좋다.</p><p>계산기 기능을 수행하는 새 명령을 추가해보자.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CalculatorCommand</span> <span class="kd">implements</span> <span class="nc">Command</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">,</span> <span class="nc">BufferedReader</span> <span class="n">in</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"[계산기]"</span><span class="o">);</span>
      
      <span class="nc">String</span> <span class="n">input</span> <span class="o">=</span> <span class="nc">Prompt</span><span class="o">.</span><span class="na">inputString</span><span class="o">(</span><span class="s">"계산식?(예: 5 * 3"</span><span class="o">);</span>
      <span class="nc">String</span><span class="o">[]</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">arr</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"계산식이 옳지 않습니다."</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"계산식 예: 15 * 45"</span><span class="o">);</span>
        <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>
      
      <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">arr</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
      <span class="nc">String</span> <span class="n">op</span>  <span class="o">=</span> <span class="n">arr</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
      <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">arr</span><span class="o">[</span><span class="mi">2</span><span class="o">]);</span>
      <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      
      <span class="k">switch</span> <span class="o">(</span><span class="n">op</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">case</span> <span class="s">"+"</span><span class="o">:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="s">"-"</span><span class="o">:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="s">"/"</span><span class="o">:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="s">"*"</span><span class="o">:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
        <span class="k">default</span><span class="o">:</span>
          <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"해당 연산을 지원하지 않습니다."</span><span class="o">);</span>
          <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>
      
      <span class="n">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"계산 결과: %d %s %d = %d"</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">op</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
      
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"작업 처리 중 오류 발생!"</span><span class="o">);</span>
    <span class="o">}</span> 
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>RequestMappingListener 클래스에서 CalculatorCommand를 생성해 context 맵에 보관한다. 옵저버 패턴을 사용하고 있기 때문에 기존 ServerApp 클래스는 손댈 필요가 없다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestMappingListener</span> <span class="kd">implements</span> <span class="nc">ApplicationContextListener</span> <span class="o">{</span>

  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextInitialized</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//....</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">HelloCommand</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="c1">//....</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="9단계---quit-stop-명령어를-처리한다">9단계 - “quit”, “stop” 명령어를 처리한다.</h4><p><strong>ServerApp.handleClient()</strong></p><ul><li><code class="language-plaintext highlighter-rouge">stop</code> 명령: 클라이언트에게 안내 메시지를 보낸 후 서버를 종료해야 하는 상태로 만든다.<li><code class="language-plaintext highlighter-rouge">quit</code> 명령: 클라이언트에게 안내 메시지를 보낸 후 클라이언트와 연결을 끊는다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre>  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">handleClient</span><span class="o">(</span><span class="nc">Socket</span> <span class="n">clientSocket</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">InetAddress</span> <span class="n">address</span> <span class="o">=</span> <span class="n">clientSocket</span><span class="o">.</span><span class="na">getInetAddress</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)가 연결되었습니다.\n"</span><span class="o">,</span>
        <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>

    <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">clientSocket</span><span class="o">;</span> <span class="c1">// try 블록을 떠날 때 close()가 자동 호출된다.</span>
        <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
        <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()))</span> <span class="o">{</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span> <span class="o">{</span>
          <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"안녕!"</span><span class="o">);</span>
          <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
          <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"stop"</span><span class="o">))</span> <span class="o">{</span>
          <span class="n">stop</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> <span class="c1">// 서버의 상태를 멈추라는 의미로 true로 설정한다.</span>
          <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"서버를 종료하는 중입니다!"</span><span class="o">);</span>
          <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
          <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nc">Command</span> <span class="n">command</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Command</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">command</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">command</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">in</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"해당 명령을 처리할 수 없습니다!"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// 응답의 끝을 알리는 빈 문자열을 보낸다.</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

      <span class="o">}</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"클라이언트와의 통신 오류!"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"클라이언트(%s)와의 연결을 끊었습니다.\n"</span><span class="o">,</span>
        <span class="n">address</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">());</span>
  <span class="o">}</span>
</pre></table></code></div></div><blockquote><p>초보가 가장 많이 하는 실수가 자기가 만든 코드를 아까워서 안 지우려고 하는 것이다. 초보 개발자에게는 코드가 남는 것이 아니라 코드를 만든 경험이 남는다! 무서워 하지 말고 과감하게 지우고 계속 코딩하자!</p></blockquote><p><strong>아이피 주소가 바뀌는 이유</strong></p><ul><li>한 달에 한 번씩 아이피 주소가 바뀐다.<li>일정 시간마다 아이피 주소가 바뀔 수 있다: 다이나믹 아이피<li>real ip도 접속하는 순간에만 우리 것이지, 꺼버리면 아이피가 다른 사람한테 갈 수 있다. 한편, 서버 아이피는 고정되어 있어야 한다. 그러면 고정 아이피를 받아야 한다. 한달에 일정사용료 내야 한다. 아이피도 real ip이면서 고정 아이피이다. 이제서야 도메인 이름을 부여할 수 있다. 고정 아이피에 대해서 도메인 이름을 부여할 수 있지, 다이나믹 아이피에는 도메인 이름을 부여할 수 없다.</ul><h3 id="client">Client</h3><ul><li>서버에 stop 명령을 보내면 클라이언트를 즉시 종료한다.<li>서버가 입력 값을 요구하면 사용자로부터 입력 값을 받아 보낸다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"프로그램 사용법:"</span><span class="o">);</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"  java -cp ... ClientApp 서버주소 포트번호"</span><span class="o">);</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// 클라이언트가 서버에 stop 명령을 보내면 다음 변수를 true로 변경한다.</span>
    <span class="kt">boolean</span> <span class="n">stop</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

    <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]));</span>
        <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
        <span class="nc">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">())))</span> <span class="o">{</span>

      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">input</span> <span class="o">=</span> <span class="nc">Prompt</span><span class="o">.</span><span class="na">inputString</span><span class="o">(</span><span class="s">"명령&gt; "</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

        <span class="n">receiveResponse</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">in</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"quit"</span><span class="o">))</span> <span class="o">{</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"stop"</span><span class="o">))</span> <span class="o">{</span>
          <span class="n">stop</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">stop</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// 서버를 멈추기 위해 그냥 접속했다가 끊는다.</span>
      <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">])))</span> <span class="o">{</span>
        <span class="c1">// 아무것도 안한다.</span>
        <span class="c1">// 서버가 stop 할 기회를 주기 위함이다.</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 아무것도 안한다.</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">receiveResponse</span><span class="o">(</span><span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">,</span> <span class="nc">BufferedReader</span> <span class="n">in</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"!{}!"</span><span class="o">))</span> <span class="o">{</span>
        <span class="c1">// 사용자로부터 값을 입력을 받아서 서버에 보낸다.</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Prompt</span><span class="o">.</span><span class="na">inputString</span><span class="o">(</span><span class="s">""</span><span class="o">));</span>
        <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span> <span class="c1">// 주의! 출력하면 버퍼에 쌓인다. 서버로 보내고 싶다면 flush()를 호출하라!</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p>완성된 프로그램을 보면 거의 모든 작업을 서버에서 하고 있다. 모든 작업을 서버에서 한다면 사용자 pc 는 성능이 좋을 필요가 없다. 서버에서 어플리케이션을 돌린다고 해서 어플리케이션 서버라고 한다. 즉 가벼운 클라이언트, Thin Client가 Application Server에 요청을 한다. 이것이 C/S 프로그램으로 바꾼 이유이다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/bitcamp/'>bitcamp</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/bitcamp/" class="post-tag no-text-decoration" >bitcamp</a> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=학원 #57일차: 네트워크 API를 활용한 C/S 아키텍처 - 하연&url=https://hayeon17kim.github.io//posts/201014-57/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=학원 #57일차: 네트워크 API를 활용한 C/S 아키텍처 - 하연&u=https://hayeon17kim.github.io//posts/201014-57/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=학원 #57일차: 네트워크 API를 활용한 C/S 아키텍처 - 하연&url=https://hayeon17kim.github.io//posts/201014-57/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/system-deisign-capacity-estimation/">System Design: Capacity Estimate</a><li><a href="/posts/today-i-learned-2021-04-27/">주니어 성장일기: 2021.04.27</a><li><a href="/posts/today-i-learned-2021-04-26/">주니어 성장일기: 2021.04.26</a><li><a href="/posts/fastcampus-01/">자료구조와 알고리즘이란</a><li><a href="/posts/today-i-learned-2021-04-25/">주니어 성장일기: 2021.04.25</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/bitcamp/">bitcamp</a> <a class="post-tag" href="/tags/modernjs/">modernJS</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/trouble-shooting/">trouble-shooting</a> <a class="post-tag" href="/tags/devil/">devil</a> <a class="post-tag" href="/tags/corejs/">corejs</a> <a class="post-tag" href="/tags/network/">network</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/201123-85/"><div class="card-body"> <span class="timeago small" > Nov 23, 2020 <i class="unloaded">2020-11-23T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>학원 #85일차:서블릿 프로그래밍, WAS, JavaEE와 Servlet 컨테이너, Servlet 인터페이스의 Life-cycle 메서드</h3><div class="text-muted small"><p> 서블릿 프로그래밍 웹 애플리케이션 서버 아키텍쳐의 개념 JavaEE와 Servlet API의 관계 JavaEE 구현체와 서블릿 컨테이너의 관계 eomcs-web-project/src-00 예제 실습 Servlet 인터페이스와 Life-cycle 메서드 WAS(Web Application Server) 아키텍처 이전까지는 사...</p></div></div></a></div><div class="card"> <a href="/posts/201124-86/"><div class="card-body"> <span class="timeago small" > Nov 24, 2020 <i class="unloaded">2020-11-24T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>학원 #86일차:서블릿 프로그래밍, 프로젝트를 WAS 아키텍처로 전환</h3><div class="text-muted small"><p> 서블릿 컨테이너가 관리하는 컴포넌트는 서블릿, 필터, 리스너로 3가지이다. Servlet 만들기 1. javax.servlet.Servlet 인터페이스 구현 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38...</p></div></div></a></div><div class="card"> <a href="/posts/201125-87/"><div class="card-body"> <span class="timeago small" > Nov 25, 2020 <i class="unloaded">2020-11-25T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>학원 #87일차: HTML 태그 사용법</h3><div class="text-muted small"><p> HTML/CSS 학습법: 결과 화면 먼저 보고 소스코드를 확인하자 UI와 UX UX(User Experience; 사용자 경험): 사용자 편의성 ex: 링크에 hover했을 때 커서가 손모양으로 바뀌어야 한다. UI(User Interface): 기능을 하는 화면이 있는가 HTML ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/201013-56/" class="btn btn-outline-primary" prompt="Older"><p>학원 #56일차: PMS 프로젝트: Observer 패턴의 활용</p></a> <a href="/posts/network-for-everyone-02/" class="btn btn-outline-primary" prompt="Newer"><p>모두의 네트워크 #2장: 네트워크 기본 규칙</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Loading comments from <a href="https://disqus.com/">Disqus</a> ...</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//hayeon17kim-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = '학원 #57일차: 네트워크 API를 활용한 C/S 아키텍처'; this.page.url = 'https://hayeon17kim.github.io//posts/201014-57/'; this.page.identifier = '/posts/201014-57/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/MONI56219559">hayeon_kim</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/bitcamp/">bitcamp</a> <a class="post-tag" href="/tags/modernjs/">modernJS</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/trouble-shooting/">trouble shooting</a> <a class="post-tag" href="/tags/devil/">devil</a> <a class="post-tag" href="/tags/corejs/">corejs</a> <a class="post-tag" href="/tags/network/">network</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://hayeon17kim.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
